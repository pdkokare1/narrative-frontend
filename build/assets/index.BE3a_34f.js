const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web.ClFCdD9F.js","assets/vendor-utils.C5aUNQjH.js","assets/vendor-react.CunEISTA.js","assets/vendor-firebase.CapENl2a.js","assets/vendor-ui.DT2d8rn5.js","assets/vendor-charts.CDFCwfjF.js","assets/web.BXF8r2TP.js","assets/index.B9SqF2Xj.js","assets/index.DLB16yvK.js","assets/web.jLF61sCP.js","assets/MyDashboard.Cr_oC7gH.js","assets/MyDashboard.BGzD4k_7.css","assets/SavedArticles.BnR4vvAT.js","assets/SectionHeader.Dw_45JcM.js","assets/SectionHeader.BjCfAwgZ.css","assets/SavedArticles._peV2PZK.css","assets/AccountSettings.DEmcy_69.js","assets/AccountSettings.BcXBsbWw.css","assets/SearchResults.Bho8CNJp.js","assets/EmergencyResources.UKRQJEEU.js","assets/EmergencyResources.BLyvIFFc.css","assets/MobileProfileMenu.DAy1NQ2B.js","assets/Legal.CVMLLcMn.js","assets/Legal.BhngakcZ.css","assets/CompareCoverageModal.D3In9xLI.js","assets/DetailedAnalysisModal.CAKwfeer.js","assets/FilterModal.CK9HA4yN.js","assets/FilterModal.HM67K6jM.css"])))=>i.map(i=>d[i]);
var la=Object.defineProperty;var da=(e,t,r)=>t in e?la(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var er=(e,t,r)=>da(e,typeof t!="symbol"?t+"":t,r);import{b as ae,j as n,u as ua,c as ha,f as pa,Q as ma,d as fa}from"./vendor-utils.C5aUNQjH.js";import{d as es,r as h,b as he,u as rt,e as ga,L as Le,g as Mn,N as Ae,f as ts,h as le,i as vn,O as va,B as ya}from"./vendor-react.CunEISTA.js";import{r as We,_ as De,C as Me,a as yt,E as Rt,F as ns,L as rs,g as Ot,i as xa,b as $n,v as ss,c as tr,d as as,e as ba,f as is,h as wa,D as nr,j as ja,k as os,o as Sa,s as Ta,l as Na,m as Ca,G as ka,R as Aa}from"./vendor-firebase.CapENl2a.js";import{P as V,R as Ea,u as Ia,F as Vt,B as we,T as Ke,K as _a,L as Pa,S as Gt,a as rr,b as sr,I as Ue,C as ar,c as La,d as Ra,e as Oa,f as Da,g as qt,h as Ma,i as $a}from"./vendor-ui.DT2d8rn5.js";import{C as Ba,a as Fa,L as Ua,P as Ha,b as za,B as Wa,p as Va,c as Ga,d as qa,A as Ka,e as Ya,f as Ja,g as Qa}from"./vendor-charts.CDFCwfjF.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var yn={},ir=es;yn.createRoot=ir.createRoot,yn.hydrateRoot=ir.hydrateRoot;/*! Capacitor: https://capacitorjs.com/ - MIT License */const Xa=e=>{const t=new Map;t.set("web",{name:"web"});const r=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t},s=(i,o)=>{r.platforms.set(i,o)},a=i=>{r.platforms.has(i)&&(r.currentPlatform=r.platforms.get(i))};return r.addPlatform=s,r.setPlatform=a,r},Za=e=>e.CapacitorPlatforms=Xa(e),cs=Za(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});cs.addPlatform;cs.setPlatform;var nt;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(nt||(nt={}));class Kt extends Error{constructor(t,r,s){super(t),this.message=t,this.code=r,this.data=s}}const ei=e=>{var t,r;return e!=null&&e.androidBridge?"android":!((r=(t=e==null?void 0:e.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},ti=e=>{var t,r,s,a,i;const o=e.CapacitorCustomPlatform||null,c=e.Capacitor||{},d=c.Plugins=c.Plugins||{},u=e.CapacitorPlatforms,l=()=>o!==null?o.name:ei(e),p=((t=u==null?void 0:u.currentPlatform)===null||t===void 0?void 0:t.getPlatform)||l,m=()=>p()!=="web",y=((r=u==null?void 0:u.currentPlatform)===null||r===void 0?void 0:r.isNativePlatform)||m,S=g=>{const v=f.get(g);return!!(v!=null&&v.platforms.has(p())||N(g))},w=((s=u==null?void 0:u.currentPlatform)===null||s===void 0?void 0:s.isPluginAvailable)||S,k=g=>{var v;return(v=c.PluginHeaders)===null||v===void 0?void 0:v.find(P=>P.name===g)},N=((a=u==null?void 0:u.currentPlatform)===null||a===void 0?void 0:a.getPluginHeader)||k,j=g=>e.console.error(g),b=(g,v,P)=>Promise.reject(`${P} does not have an implementation of "${v}".`),f=new Map,T=(g,v={})=>{const P=f.get(g);if(P)return console.warn(`Capacitor plugin "${g}" already registered. Cannot register plugins twice.`),P.proxy;const O=p(),F=N(g);let U;const z=async()=>(!U&&O in v?U=typeof v[O]=="function"?U=await v[O]():U=v[O]:o!==null&&!U&&"web"in v&&(U=typeof v.web=="function"?U=await v.web():U=v.web),U),Y=(C,E)=>{var A,Q;if(F){const J=F==null?void 0:F.methods.find(ee=>E===ee.name);if(J)return J.rtype==="promise"?ee=>c.nativePromise(g,E.toString(),ee):(ee,ge)=>c.nativeCallback(g,E.toString(),ee,ge);if(C)return(A=C[E])===null||A===void 0?void 0:A.bind(C)}else{if(C)return(Q=C[E])===null||Q===void 0?void 0:Q.bind(C);throw new Kt(`"${g}" plugin is not implemented on ${O}`,nt.Unimplemented)}},M=C=>{let E;const A=(...Q)=>{const J=z().then(ee=>{const ge=Y(ee,C);if(ge){const X=ge(...Q);return E=X==null?void 0:X.remove,X}else throw new Kt(`"${g}.${C}()" is not implemented on ${O}`,nt.Unimplemented)});return C==="addListener"&&(J.remove=async()=>E()),J};return A.toString=()=>`${C.toString()}() { [capacitor code] }`,Object.defineProperty(A,"name",{value:C,writable:!1,configurable:!1}),A},L=M("addListener"),$=M("removeListener"),W=(C,E)=>{const A=L({eventName:C},E),Q=async()=>{const ee=await A;$({eventName:C,callbackId:ee},E)},J=new Promise(ee=>A.then(()=>ee({remove:Q})));return J.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Q()},J},R=new Proxy({},{get(C,E){switch(E){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return F?W:L;case"removeListener":return $;default:return M(E)}}});return d[g]=R,f.set(g,{name:g,proxy:R,platforms:new Set([...Object.keys(v),...F?[O]:[]])}),R},_=((i=u==null?void 0:u.currentPlatform)===null||i===void 0?void 0:i.registerPlugin)||T;return c.convertFileSrc||(c.convertFileSrc=g=>g),c.getPlatform=p,c.handleError=j,c.isNativePlatform=y,c.isPluginAvailable=w,c.pluginMethodNoop=b,c.registerPlugin=_,c.Exception=Kt,c.DEBUG=!!c.DEBUG,c.isLoggingEnabled=!!c.isLoggingEnabled,c.platform=c.getPlatform(),c.isNative=c.isNativePlatform(),c},ni=e=>e.Capacitor=ti(e),_e=ni(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),st=_e.registerPlugin;_e.Plugins;class ls{constructor(t){this.listeners={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,r){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(r);const a=this.windowListeners[t];a&&!a.registered&&this.addWindowListener(a);const i=async()=>this.removeListener(t,r),o=Promise.resolve({remove:i});return Object.defineProperty(o,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await i()}}),o}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,r){const s=this.listeners[t];s&&s.forEach(a=>a(r))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,r){this.windowListeners[r]={registered:!1,windowEventName:t,pluginEventName:r,handler:s=>{this.notifyListeners(r,s)}}}unimplemented(t="not implemented"){return new _e.Exception(t,nt.Unimplemented)}unavailable(t="not available"){return new _e.Exception(t,nt.Unavailable)}async removeListener(t,r){const s=this.listeners[t];if(!s)return;const a=s.indexOf(r);this.listeners[t].splice(a,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}}const or=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),cr=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ri extends ls{async getCookies(){const t=document.cookie,r={};return t.split(";").forEach(s=>{if(s.length<=0)return;let[a,i]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=cr(a).trim(),i=cr(i).trim(),r[a]=i}),r}async setCookie(t){try{const r=or(t.key),s=or(t.value),a=`; expires=${(t.expires||"").replace("expires=","")}`,i=(t.path||"/").replace("path=",""),o=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${r}=${s||""}${a}; path=${i}; ${o};`}catch(r){return Promise.reject(r)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const r of t)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}st("CapacitorCookies",{web:()=>new ri});const si=async e=>new Promise((t,r)=>{const s=new FileReader;s.onload=()=>{const a=s.result;t(a.indexOf(",")>=0?a.split(",")[1]:a)},s.onerror=a=>r(a),s.readAsDataURL(e)}),ai=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(a=>a.toLocaleLowerCase()).reduce((a,i,o)=>(a[i]=e[t[o]],a),{})},ii=(e,t=!0)=>e?Object.entries(e).reduce((s,a)=>{const[i,o]=a;let c,d;return Array.isArray(o)?(d="",o.forEach(u=>{c=t?encodeURIComponent(u):u,d+=`${i}=${c}&`}),d.slice(0,-1)):(c=t?encodeURIComponent(o):o,d=`${i}=${c}`),`${s}&${d}`},"").substr(1):null,oi=(e,t={})=>{const r=Object.assign({method:e.method||"GET",headers:e.headers},t),a=ai(e.headers)["content-type"]||"";if(typeof e.data=="string")r.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[o,c]of Object.entries(e.data||{}))i.set(o,c);r.body=i.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){const i=new FormData;if(e.data instanceof FormData)e.data.forEach((c,d)=>{i.append(d,c)});else for(const c of Object.keys(e.data))i.append(c,e.data[c]);r.body=i;const o=new Headers(r.headers);o.delete("content-type"),r.headers=o}else(a.includes("application/json")||typeof e.data=="object")&&(r.body=JSON.stringify(e.data));return r};class ci extends ls{async request(t){const r=oi(t,t.webFetchExtra),s=ii(t.params,t.shouldEncodeUrlParams),a=s?`${t.url}?${s}`:t.url,i=await fetch(a,r),o=i.headers.get("content-type")||"";let{responseType:c="text"}=i.ok?t:{};o.includes("application/json")&&(c="json");let d,u;switch(c){case"arraybuffer":case"blob":u=await i.blob(),d=await si(u);break;case"json":d=await i.json();break;case"document":case"text":default:d=await i.text()}const l={};return i.headers.forEach((p,m)=>{l[m]=p}),{data:d,headers:l,status:i.status,url:i.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}st("CapacitorHttp",{web:()=>new ci});const li="modulepreload",di=function(e){return"/"+e},lr={},ue=function(t,r,s){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(r.map(d=>{if(d=di(d),d in lr)return;lr[d]=!0;const u=d.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${l}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":li,u||(p.as="script"),p.crossOrigin="",p.href=d,c&&p.setAttribute("nonce",c),document.head.appendChild(p),u)return new Promise((m,y)=>{p.addEventListener("load",m),p.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return a.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})},ui=st("SplashScreen",{web:()=>ue(()=>import("./web.ClFCdD9F.js"),__vite__mapDeps([0,1,2,3,4,5])).then(e=>new e.SplashScreenWeb)});var xn;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(xn||(xn={}));var dr;(function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"})(dr||(dr={}));const ur=st("StatusBar"),hi=(e,t)=>t.some(r=>e instanceof r);let hr,pr;function pi(){return hr||(hr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mi(){return pr||(pr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ds=new WeakMap,bn=new WeakMap,us=new WeakMap,Yt=new WeakMap,Bn=new WeakMap;function fi(e){const t=new Promise((r,s)=>{const a=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{r(Re(e.result)),a()},o=()=>{s(e.error),a()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(r=>{r instanceof IDBCursor&&ds.set(r,e)}).catch(()=>{}),Bn.set(t,e),t}function gi(e){if(bn.has(e))return;const t=new Promise((r,s)=>{const a=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{r(),a()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});bn.set(e,t)}let wn={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return bn.get(e);if(t==="objectStoreNames")return e.objectStoreNames||us.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Re(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function vi(e){wn=e(wn)}function yi(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const s=e.call(Jt(this),t,...r);return us.set(s,t.sort?t.sort():[t]),Re(s)}:mi().includes(e)?function(...t){return e.apply(Jt(this),t),Re(ds.get(this))}:function(...t){return Re(e.apply(Jt(this),t))}}function xi(e){return typeof e=="function"?yi(e):(e instanceof IDBTransaction&&gi(e),hi(e,pi())?new Proxy(e,wn):e)}function Re(e){if(e instanceof IDBRequest)return fi(e);if(Yt.has(e))return Yt.get(e);const t=xi(e);return t!==e&&(Yt.set(e,t),Bn.set(t,e)),t}const Jt=e=>Bn.get(e);function bi(e,t,{blocked:r,upgrade:s,blocking:a,terminated:i}={}){const o=indexedDB.open(e,t),c=Re(o);return s&&o.addEventListener("upgradeneeded",d=>{s(Re(o.result),d.oldVersion,d.newVersion,Re(o.transaction),d)}),r&&o.addEventListener("blocked",d=>r(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",u=>a(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}const wi=["get","getKey","getAll","getAllKeys","count"],ji=["put","add","delete","clear"],Qt=new Map;function mr(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Qt.get(t))return Qt.get(t);const r=t.replace(/FromIndex$/,""),s=t!==r,a=ji.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(a||wi.includes(r)))return;const i=async function(o,...c){const d=this.transaction(o,a?"readwrite":"readonly");let u=d.store;return s&&(u=u.index(c.shift())),(await Promise.all([u[r](...c),a&&d.done]))[0]};return Qt.set(t,i),i}vi(e=>({...e,get:(t,r,s)=>mr(t,r)||e.get(t,r,s),has:(t,r)=>!!mr(t,r)||e.has(t,r)}));const hs="@firebase/installations",Fn="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ps=1e4,ms=`w:${Fn}`,fs="FIS_v2",Si="https://firebaseinstallations.googleapis.com/v1",Ti=60*60*1e3,Ni="installations",Ci="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ki={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ve=new Rt(Ni,Ci,ki);function gs(e){return e instanceof ns&&e.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vs({projectId:e}){return`${Si}/projects/${e}/installations`}function ys(e){return{token:e.token,requestStatus:2,expiresIn:Ei(e.expiresIn),creationTime:Date.now()}}async function xs(e,t){const s=(await t.json()).error;return Ve.create("request-failed",{requestName:e,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function bs({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Ai(e,{refreshToken:t}){const r=bs(e);return r.append("Authorization",Ii(t)),r}async function ws(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Ei(e){return Number(e.replace("s","000"))}function Ii(e){return`${fs} ${e}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _i({appConfig:e,heartbeatServiceProvider:t},{fid:r}){const s=vs(e),a=bs(e),i=t.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&a.append("x-firebase-client",u)}const o={fid:r,authVersion:fs,appId:e.appId,sdkVersion:ms},c={method:"POST",headers:a,body:JSON.stringify(o)},d=await ws(()=>fetch(s,c));if(d.ok){const u=await d.json();return{fid:u.fid||r,registrationStatus:2,refreshToken:u.refreshToken,authToken:ys(u.authToken)}}else throw await xs("Create Installation",d)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function js(e){return new Promise(t=>{setTimeout(t,e)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Li=/^[cdef][\w-]{21}$/,jn="";function Ri(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const r=Oi(e);return Li.test(r)?r:jn}catch{return jn}}function Oi(e){return Pi(e).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dt(e){return`${e.appName}!${e.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ss=new Map;function Ts(e,t){const r=Dt(e);Ns(r,t),Di(r,t)}function Ns(e,t){const r=Ss.get(e);if(r)for(const s of r)s(t)}function Di(e,t){const r=Mi();r&&r.postMessage({key:e,fid:t}),$i()}let He=null;function Mi(){return!He&&"BroadcastChannel"in self&&(He=new BroadcastChannel("[Firebase] FID Change"),He.onmessage=e=>{Ns(e.data.key,e.data.fid)}),He}function $i(){Ss.size===0&&He&&(He.close(),He=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bi="firebase-installations-database",Fi=1,Ge="firebase-installations-store";let Xt=null;function Un(){return Xt||(Xt=bi(Bi,Fi,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(Ge)}}})),Xt}async function Et(e,t){const r=Dt(e),a=(await Un()).transaction(Ge,"readwrite"),i=a.objectStore(Ge),o=await i.get(r);return await i.put(t,r),await a.done,(!o||o.fid!==t.fid)&&Ts(e,t.fid),t}async function Cs(e){const t=Dt(e),s=(await Un()).transaction(Ge,"readwrite");await s.objectStore(Ge).delete(t),await s.done}async function Mt(e,t){const r=Dt(e),a=(await Un()).transaction(Ge,"readwrite"),i=a.objectStore(Ge),o=await i.get(r),c=t(o);return c===void 0?await i.delete(r):await i.put(c,r),await a.done,c&&(!o||o.fid!==c.fid)&&Ts(e,c.fid),c}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hn(e){let t;const r=await Mt(e.appConfig,s=>{const a=Ui(s),i=Hi(e,a);return t=i.registrationPromise,i.installationEntry});return r.fid===jn?{installationEntry:await t}:{installationEntry:r,registrationPromise:t}}function Ui(e){const t=e||{fid:Ri(),registrationStatus:0};return ks(t)}function Hi(e,t){if(t.registrationStatus===0){if(!navigator.onLine){const a=Promise.reject(Ve.create("app-offline"));return{installationEntry:t,registrationPromise:a}}const r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},s=zi(e,r);return{installationEntry:r,registrationPromise:s}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:Wi(e)}:{installationEntry:t}}async function zi(e,t){try{const r=await _i(e,t);return Et(e.appConfig,r)}catch(r){throw gs(r)&&r.customData.serverCode===409?await Cs(e.appConfig):await Et(e.appConfig,{fid:t.fid,registrationStatus:0}),r}}async function Wi(e){let t=await fr(e.appConfig);for(;t.registrationStatus===1;)await js(100),t=await fr(e.appConfig);if(t.registrationStatus===0){const{installationEntry:r,registrationPromise:s}=await Hn(e);return s||r}return t}function fr(e){return Mt(e,t=>{if(!t)throw Ve.create("installation-not-found");return ks(t)})}function ks(e){return Vi(e)?{fid:e.fid,registrationStatus:0}:e}function Vi(e){return e.registrationStatus===1&&e.registrationTime+ps<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gi({appConfig:e,heartbeatServiceProvider:t},r){const s=qi(e,r),a=Ai(e,r),i=t.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&a.append("x-firebase-client",u)}const o={installation:{sdkVersion:ms,appId:e.appId}},c={method:"POST",headers:a,body:JSON.stringify(o)},d=await ws(()=>fetch(s,c));if(d.ok){const u=await d.json();return ys(u)}else throw await xs("Generate Auth Token",d)}function qi(e,{fid:t}){return`${vs(e)}/${t}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zn(e,t=!1){let r;const s=await Mt(e.appConfig,i=>{if(!As(i))throw Ve.create("not-registered");const o=i.authToken;if(!t&&Ji(o))return i;if(o.requestStatus===1)return r=Ki(e,t),i;{if(!navigator.onLine)throw Ve.create("app-offline");const c=Xi(i);return r=Yi(e,c),c}});return r?await r:s.authToken}async function Ki(e,t){let r=await gr(e.appConfig);for(;r.authToken.requestStatus===1;)await js(100),r=await gr(e.appConfig);const s=r.authToken;return s.requestStatus===0?zn(e,t):s}function gr(e){return Mt(e,t=>{if(!As(t))throw Ve.create("not-registered");const r=t.authToken;return Zi(r)?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}async function Yi(e,t){try{const r=await Gi(e,t),s=Object.assign(Object.assign({},t),{authToken:r});return await Et(e.appConfig,s),r}catch(r){if(gs(r)&&(r.customData.serverCode===401||r.customData.serverCode===404))await Cs(e.appConfig);else{const s=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Et(e.appConfig,s)}throw r}}function As(e){return e!==void 0&&e.registrationStatus===2}function Ji(e){return e.requestStatus===2&&!Qi(e)}function Qi(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Ti}function Xi(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function Zi(e){return e.requestStatus===1&&e.requestTime+ps<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eo(e){const t=e,{installationEntry:r,registrationPromise:s}=await Hn(t);return s?s.catch(console.error):zn(t).catch(console.error),r.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function to(e,t=!1){const r=e;return await no(r),(await zn(r,t)).token}async function no(e){const{registrationPromise:t}=await Hn(e);t&&await t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ro(e){if(!e||!e.options)throw Zt("App Configuration");if(!e.name)throw Zt("App Name");const t=["projectId","apiKey","appId"];for(const r of t)if(!e.options[r])throw Zt(r);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function Zt(e){return Ve.create("missing-app-config-values",{valueName:e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Es="installations",so="installations-internal",ao=e=>{const t=e.getProvider("app").getImmediate(),r=ro(t),s=yt(t,"heartbeat");return{app:t,appConfig:r,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},io=e=>{const t=e.getProvider("app").getImmediate(),r=yt(t,Es).getImmediate();return{getId:()=>eo(r),getToken:a=>to(r,a)}};function oo(){De(new Me(Es,ao,"PUBLIC")),De(new Me(so,io,"PRIVATE"))}oo();We(hs,Fn);We(hs,Fn,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const It="analytics",co="firebase_id",lo="origin",uo=60*1e3,ho="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Wn="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fe=new rs("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const po={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},xe=new Rt("analytics","Analytics",po);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mo(e){if(!e.startsWith(Wn)){const t=xe.create("invalid-gtag-resource",{gtagURL:e});return fe.warn(t.message),""}return e}function Is(e){return Promise.all(e.map(t=>t.catch(r=>r)))}function fo(e,t){let r;return window.trustedTypes&&(r=window.trustedTypes.createPolicy(e,t)),r}function go(e,t){const r=fo("firebase-js-sdk-policy",{createScriptURL:mo}),s=document.createElement("script"),a=`${Wn}?l=${e}&id=${t}`;s.src=r?r==null?void 0:r.createScriptURL(a):a,s.async=!0,document.head.appendChild(s)}function vo(e){let t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}async function yo(e,t,r,s,a,i){const o=s[a];try{if(o)await t[o];else{const d=(await Is(r)).find(u=>u.measurementId===a);d&&await t[d.appId]}}catch(c){fe.error(c)}e("config",a,i)}async function xo(e,t,r,s,a){try{let i=[];if(a&&a.send_to){let o=a.send_to;Array.isArray(o)||(o=[o]);const c=await Is(r);for(const d of o){const u=c.find(p=>p.measurementId===d),l=u&&t[u.appId];if(l)i.push(l);else{i=[];break}}}i.length===0&&(i=Object.values(t)),await Promise.all(i),e("event",s,a||{})}catch(i){fe.error(i)}}function bo(e,t,r,s){async function a(i,...o){try{if(i==="event"){const[c,d]=o;await xo(e,t,r,c,d)}else if(i==="config"){const[c,d]=o;await yo(e,t,r,s,c,d)}else if(i==="consent"){const[c,d]=o;e("consent",c,d)}else if(i==="get"){const[c,d,u]=o;e("get",c,d,u)}else if(i==="set"){const[c]=o;e("set",c)}else e(i,...o)}catch(c){fe.error(c)}}return a}function wo(e,t,r,s,a){let i=function(...o){window[s].push(arguments)};return window[a]&&typeof window[a]=="function"&&(i=window[a]),window[a]=bo(i,e,t,r),{gtagCore:i,wrappedGtag:window[a]}}function jo(e){const t=window.document.getElementsByTagName("script");for(const r of Object.values(t))if(r.src&&r.src.includes(Wn)&&r.src.includes(e))return r;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const So=30,To=1e3;class No{constructor(t={},r=To){this.throttleMetadata=t,this.intervalMillis=r}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,r){this.throttleMetadata[t]=r}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}}const _s=new No;function Co(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function ko(e){var t;const{appId:r,apiKey:s}=e,a={method:"GET",headers:Co(s)},i=ho.replace("{app-id}",r),o=await fetch(i,a);if(o.status!==200&&o.status!==304){let c="";try{const d=await o.json();!((t=d.error)===null||t===void 0)&&t.message&&(c=d.error.message)}catch{}throw xe.create("config-fetch-failed",{httpStatus:o.status,responseMessage:c})}return o.json()}async function Ao(e,t=_s,r){const{appId:s,apiKey:a,measurementId:i}=e.options;if(!s)throw xe.create("no-app-id");if(!a){if(i)return{measurementId:i,appId:s};throw xe.create("no-api-key")}const o=t.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new _o;return setTimeout(async()=>{c.abort()},uo),Ps({appId:s,apiKey:a,measurementId:i},o,c,t)}async function Ps(e,{throttleEndTimeMillis:t,backoffCount:r},s,a=_s){var i;const{appId:o,measurementId:c}=e;try{await Eo(s,t)}catch(d){if(c)return fe.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:o,measurementId:c};throw d}try{const d=await ko(e);return a.deleteThrottleMetadata(o),d}catch(d){const u=d;if(!Io(u)){if(a.deleteThrottleMetadata(o),c)return fe.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:o,measurementId:c};throw d}const l=Number((i=u==null?void 0:u.customData)===null||i===void 0?void 0:i.httpStatus)===503?tr(r,a.intervalMillis,So):tr(r,a.intervalMillis),p={throttleEndTimeMillis:Date.now()+l,backoffCount:r+1};return a.setThrottleMetadata(o,p),fe.debug(`Calling attemptFetch again in ${l} millis`),Ps(e,p,s,a)}}function Eo(e,t){return new Promise((r,s)=>{const a=Math.max(t-Date.now(),0),i=setTimeout(r,a);e.addEventListener(()=>{clearTimeout(i),s(xe.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function Io(e){if(!(e instanceof ns)||!e.customData)return!1;const t=Number(e.customData.httpStatus);return t===429||t===500||t===503||t===504}class _o{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}}async function Po(e,t,r,s,a){if(a&&a.global){e("event",r,s);return}else{const i=await t,o=Object.assign(Object.assign({},s),{send_to:i});e("event",r,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lo(){if($n())try{await ss()}catch(e){return fe.warn(xe.create("indexeddb-unavailable",{errorInfo:e==null?void 0:e.toString()}).message),!1}else return fe.warn(xe.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Ro(e,t,r,s,a,i,o){var c;const d=Ao(e);d.then(y=>{r[y.measurementId]=y.appId,e.options.measurementId&&y.measurementId!==e.options.measurementId&&fe.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${y.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(y=>fe.error(y)),t.push(d);const u=Lo().then(y=>{if(y)return s.getId()}),[l,p]=await Promise.all([d,u]);jo(i)||go(i,l.measurementId),a("js",new Date);const m=(c=o==null?void 0:o.config)!==null&&c!==void 0?c:{};return m[lo]="firebase",m.update=!0,p!=null&&(m[co]=p),a("config",l.measurementId,m),l.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(t){this.app=t}_delete(){return delete ut[this.app.options.appId],Promise.resolve()}}let ut={},vr=[];const yr={};let en="dataLayer",Do="gtag",xr,Ls,br=!1;function Mo(){const e=[];if(xa()&&e.push("This is a browser extension environment."),is()||e.push("Cookies are not available."),e.length>0){const t=e.map((s,a)=>`(${a+1}) ${s}`).join(" "),r=xe.create("invalid-analytics-context",{errorInfo:t});fe.warn(r.message)}}function $o(e,t,r){Mo();const s=e.options.appId;if(!s)throw xe.create("no-app-id");if(!e.options.apiKey)if(e.options.measurementId)fe.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw xe.create("no-api-key");if(ut[s]!=null)throw xe.create("already-exists",{id:s});if(!br){vo(en);const{wrappedGtag:i,gtagCore:o}=wo(ut,vr,yr,en,Do);Ls=i,xr=o,br=!0}return ut[s]=Ro(e,vr,yr,t,xr,en,r),new Oo(e)}function Bo(e=as()){e=Ot(e);const t=yt(e,It);return t.isInitialized()?t.getImmediate():Fo(e)}function Fo(e,t={}){const r=yt(e,It);if(r.isInitialized()){const a=r.getImmediate();if(ba(t,r.getOptions()))return a;throw xe.create("already-initialized")}return r.initialize({options:t})}function Uo(e,t,r,s){e=Ot(e),Po(Ls,ut[e.app.options.appId],t,r,s).catch(a=>fe.error(a))}const wr="@firebase/analytics",jr="0.10.8";function Ho(){De(new Me(It,(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),a=t.getProvider("installations-internal").getImmediate();return $o(s,a,r)},"PUBLIC")),De(new Me("analytics-internal",e,"PRIVATE")),We(wr,jr),We(wr,jr,"esm2017");function e(t){try{const r=t.getProvider(It).getImmediate();return{logEvent:(s,a,i)=>Uo(r,s,a,i)}}catch(r){throw xe.create("interop-component-reg-failed",{reason:r})}}}Ho();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zo=new Map,Wo={activated:!1,tokenObservers:[]};function je(e){return zo.get(e)||Object.assign({},Wo)}const Sr={RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(t,r,s,a,i){if(this.operation=t,this.retryPolicy=r,this.getWaitDuration=s,this.lowerBound=a,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=a,a>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(t){this.stop();try{this.pending=new nr,this.pending.promise.catch(r=>{}),await Go(this.getNextRun(t)),this.pending.resolve(),await this.pending.promise,this.pending=new nr,this.pending.promise.catch(r=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(r){this.retryPolicy(r)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(t){if(t)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const r=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),r}}}function Go(e){return new Promise(t=>{setTimeout(t,e)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qo={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},_t=new Rt("appCheck","AppCheck",qo);function Rs(e){if(!je(e).activated)throw _t.create("use-before-activation",{appName:e.name})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ko="firebase-app-check-database",Yo=1,Sn="firebase-app-check-store";let xt=null;function Jo(){return xt||(xt=new Promise((e,t)=>{try{const r=indexedDB.open(Ko,Yo);r.onsuccess=s=>{e(s.target.result)},r.onerror=s=>{var a;t(_t.create("storage-open",{originalErrorMessage:(a=s.target.error)===null||a===void 0?void 0:a.message}))},r.onupgradeneeded=s=>{const a=s.target.result;switch(s.oldVersion){case 0:a.createObjectStore(Sn,{keyPath:"compositeKey"})}}}catch(r){t(_t.create("storage-open",{originalErrorMessage:r==null?void 0:r.message}))}}),xt)}function Qo(e,t){return Xo(Zo(e),t)}async function Xo(e,t){const s=(await Jo()).transaction(Sn,"readwrite"),i=s.objectStore(Sn).put({compositeKey:e,value:t});return new Promise((o,c)=>{i.onsuccess=d=>{o()},s.onerror=d=>{var u;c(_t.create("storage-set",{originalErrorMessage:(u=d.target.error)===null||u===void 0?void 0:u.message}))}})}function Zo(e){return`${e.options.appId}-${e.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tn=new rs("@firebase/app-check");function Tr(e,t){return $n()?Qo(e,t).catch(r=>{Tn.warn(`Failed to write token to IndexedDB. Error: ${r}`)}):Promise.resolve()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ec={error:"UNKNOWN_ERROR"};function tc(e){return wa.encodeString(JSON.stringify(e),!1)}async function Nn(e,t=!1){const r=e.app;Rs(r);const s=je(r);let a=s.token,i;if(a&&!dt(a)&&(s.token=void 0,a=void 0),!a){const d=await s.cachedTokenPromise;d&&(dt(d)?a=d:await Tr(r,void 0))}if(!t&&a&&dt(a))return{token:a.token};let o=!1;try{s.exchangeTokenPromise||(s.exchangeTokenPromise=s.provider.getToken().finally(()=>{s.exchangeTokenPromise=void 0}),o=!0),a=await je(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"?Tn.warn(d.message):Tn.error(d),i=d}let c;return a?i?dt(a)?c={token:a.token,internalError:i}:c=Cr(i):(c={token:a.token},s.token=a,await Tr(r,a)):c=Cr(i),o&&ac(r,c),c}async function nc(e){const t=e.app;Rs(t);const{provider:r}=je(t);{const{token:s}=await r.getToken();return{token:s}}}function rc(e,t,r,s){const{app:a}=e,i=je(a),o={next:r,error:s,type:t};if(i.tokenObservers=[...i.tokenObservers,o],i.token&&dt(i.token)){const c=i.token;Promise.resolve().then(()=>{r({token:c.token}),Nr(e)}).catch(()=>{})}i.cachedTokenPromise.then(()=>Nr(e))}function Os(e,t){const r=je(e),s=r.tokenObservers.filter(a=>a.next!==t);s.length===0&&r.tokenRefresher&&r.tokenRefresher.isRunning()&&r.tokenRefresher.stop(),r.tokenObservers=s}function Nr(e){const{app:t}=e,r=je(t);let s=r.tokenRefresher;s||(s=sc(e),r.tokenRefresher=s),!s.isRunning()&&r.isTokenAutoRefreshEnabled&&s.start()}function sc(e){const{app:t}=e;return new Vo(async()=>{const r=je(t);let s;if(r.token?s=await Nn(e,!0):s=await Nn(e),s.error)throw s.error;if(s.internalError)throw s.internalError},()=>!0,()=>{const r=je(t);if(r.token){let s=r.token.issuedAtTimeMillis+(r.token.expireTimeMillis-r.token.issuedAtTimeMillis)*.5+3e5;const a=r.token.expireTimeMillis-5*60*1e3;return s=Math.min(s,a),Math.max(0,s-Date.now())}else return 0},Sr.RETRIAL_MIN_WAIT,Sr.RETRIAL_MAX_WAIT)}function ac(e,t){const r=je(e).tokenObservers;for(const s of r)try{s.type==="EXTERNAL"&&t.error!=null?s.error(t.error):s.next(t)}catch{}}function dt(e){return e.expireTimeMillis-Date.now()>0}function Cr(e){return{token:tc(ec),error:e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{constructor(t,r){this.app=t,this.heartbeatServiceProvider=r}_delete(){const{tokenObservers:t}=je(this.app);for(const r of t)Os(this.app,r.next);return Promise.resolve()}}function oc(e,t){return new ic(e,t)}function cc(e){return{getToken:t=>Nn(e,t),getLimitedUseToken:()=>nc(e),addTokenListener:t=>rc(e,"INTERNAL",t),removeTokenListener:t=>Os(e.app,t)}}const lc="@firebase/app-check",dc="0.8.8",uc="app-check",kr="app-check-internal";function hc(){De(new Me(uc,e=>{const t=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat");return oc(t,r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider(kr).initialize()})),De(new Me(kr,e=>{const t=e.getProvider("app-check").getImmediate();return cc(t)},"PUBLIC").setInstantiationMode("EXPLICIT")),We(lc,dc)}hc();const pc=(e,t)=>t.some(r=>e instanceof r);let Ar,Er;function mc(){return Ar||(Ar=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fc(){return Er||(Er=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ds=new WeakMap,Cn=new WeakMap,Ms=new WeakMap,tn=new WeakMap,Vn=new WeakMap;function gc(e){const t=new Promise((r,s)=>{const a=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{r(Ie(e.result)),a()},o=()=>{s(e.error),a()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(r=>{r instanceof IDBCursor&&Ds.set(r,e)}).catch(()=>{}),Vn.set(t,e),t}function vc(e){if(Cn.has(e))return;const t=new Promise((r,s)=>{const a=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{r(),a()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});Cn.set(e,t)}let kn={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return Cn.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Ms.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ie(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function yc(e){kn=e(kn)}function xc(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const s=e.call(nn(this),t,...r);return Ms.set(s,t.sort?t.sort():[t]),Ie(s)}:fc().includes(e)?function(...t){return e.apply(nn(this),t),Ie(Ds.get(this))}:function(...t){return Ie(e.apply(nn(this),t))}}function bc(e){return typeof e=="function"?xc(e):(e instanceof IDBTransaction&&vc(e),pc(e,mc())?new Proxy(e,kn):e)}function Ie(e){if(e instanceof IDBRequest)return gc(e);if(tn.has(e))return tn.get(e);const t=bc(e);return t!==e&&(tn.set(e,t),Vn.set(t,e)),t}const nn=e=>Vn.get(e);function $s(e,t,{blocked:r,upgrade:s,blocking:a,terminated:i}={}){const o=indexedDB.open(e,t),c=Ie(o);return s&&o.addEventListener("upgradeneeded",d=>{s(Ie(o.result),d.oldVersion,d.newVersion,Ie(o.transaction),d)}),r&&o.addEventListener("blocked",d=>r(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",u=>a(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}function rn(e,{blocked:t}={}){const r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",s=>t(s.oldVersion,s)),Ie(r).then(()=>{})}const wc=["get","getKey","getAll","getAllKeys","count"],jc=["put","add","delete","clear"],sn=new Map;function Ir(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(sn.get(t))return sn.get(t);const r=t.replace(/FromIndex$/,""),s=t!==r,a=jc.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(a||wc.includes(r)))return;const i=async function(o,...c){const d=this.transaction(o,a?"readwrite":"readonly");let u=d.store;return s&&(u=u.index(c.shift())),(await Promise.all([u[r](...c),a&&d.done]))[0]};return sn.set(t,i),i}yc(e=>({...e,get:(t,r,s)=>Ir(t,r)||e.get(t,r,s),has:(t,r)=>!!Ir(t,r)||e.has(t,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc="/firebase-messaging-sw.js",Tc="/firebase-cloud-messaging-push-scope",Bs="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Nc="https://fcmregistrations.googleapis.com/v1",Fs="google.c.a.c_id",Cc="google.c.a.c_l",kc="google.c.a.ts",Ac="google.c.a.e";var _r;(function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(_r||(_r={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var gt;(function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"})(gt||(gt={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ke(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ec(e){const t="=".repeat((4-e.length%4)%4),r=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),s=atob(r),a=new Uint8Array(s.length);for(let i=0;i<s.length;++i)a[i]=s.charCodeAt(i);return a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const an="fcm_token_details_db",Ic=5,Pr="fcm_token_object_Store";async function _c(e){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(an))return null;let t=null;return(await $s(an,Ic,{upgrade:async(s,a,i,o)=>{var c;if(a<2||!s.objectStoreNames.contains(Pr))return;const d=o.objectStore(Pr),u=await d.index("fcmSenderId").get(e);if(await d.clear(),!!u){if(a===2){const l=u;if(!l.auth||!l.p256dh||!l.endpoint)return;t={token:l.fcmToken,createTime:(c=l.createTime)!==null&&c!==void 0?c:Date.now(),subscriptionOptions:{auth:l.auth,p256dh:l.p256dh,endpoint:l.endpoint,swScope:l.swScope,vapidKey:typeof l.vapidKey=="string"?l.vapidKey:ke(l.vapidKey)}}}else if(a===3){const l=u;t={token:l.fcmToken,createTime:l.createTime,subscriptionOptions:{auth:ke(l.auth),p256dh:ke(l.p256dh),endpoint:l.endpoint,swScope:l.swScope,vapidKey:ke(l.vapidKey)}}}else if(a===4){const l=u;t={token:l.fcmToken,createTime:l.createTime,subscriptionOptions:{auth:ke(l.auth),p256dh:ke(l.p256dh),endpoint:l.endpoint,swScope:l.swScope,vapidKey:ke(l.vapidKey)}}}}}})).close(),await rn(an),await rn("fcm_vapid_details_db"),await rn("undefined"),Pc(t)?t:null}function Pc(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return typeof e.createTime=="number"&&e.createTime>0&&typeof e.token=="string"&&e.token.length>0&&typeof t.auth=="string"&&t.auth.length>0&&typeof t.p256dh=="string"&&t.p256dh.length>0&&typeof t.endpoint=="string"&&t.endpoint.length>0&&typeof t.swScope=="string"&&t.swScope.length>0&&typeof t.vapidKey=="string"&&t.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lc="firebase-messaging-database",Rc=1,vt="firebase-messaging-store";let on=null;function Us(){return on||(on=$s(Lc,Rc,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(vt)}}})),on}async function Oc(e){const t=Hs(e),s=await(await Us()).transaction(vt).objectStore(vt).get(t);if(s)return s;{const a=await _c(e.appConfig.senderId);if(a)return await Gn(e,a),a}}async function Gn(e,t){const r=Hs(e),a=(await Us()).transaction(vt,"readwrite");return await a.objectStore(vt).put(t,r),await a.done,t}function Hs({appConfig:e}){return e.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},me=new Rt("messaging","Messaging",Dc);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mc(e,t){const r=await Kn(e),s=zs(t),a={method:"POST",headers:r,body:JSON.stringify(s)};let i;try{i=await(await fetch(qn(e.appConfig),a)).json()}catch(o){throw me.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw me.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw me.create("token-subscribe-no-token");return i.token}async function $c(e,t){const r=await Kn(e),s=zs(t.subscriptionOptions),a={method:"PATCH",headers:r,body:JSON.stringify(s)};let i;try{i=await(await fetch(`${qn(e.appConfig)}/${t.token}`,a)).json()}catch(o){throw me.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw me.create("token-update-failed",{errorInfo:o})}if(!i.token)throw me.create("token-update-no-token");return i.token}async function Bc(e,t){const s={method:"DELETE",headers:await Kn(e)};try{const i=await(await fetch(`${qn(e.appConfig)}/${t}`,s)).json();if(i.error){const o=i.error.message;throw me.create("token-unsubscribe-failed",{errorInfo:o})}}catch(a){throw me.create("token-unsubscribe-failed",{errorInfo:a==null?void 0:a.toString()})}}function qn({projectId:e}){return`${Nc}/projects/${e}/registrations`}async function Kn({appConfig:e,installations:t}){const r=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${r}`})}function zs({p256dh:e,auth:t,endpoint:r,vapidKey:s}){const a={web:{endpoint:r,auth:t,p256dh:e}};return s!==Bs&&(a.web.applicationPubKey=s),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fc=7*24*60*60*1e3;async function Uc(e){const t=await zc(e.swRegistration,e.vapidKey),r={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:ke(t.getKey("auth")),p256dh:ke(t.getKey("p256dh"))},s=await Oc(e.firebaseDependencies);if(s){if(Wc(s.subscriptionOptions,r))return Date.now()>=s.createTime+Fc?Hc(e,{token:s.token,createTime:Date.now(),subscriptionOptions:r}):s.token;try{await Bc(e.firebaseDependencies,s.token)}catch(a){console.warn(a)}return Lr(e.firebaseDependencies,r)}else return Lr(e.firebaseDependencies,r)}async function Hc(e,t){try{const r=await $c(e.firebaseDependencies,t),s=Object.assign(Object.assign({},t),{token:r,createTime:Date.now()});return await Gn(e.firebaseDependencies,s),r}catch(r){throw r}}async function Lr(e,t){const s={token:await Mc(e,t),createTime:Date.now(),subscriptionOptions:t};return await Gn(e,s),s.token}async function zc(e,t){const r=await e.pushManager.getSubscription();return r||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ec(t)})}function Wc(e,t){const r=t.vapidKey===e.vapidKey,s=t.endpoint===e.endpoint,a=t.auth===e.auth,i=t.p256dh===e.p256dh;return r&&s&&a&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rr(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return Vc(t,e),Gc(t,e),qc(t,e),t}function Vc(e,t){if(!t.notification)return;e.notification={};const r=t.notification.title;r&&(e.notification.title=r);const s=t.notification.body;s&&(e.notification.body=s);const a=t.notification.image;a&&(e.notification.image=a);const i=t.notification.icon;i&&(e.notification.icon=i)}function Gc(e,t){t.data&&(e.data=t.data)}function qc(e,t){var r,s,a,i,o;if(!t.fcmOptions&&!(!((r=t.notification)===null||r===void 0)&&r.click_action))return;e.fcmOptions={};const c=(a=(s=t.fcmOptions)===null||s===void 0?void 0:s.link)!==null&&a!==void 0?a:(i=t.notification)===null||i===void 0?void 0:i.click_action;c&&(e.fcmOptions.link=c);const d=(o=t.fcmOptions)===null||o===void 0?void 0:o.analytics_label;d&&(e.fcmOptions.analyticsLabel=d)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kc(e){return typeof e=="object"&&!!e&&Fs in e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yc(e){if(!e||!e.options)throw cn("App Configuration Object");if(!e.name)throw cn("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:r}=e;for(const s of t)if(!r[s])throw cn(s);return{appName:e.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}}function cn(e){return me.create("missing-app-config-values",{valueName:e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(t,r,s){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const a=Yc(t);this.firebaseDependencies={app:t,appConfig:a,installations:r,analyticsProvider:s}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qc(e){try{e.swRegistration=await navigator.serviceWorker.register(Sc,{scope:Tc}),e.swRegistration.update().catch(()=>{})}catch(t){throw me.create("failed-service-worker-registration",{browserErrorMessage:t==null?void 0:t.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xc(e,t){if(!t&&!e.swRegistration&&await Qc(e),!(!t&&e.swRegistration)){if(!(t instanceof ServiceWorkerRegistration))throw me.create("invalid-sw-registration");e.swRegistration=t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zc(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=Bs)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ws(e,t){if(!navigator)throw me.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw me.create("permission-blocked");return await Zc(e,t==null?void 0:t.vapidKey),await Xc(e,t==null?void 0:t.serviceWorkerRegistration),Uc(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function el(e,t,r){const s=tl(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(s,{message_id:r[Fs],message_name:r[Cc],message_time:r[kc],message_device_time:Math.floor(Date.now()/1e3)})}function tl(e){switch(e){case gt.NOTIFICATION_CLICKED:return"notification_open";case gt.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nl(e,t){const r=t.data;if(!r.isFirebaseMessaging)return;e.onMessageHandler&&r.messageType===gt.PUSH_RECEIVED&&(typeof e.onMessageHandler=="function"?e.onMessageHandler(Rr(r)):e.onMessageHandler.next(Rr(r)));const s=r.data;Kc(s)&&s[Ac]==="1"&&await el(e,r.messageType,s)}const Or="@firebase/messaging",Dr="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl=e=>{const t=new Jc(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",r=>nl(t,r)),t},sl=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:s=>Ws(t,s)}};function al(){De(new Me("messaging",rl,"PUBLIC")),De(new Me("messaging-internal",sl,"PRIVATE")),We(Or,Dr),We(Or,Dr,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function il(){try{await ss()}catch{return!1}return typeof window<"u"&&$n()&&is()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(e=as()){return il().then(t=>{if(!t)throw me.create("unsupported-browser")},t=>{throw me.create("indexed-db-unsupported")}),yt(Ot(e),"messaging").getImmediate()}async function Wu(e,t){return e=Ot(e),Ws(e,t)}al();const cl={apiKey:void 0,authDomain:void 0,projectId:void 0,storageBucket:void 0,messagingSenderId:void 0,appId:void 0,measurementId:void 0},Yn=ja(cl);typeof window<"u"&&Bo(Yn);let ll;try{typeof window<"u"&&"serviceWorker"in navigator&&(ll=ol(Yn))}catch(e){console.warn("Firebase Messaging failed to initialize:",e)}new Promise(e=>{typeof window<"u"&&console.warn("App Check: VITE_RECAPTCHA_SITE_KEY is missing in .env"),e()});const Oe=os(Yn),dl="https://api.thegamut.in/api",re=ae.create({baseURL:dl,headers:{"Content-Type":"application/json"}}),ul=e=>new Promise(t=>setTimeout(t,e));re.interceptors.request.use(async e=>{const t=Oe.currentUser;if(t){const r=await t.getIdToken();e.headers&&(e.headers.Authorization=`Bearer ${r}`)}return e},e=>Promise.reject(e));re.interceptors.response.use(e=>e,async e=>{var a,i,o,c,d,u,l,p;const t=e.config;if(t._retryCount=t._retryCount||0,((a=e.response)==null?void 0:a.status)===401&&!t._retry){t._retry=!0;try{const m=Oe.currentUser;if(m){console.log(" Session expired. Refreshing token...");const y=await m.getIdToken(!0);return t.headers&&(t.headers.Authorization=`Bearer ${y}`),re(t)}}catch(m){if(console.error("Token refresh failed:",m),(m==null?void 0:m.code)!=="auth/network-request-failed"){try{await Oe.signOut()}catch{}window.location.href="/login"}return Promise.reject(m)}}if((((i=e.response)==null?void 0:i.status)===429||((o=e.response)==null?void 0:o.status)===503)&&t._retryCount<3){t._retryCount+=1;const m=t._retryCount*1e3;return console.log(` Rate Limited/Busy. Retrying in ${m}ms... (Attempt ${t._retryCount})`),await ul(m),re(t)}const r=((d=(c=e.response)==null?void 0:c.data)==null?void 0:d.message)||((l=(u=e.response)==null?void 0:u.data)==null?void 0:l.error)||e.message,s=new Error(r);return s.status=(p=e.response)==null?void 0:p.status,s.original=e,Promise.reject(s)});const Vs=async e=>re.get("/articles",{params:e}),hl=async(e,t)=>re.get("/articles/search",{params:{q:e,...t}}),Vu=async()=>re.get("/users/saved-articles"),Mr=async e=>(await re.post(`/users/saved-articles/${e}`)).data,Gu=async e=>(await re.get(`/articles/${e}/coverage`)).data,pl=async e=>re.get(`/cluster/${e}`),ml=()=>re.get("/profile/me"),fl=e=>re.post("/profile",e),qu=()=>re.delete("/profile"),gl=e=>re.post("/profile/save-token",{token:e}),vl=()=>re.post("/profile/upgrade-habit"),$t=(e,t)=>{try{const r=new CustomEvent("narrative-standard-log",{detail:{eventType:e,data:t}});window.dispatchEvent(r)}catch(r){console.warn("Analytics Dispatch Failed:",r)}return Promise.resolve()},yl=e=>$t("view_analysis",{articleId:e}),xl=e=>$t("view_comparison",{articleId:e}),bl=e=>$t("share_article",{articleId:e}),Ku=e=>$t("read_external",{articleId:e}),wl=()=>re.get("/trending"),Yu=e=>re.get("/emergency/contacts",{params:e}),$r=(e,t,r,s=!1)=>re.post("/tts/get-audio",{text:e,voiceId:t,articleId:r,prefetch:s}),jl=(e,t)=>{const r=new CustomEvent("narrative-standard-log",{detail:{eventType:"search",data:{query:e,sessionId:t}}});return window.dispatchEvent(r),Promise.resolve()},Gs=h.createContext(void 0);function Te(){const e=h.useContext(Gs);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e}function Sl({children:e}){const[t,r]=h.useState(null),[s,a]=h.useState(null),[i,o]=h.useState(!0);h.useEffect(()=>Sa(Oe,async l=>{if(l){r(l);try{const{data:p}=await ml();a(p)}catch(p){console.error("Profile fetch failed:",p),a(null)}}else r(null),a(null);o(!1)}),[]);const d={user:t,profile:s,loading:i,isGuest:!t,logout:()=>{Ta(Oe),r(null),a(null)},setProfile:a};return n.jsx(Gs.Provider,{value:d,children:!i&&e})}const Tl=({message:e,type:t,onClose:r,action:s})=>n.jsxs("div",{className:`ui-toast ${t}`,children:[n.jsx("span",{className:"ui-toast-message",children:e}),n.jsxs("div",{className:"ui-toast-actions",children:[s&&n.jsx("button",{onClick:a=>{a.stopPropagation(),s.onClick(),r()},className:"ui-toast-action-btn",children:s.label}),n.jsx("button",{onClick:r,className:"ui-toast-close",children:""})]})]});var ht;(function(e){e.Heavy="HEAVY",e.Medium="MEDIUM",e.Light="LIGHT"})(ht||(ht={}));var pt;(function(e){e.Success="SUCCESS",e.Warning="WARNING",e.Error="ERROR"})(pt||(pt={}));const Ye=st("Haptics",{web:()=>ue(()=>import("./web.BXF8r2TP.js"),__vite__mapDeps([6,1,2,3,4,5])).then(e=>new e.HapticsWeb)}),qe=()=>h.useCallback(async(t="light")=>{if(!_e.isNativePlatform()){typeof navigator<"u"&&navigator.vibrate&&(t==="error"?navigator.vibrate([50,50,50]):t==="success"?navigator.vibrate([30,50]):navigator.vibrate(10));return}try{switch(t){case"light":await Ye.impact({style:ht.Light});break;case"medium":await Ye.impact({style:ht.Medium});break;case"heavy":await Ye.impact({style:ht.Heavy});break;case"success":await Ye.notification({type:pt.Success});break;case"warning":await Ye.notification({type:pt.Warning});break;case"error":await Ye.notification({type:pt.Error});break}}catch{}},[]),qs=h.createContext(void 0);function Ne(){const e=h.useContext(qs);if(e===void 0)throw new Error("useToast must be used within a ToastProvider");return e}function Nl({children:e}){const[t,r]=h.useState([]),s=qe(),a=h.useCallback((o,c="info",d=null)=>{const u=Date.now();s(c==="success"?"success":c==="error"?"error":"light"),r([{id:u,message:o,type:c,action:d}]),setTimeout(()=>{r(l=>l.filter(p=>p.id!==u))},4e3)},[s]),i=o=>{r(c=>c.filter(d=>d.id!==o))};return n.jsxs(qs.Provider,{value:{addToast:a},children:[e,n.jsx("div",{className:"toast-container",children:t.map(o=>n.jsx(Tl,{message:o.message,type:o.type,action:o.action,onClose:()=>i(o.id)},o.id))})]})}const I="https://res.cloudinary.com/dphvvutwj/video/upload/the-gamut-audio",Br={OPENERS:{MIRA:{MORNING:[`${I}/mira_open_morn_1.mp3`,`${I}/mira_open_morn_2.mp3`,`${I}/mira_open_morn_3.mp3`],AFTERNOON:[`${I}/mira_open_aft_1.mp3`,`${I}/mira_open_aft_2.mp3`,`${I}/mira_open_aft_3.mp3`],EVENING:[`${I}/mira_open_eve_1.mp3`,`${I}/mira_open_eve_2.mp3`,`${I}/mira_open_eve_3.mp3`]},RAJAT:{MORNING:[`${I}/rajat_open_morn_1.mp3`,`${I}/rajat_open_morn_2.mp3`,`${I}/rajat_open_morn_3.mp3`],AFTERNOON:[`${I}/rajat_open_aft_1.mp3`,`${I}/rajat_open_aft_2.mp3`,`${I}/rajat_open_aft_3.mp3`],EVENING:[`${I}/rajat_open_eve_1.mp3`,`${I}/rajat_open_eve_2.mp3`,`${I}/rajat_open_eve_3.mp3`]},SHUBHI:{MORNING:[`${I}/shubhi_open_morn_1.mp3`,`${I}/shubhi_open_morn_2.mp3`,`${I}/shubhi_open_morn_3.mp3`],AFTERNOON:[`${I}/shubhi_open_aft_1.mp3`,`${I}/shubhi_open_aft_2.mp3`,`${I}/shubhi_open_aft_3.mp3`],EVENING:[`${I}/shubhi_open_eve_1.mp3`,`${I}/shubhi_open_eve_2.mp3`,`${I}/shubhi_open_eve_3.mp3`]}},SEGUES:{MIRA:[`${I}/mira_segue_01.mp3`,`${I}/mira_segue_02.mp3`,`${I}/mira_segue_03.mp3`,`${I}/mira_segue_04.mp3`,`${I}/mira_segue_05.mp3`,`${I}/mira_segue_06.mp3`,`${I}/mira_segue_07.mp3`,`${I}/mira_segue_08.mp3`,`${I}/mira_segue_09.mp3`,`${I}/mira_segue_10.mp3`],RAJAT:[`${I}/rajat_segue_01.mp3`,`${I}/rajat_segue_02.mp3`,`${I}/rajat_segue_03.mp3`,`${I}/rajat_segue_04.mp3`,`${I}/rajat_segue_05.mp3`,`${I}/rajat_segue_06.mp3`,`${I}/rajat_segue_07.mp3`,`${I}/rajat_segue_08.mp3`,`${I}/rajat_segue_09.mp3`,`${I}/rajat_segue_10.mp3`],SHUBHI:[`${I}/shubhi_segue_01.mp3`,`${I}/shubhi_segue_02.mp3`,`${I}/shubhi_segue_03.mp3`,`${I}/shubhi_segue_04.mp3`,`${I}/shubhi_segue_05.mp3`,`${I}/shubhi_segue_06.mp3`,`${I}/shubhi_segue_07.mp3`,`${I}/shubhi_segue_08.mp3`,`${I}/shubhi_segue_09.mp3`,`${I}/shubhi_segue_10.mp3`]}},bt={ANCHOR:{id:"SmLgXu8CcwHJvjiqq2rw",name:"Mira",role:"The Anchor"},ANALYST:{id:"SZQ4R1VKS2t6wmBJpK5H",name:"Rajat",role:"The Analyst"},CURATOR:{id:"2n8AzqIsQUPMvb1OgO72",name:"Shubhi",role:"The Curator"}},Cl=e=>{const[t,r]=h.useState([]),[s,a]=h.useState(-1),[i,o]=h.useState(null),[c,d]=h.useState(!1),[u,l]=h.useState(!1),[p,m]=h.useState(!1),[y,S]=h.useState(0),[w,k]=h.useState(0),[N,j]=h.useState(1),[b,f]=h.useState(null),[T,_]=h.useState(!1),[g,v]=h.useState(!1),[P,O]=h.useState(0),[F,U]=h.useState(!1),z=h.useRef(new Audio),Y=h.useRef(new Set),M=h.useRef({}),L=h.useRef(null),$=h.useRef(0),W=h.useRef(!1),R=(x,B)=>{if(!B)return;const q=new CustomEvent("narrative-audio-event",{detail:{action:x,articleId:B}});window.dispatchEvent(q)},C=x=>!x||!x.includes("cloudinary")?x:x.replace("/upload/","/upload/br_64k/"),E=h.useCallback(x=>{if(!x)return bt.ANCHOR;const B=x.toLowerCase();return B.includes("economy")||B.includes("business")||B.includes("tech")||B.includes("science")||B.includes("finance")||B.includes("crypto")?bt.ANALYST:B.includes("entertainment")||B.includes("lifestyle")||B.includes("culture")||B.includes("human")||B.includes("gaming")||B.includes("sports")?bt.CURATOR:bt.ANCHOR},[]),A=x=>{if(!x)return .9;switch(x){case"Rajat":return 1;case"Shubhi":return 1.1;case"Mira":return .9;default:return .9}},Q=(x,B)=>{const q=x||"News Update",G=B||"Content currently unavailable.";return`${q.replace(/[.]+$/,"")}. . . . . . ${G}`},J=x=>{const B=`lastRadioSession_${x}`,q=localStorage.getItem(B),G=Date.now(),se=30*60*1e3;if(localStorage.setItem(B,G.toString()),q){const te=parseInt(q);if(G-te<se)return!1}return!0},ee=x=>{var Se;const B=E(x.category),q=B.name.toUpperCase(),G=new Date().getHours();let se="MORNING";G>=12&&G<17&&(se="AFTERNOON"),(G>=17||G<5)&&(se="EVENING");const te=(Se=Br.OPENERS[q])==null?void 0:Se[se];if(!te||te.length===0)return null;const ye=te[Math.floor(Math.random()*te.length)];return{_id:"greeting_track",headline:`${se==="MORNING"?"Good Morning":se==="AFTERNOON"?"Good Afternoon":"Good Evening"} from ${B.name}`,summary:"Session Opener",isSystemAudio:!0,audioUrl:ye,speaker:B,category:"System"}},ge=h.useCallback(x=>{var q;const B=[];for(let G=0;G<x.length;G++)if(B.push(x[G]),G<x.length-1){const se=x[G],te=x[G+1];if(se.isSystemAudio||te.isSystemAudio)continue;const ye=E(se.category),Se=E(te.category);if(ye.name===Se.name){const Wt=ye.name.toUpperCase(),Fe=(q=Br.SEGUES)==null?void 0:q[Wt];if(Fe&&Fe.length>0){const ca=Fe[Math.floor(Math.random()*Fe.length)];B.push({_id:`segue_${se._id}_to_${te._id}`,headline:"Transition",summary:"Segue",isSystemAudio:!0,audioUrl:ca,speaker:ye,category:"System"})}}}return B},[E]),X=h.useCallback(()=>{z.current.pause(),z.current.currentTime=0,d(!1),l(!1),m(!1),_(!1),v(!1),U(!1),L.current&&clearInterval(L.current),o(null),a(-1),r([]),k(0),S(0),$.current=0,Y.current.clear(),Object.values(M.current).forEach(x=>URL.revokeObjectURL(x)),M.current={},"mediaSession"in navigator&&(navigator.mediaSession.playbackState="none")},[]),Z=h.useCallback(()=>{L.current&&clearInterval(L.current),v(!1),O(0),!W.current&&t[s]&&R("skip",t[s]._id),W.current=!1,U(!1),a(x=>x+1)},[s,t]),ve=h.useCallback(async x=>{var B;if(x){m(!0),d(!0),l(!1),o(x),_(!0),v(!1),k(0),S(0),R("start",x._id);try{const q=x.isSystemAudio?x.speaker:E(x.category);f(q);const G=z.current;if(M.current[x._id])G.src=M.current[x._id];else if(x.isSystemAudio&&x.audioUrl)G.src=C(x.audioUrl)||"";else if(x.audioUrl)G.src=C(x.audioUrl)||"";else{const ye=Q(x.headline,x.summary),Se=await $r(ye,q.id,x._id,!1);if(Se.data&&Se.data.audioUrl)G.src=C(Se.data.audioUrl)||"";else throw new Error(`No audio URL received for ${x._id}`)}const se=A(q.name);G.playbackRate=se*N,await G.play(),x.isSystemAudio||($.current=0),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:x.headline||"Narrative News",artist:`The Gamut  ${q.name}`,artwork:x.imageUrl?[{src:x.imageUrl,sizes:"512x512",type:"image/jpeg"}]:[]}),navigator.mediaSession.playbackState="playing");const te=(B=t[s-1])==null?void 0:B._id;te&&M.current[te]&&(URL.revokeObjectURL(M.current[te]),delete M.current[te],Y.current.delete(te))}catch(q){if(console.error("Radio Playback Error:",q),q.name==="NotAllowedError"){console.warn("Autoplay blocked. Stopping radio."),X();return}$.current+=1,$.current>=3?(console.error("Too many consecutive failures. Stopping."),X()):(console.log(`Skipping due to error (Attempt ${$.current}/3)`),setTimeout(()=>{Z()},1e3)),m(!1)}}},[N,E,s,t,Z,X]),Be=h.useCallback(()=>{if(z.current.currentTime>3){z.current.currentTime=0;return}a(x=>Math.max(0,x-1))},[]),H=h.useCallback(()=>{z.current.pause(),l(!0),i&&R("pause",i._id),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused")},[i]),K=h.useCallback(()=>{z.current.play(),l(!1),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="playing")},[]),Ce=h.useCallback(x=>{z.current&&(z.current.currentTime=x,k(x))},[]),ot=h.useCallback(x=>{if(j(x),z.current&&b){const B=A(b.name);z.current.playbackRate=B*x}},[b]),ia=h.useCallback(async(x,B=0,q={})=>{if(!x||x.length===0)return;X();const G=x.slice(B),se=ge(G);let te=se;const ye=(e==null?void 0:e.uid)||"guest",Se=J(ye);if(!q.skipGreeting&&Se){const Wt=x[B],Fe=ee(Wt);Fe&&(te=[Fe,...se])}r(te),$.current=0,U(!!q.enableFirstTimer),a(0)},[ge,X,e]),oa=h.useCallback(()=>{v(!1),L.current&&clearInterval(L.current),X()},[X]);return h.useEffect(()=>{if(s>=0&&t.length>0)if(s<t.length){const x=t[s],B=x.isSystemAudio&&x.summary==="Segue"?500:0;if(B>0){m(!0);const q=setTimeout(()=>ve(x),B);return()=>clearTimeout(q)}else ve(x)}else X()},[s,t,ve,X]),h.useEffect(()=>{if(s>=0&&s<t.length-1){const x=t[s+1];if(!x||x.isSystemAudio||Y.current.has(x._id))return;Y.current.add(x._id);const B=E(x.category),q=Q(x.headline,x.summary);$r(q,B.id,x._id,!0).catch(G=>console.warn(`Prefetch failed for ${x._id}`,G))}},[s,t,E]),h.useEffect(()=>{const x=z.current,B=()=>k(x.currentTime),q=()=>S(x.duration),G=()=>m(!0),se=()=>{m(!1),d(!0)},te=()=>{if(W.current=!0,i&&R("complete",i._id),F){v(!0),O(3);let ye=3;L.current=setInterval(()=>{ye--,O(ye),ye<=0&&(L.current&&clearInterval(L.current),v(!1),Z())},1e3)}else Z()};return x.addEventListener("timeupdate",B),x.addEventListener("durationchange",q),x.addEventListener("loadstart",G),x.addEventListener("playing",se),x.addEventListener("ended",te),()=>{x.removeEventListener("timeupdate",B),x.removeEventListener("durationchange",q),x.removeEventListener("loadstart",G),x.removeEventListener("playing",se),x.removeEventListener("ended",te),L.current&&clearInterval(L.current)}},[Z,F,i]),{currentArticle:i,currentSpeaker:b,isPlaying:c,isPaused:u,isLoading:p,isVisible:T,isWaitingForNext:g,autoplayTimer:P,currentTime:w,duration:y,playbackRate:N,startRadio:ia,stop:X,pause:H,resume:K,playNext:Z,playPrevious:Be,seekTo:Ce,changeSpeed:ot,cancelAutoplay:oa}},Ks=h.createContext(void 0),Ys=()=>{const e=h.useContext(Ks);if(!e)throw new Error("useAudio must be used within AudioProvider");return e},kl=({children:e})=>{const{user:t}=Te(),r=Cl(t);return n.jsx(Ks.Provider,{value:r,children:e})},Js=h.createContext(void 0),Al=()=>{const e=h.useContext(Js);if(!e)throw new Error("usePlayerUI must be used within PlayerUIProvider");return e},El=({children:e})=>{const[t,r]=h.useState(!1),s=h.useCallback(()=>r(!0),[]),a=h.useCallback(()=>r(!1),[]),i=h.useCallback(()=>r(c=>!c),[]),o={playerOpen:t,openPlayer:s,closePlayer:a,togglePlayer:i};return n.jsx(Js.Provider,{value:o,children:e})},Bt=()=>{const e=Ys(),t=Al(),r=he.useContext(Qs);if(!r)throw new Error("useRadio must be used within RadioProvider");const s=(o,c,d)=>{const u=o||r.queue;let l=c;if(l===void 0||l===-1){if(r.visibleArticleId){const p=u.findIndex(m=>m._id===r.visibleArticleId);p!==-1&&(l=p)}(l===void 0||l===-1)&&(l=0)}t.openPlayer(),e.startRadio(u,l,d)};return{...e,...t,startRadio:s,stop:()=>{t.closePlayer(),e.stop()},playSingle:o=>{const c=r.queue.findIndex(d=>d._id===o._id);c!==-1?s(r.queue,c,{skipGreeting:!0,enableFirstTimer:!0}):s([o],0,{skipGreeting:!0,enableFirstTimer:!0})},contextQueue:r.queue,contextLabel:r.label,updateContextQueue:r.updateQueue,visibleArticleId:r.visibleArticleId,updateVisibleArticle:r.updateVisibleArticle}},Qs=he.createContext(null),Il=({children:e})=>{const[t,r]=h.useState([]),[s,a]=h.useState("Latest News"),[i,o]=h.useState(null),c=h.useRef(0),d=h.useCallback(l=>{const p=Date.now();p-c.current>500&&(o(l),c.current=p)},[]),u=h.useCallback((l,p)=>{r(m=>l.length!==m.length?l:l.every((S,w)=>{var k;return S._id===((k=m[w])==null?void 0:k._id)})?m:l),a(m=>m===p?m:p)},[]);return n.jsx(Qs.Provider,{value:{queue:t,label:s,updateQueue:u,visibleArticleId:i,updateVisibleArticle:d},children:n.jsx(kl,{children:n.jsx(El,{children:e})})})},_l=e=>{const t=rt(),r=_e.isNativePlatform();return h.useEffect(()=>!r||!e?void 0:((async()=>{const{PushNotifications:a}=await ue(async()=>{const{PushNotifications:o}=await import("./index.B9SqF2Xj.js");return{PushNotifications:o}},__vite__mapDeps([7,1,2,3,4,5])),{Geolocation:i}=await ue(async()=>{const{Geolocation:o}=await import("./index.DLB16yvK.js");return{Geolocation:o}},__vite__mapDeps([8,1,2,3,4,5]));try{const o=await a.checkPermissions();o.receive==="prompt"&&await a.requestPermissions(),o.receive==="granted"&&await a.register(),await a.removeAllListeners(),await a.addListener("registration",c=>{console.log("Push Registration Token:",c.value),gl(c.value).catch(d=>console.error("Token Save Error",d))}),await a.addListener("pushNotificationActionPerformed",c=>{const d=c.notification.data;d&&d.articleId&&t(`/?article=${d.articleId}`)})}catch(o){console.warn("Push Notification setup failed:",o)}try{await i.checkPermissions()}catch{}})(),()=>{}),[r,e,t]),{isNative:r}},ce={HEARTBEAT_INTERVAL:3e4,SAMPLING_INTERVAL:1e3,BATCH_THRESHOLD:10,API_URL:"http://localhost:5000/api",TIMEOUTS:{AUDIO_MODE:12e5,FEED_MODE:15e3,READING_MODE:6e4,NARRATIVE_MODE:12e4,CURSOR_IDLE:6e4},VELOCITY:{READING_MAX:.05},FLOW:{THRESHOLD_MS:3e5,VELOCITY_MAX:.03,GRACE_PERIOD_MS:5e3},CONFUSION:{SCROLL_UP_THRESHOLD:300,ABANDONMENT_THRESHOLD:3,REFERENCE_DEPTH_THRESHOLD:30},SKIMMING:{MAX_WPM:800}},Pl=(e,t,r)=>{const s=h.useRef(!1);h.useEffect(()=>{if(!e.current.sessionId){const a=sessionStorage.getItem("current_analytics_session_id");if(a)e.current.sessionId=a;else{const i=Date.now().toString(36)+Math.random().toString(36).substring(2);e.current.sessionId=i,sessionStorage.setItem("current_analytics_session_id",i)}}e.current.maxScroll=0,e.current.confusionCount=0,e.current.tempUpScroll=0,e.current.scrollDirection="steady",e.current.flowGraceCounter=0},[]),h.useEffect(()=>{t&&e.current.sessionId&&!e.current.hasStitchedSession&&(fetch(`${ce.API_URL}/analytics/link-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e.current.sessionId,userId:t.uid}),keepalive:!0}).catch(a=>console.warn("Session Stitching Failed",a)),e.current.hasStitchedSession=!0)},[t]),h.useEffect(()=>{const a=setInterval(()=>{const i=e.current;i.isTabActive&&i.isActive&&i.scrollVelocity<ce.FLOW.VELOCITY_MAX?(i.flowGraceCounter=0,i.currentFlowDuration+=1e3,i.currentFlowDuration>=ce.FLOW.THRESHOLD_MS&&(i.isFlowing=!0,i.totalFlowDuration+=1)):i.isFlowing||i.currentFlowDuration>0?(i.flowGraceCounter+=1e3,i.flowGraceCounter>ce.FLOW.GRACE_PERIOD_MS&&(i.currentFlowDuration=0,i.isFlowing=!1,i.flowGraceCounter=0)):(i.currentFlowDuration=0,i.isFlowing=!1),s.current!==i.isFlowing&&(s.current=i.isFlowing,r&&r(i.isFlowing))},1e3);return()=>clearInterval(a)},[r])},Ll=(e,t)=>{const r=h.useRef(null),s=h.useRef(window.scrollY),a=h.useCallback(()=>{t()},[t]);h.useEffect(()=>{const i=()=>{const o=window.scrollY;if(o!==s.current){const c=Date.now(),d=c-e.current.lastScrollTime;if(d>50){const u=o-e.current.lastScrollTop,l=Math.abs(u),p=l/d;if(e.current.scrollVelocity=p,p>0&&p<5){const S=e.current.velocitySamples||0,w=e.current.avgVelocity||0;e.current.avgVelocity=(w*S+p)/(S+1),e.current.velocitySamples=S+1}const m=document.documentElement.scrollHeight-window.innerHeight,y=m>0?Math.round(o/m*100):0;u<0?(e.current.scrollDirection="up",y<ce.CONFUSION.REFERENCE_DEPTH_THRESHOLD?(e.current.tempUpScroll+=l,e.current.tempUpScroll>ce.CONFUSION.SCROLL_UP_THRESHOLD&&(e.current.confusionCount+=1,e.current.tempUpScroll=0)):e.current.tempUpScroll=0):u>0?(e.current.scrollDirection="down",e.current.tempUpScroll=0):e.current.scrollDirection="steady",e.current.lastScrollTop=o,e.current.lastScrollTime=c,y>e.current.maxScroll&&(e.current.maxScroll=y)}s.current=o}r.current=requestAnimationFrame(i)};return r.current=requestAnimationFrame(i),window.addEventListener("scroll",a,{passive:!0}),()=>{r.current&&cancelAnimationFrame(r.current),window.removeEventListener("scroll",a)}},[a])},Rl=(e,t,r)=>{h.useEffect(()=>{if(!t)return;const s=new Map,a=new IntersectionObserver(o=>{const c=Date.now();o.forEach(d=>{let u=d.target.getAttribute("data-track-id");if(!u){const l=d.target.getBoundingClientRect(),p=document.documentElement.scrollHeight,m=window.scrollY+l.top;if(p>0){const y=m/p;u=`zone-${Math.min(Math.ceil(y*10),10)}`}}if(u)if(d.isIntersecting)s.set(u,c),e.current.lastVisibleElementId=u;else{const l=s.get(u);if(l){const p=(c-l)/1e3;e.current.heatmap[u]=(e.current.heatmap[u]||0)+p,s.delete(u)}}})},{threshold:.5}),i=document.querySelectorAll("[data-track-id]");return i.length===0?document.querySelectorAll("section, p").forEach(c=>a.observe(c)):i.forEach(o=>a.observe(o)),()=>{a.disconnect(),s.clear()}},[t,r])},Je="analytics_offline_queue",Ft=(e,t,r,s)=>{const a=ga(),{isPlaying:i}=Ys(),{user:o}=Te(),{addToast:c}=Ne(),d=typeof e=="string"?e:void 0,u=typeof t=="string"&&["article","narrative","feed"].includes(t)?t:void 0,l=h.useRef({sessionId:"",accumulatedTime:{total:0,article:0,radio:0,narrative:0,feed:0},quarters:[0,0,0,0],lastPingTime:Date.now(),isActive:!0,lastActiveInteraction:Date.now(),idleTimer:null,maxScroll:0,cachedWordCount:0,hasStitchedSession:!1,pendingInteractions:[],lastScrollTop:0,lastScrollTime:Date.now(),scrollVelocity:0,scrollDirection:"steady",confusionCount:0,tempUpScroll:0,avgVelocity:0,velocitySamples:0,tabSwitchCount:0,isTabActive:!0,lastCursorMove:Date.now(),currentFlowDuration:0,totalFlowDuration:0,isFlowing:!1,flowGraceCounter:0,lastVisibleElementId:void 0,heatmap:{}}),p=h.useRef({target:null,count:0,timestamp:0}),m=h.useRef(0),y=h.useRef(0),S=h.useRef("standard"),w=h.useCallback(()=>{const j=Date.now();if(j-m.current<500)return;m.current=j,l.current.lastActiveInteraction=j,l.current.lastCursorMove=j,l.current.isActive||(l.current.isActive=!0,l.current.lastPingTime=j),l.current.idleTimer&&clearTimeout(l.current.idleTimer);let b=ce.TIMEOUTS.READING_MODE;i?b=ce.TIMEOUTS.AUDIO_MODE:u==="feed"?b=ce.TIMEOUTS.FEED_MODE:u==="narrative"&&(b=ce.TIMEOUTS.NARRATIVE_MODE),l.current.idleTimer=setTimeout(()=>{l.current.isActive=!1},b)},[i,u]);h.useEffect(()=>{if(!("ontouchstart"in window))return;let j=0;const b=T=>{j=T.touches[0].clientY,w()},f=T=>{const _=T.touches[0].clientY,g=Math.abs(_-j);g<10&&g>0&&(l.current.lastCursorMove=Date.now()),j=_};return window.addEventListener("touchstart",b,{passive:!0}),window.addEventListener("touchmove",f,{passive:!0}),()=>{window.removeEventListener("touchstart",b),window.removeEventListener("touchmove",f)}},[w]),Pl(l,o,s),Ll(l,w),Rl(l,d,a.pathname);const k=j=>{if(S.current!==j){S.current=j;const b=new CustomEvent("narrative-cognitive-change",{detail:{state:j}});window.dispatchEvent(b)}};h.useEffect(()=>{if(!d||!u)return;const j=setInterval(()=>{const b=Date.now(),f=l.current;f.confusionCount>=ce.CONFUSION.ABANDONMENT_THRESHOLD?(k("confusion"),b-y.current>3e5&&(c("Short on time? You can save this to your Smart Brief for later.","info"),f.pendingInteractions.push({contentType:"ui_interaction",contentId:d,text:"INTERVENTION:SAVED_SUGGESTION",timestamp:new Date}),f.confusionCount=0,y.current=b)):f.accumulatedTime.total>300&&f.avgVelocity>0&&f.avgVelocity<.01?(k("fatigue"),b-y.current>6e5&&r&&(r("trigger_palate_cleanser"),f.pendingInteractions.push({contentType:"ui_interaction",contentId:d,text:"INTERVENTION:FATIGUE_DETECTED",timestamp:new Date}),y.current=b)):f.isFlowing?k("flow"):k("standard")},2e3);return()=>clearInterval(j)},[d,u,c,r]),h.useEffect(()=>{if(d&&(u==="article"||u==="narrative")){const j=setTimeout(()=>{const f=(document.getElementById("narrative-content")||document.getElementById("article-content")||document.body).innerText||"";l.current.cachedWordCount=f.split(/\s+/).length},1500);return()=>clearTimeout(j)}else l.current.cachedWordCount=0;l.current.quarters=[0,0,0,0],l.current.heatmap={},l.current.lastScrollTop=window.scrollY,l.current.tabSwitchCount=0,l.current.currentFlowDuration=0,l.current.totalFlowDuration=0,l.current.flowGraceCounter=0,l.current.accumulatedTime.article=0,l.current.accumulatedTime.narrative=0,l.current.avgVelocity=0,l.current.velocitySamples=0,l.current.confusionCount=0,y.current=0,k("standard")},[d,u]);const N=h.useCallback((j=!1,b=!1)=>{const f=Date.now(),T=Math.round((f-l.current.lastPingTime)/1e3);if(!b&&(T<=0||!l.current.isActive)){l.current.lastPingTime=f;return}const _=window.location.pathname,g=u==="article"||_.includes("/article/"),v=u==="narrative"||_.includes("/narrative/"),P=i,O=u==="feed"||!g&&!v;g&&(l.current.accumulatedTime.article+=T),v&&(l.current.accumulatedTime.narrative+=T),P&&(l.current.accumulatedTime.radio+=T),l.current.accumulatedTime.total+=T;const F={total:T,article:g?T:0,narrative:v?T:0,radio:P?T:0,feed:O?T:0},U=[...l.current.pendingInteractions];l.current.pendingInteractions=[];const z=[...l.current.quarters];l.current.quarters=[0,0,0,0];const Y={...l.current.heatmap};l.current.heatmap={};const M=l.current.totalFlowDuration;l.current.totalFlowDuration=0;const L=Intl.DateTimeFormat().resolvedOptions().timeZone;if(d){const C=100-l.current.tabSwitchCount*10,E=Math.max(0,C);let A="unknown";const Q=g?l.current.accumulatedTime.article:l.current.accumulatedTime.narrative,J=l.current.cachedWordCount;if(J>100&&Q>0){const ee=J/Q*60;l.current.maxScroll<50?A="partial":ee>ce.SKIMMING.MAX_WPM?A="skimmed":A="read"}U.push({contentType:u||(g?"article":"narrative"),contentId:d,duration:T,scrollDepth:l.current.maxScroll,wordCount:l.current.cachedWordCount,quarters:z,scrollPosition:Math.round(l.current.lastScrollTop),focusScore:E,heatmap:Y,flowDuration:M,dropOffElement:l.current.lastVisibleElementId,avgVelocity:l.current.avgVelocity,readConfidence:A,timestamp:new Date})}const $={sessionId:l.current.sessionId,userId:o==null?void 0:o.uid,metrics:F,interactions:U,meta:{platform:"web",userAgent:navigator.userAgent,referrer:document.referrer||"direct",timezone:L}},W=`${ce.API_URL}/analytics/track`,R=C=>{if(j){const E=new Blob([JSON.stringify(C)],{type:"application/json"});navigator.sendBeacon(W,E)}else fetch(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C),keepalive:!0}).then(E=>E.json()).then(E=>{E!=null&&E.command&&(E.command==="trigger_palate_cleanser"&&c("Take a breath. You've been reading a lot of heavy content lately.","info"),r&&r(E.command))}).catch(E=>{console.warn("Analytics Error, queueing:",E);try{const A=JSON.parse(localStorage.getItem(Je)||"[]");A.push(C),localStorage.setItem(Je,JSON.stringify(A))}catch{}})};if(navigator.onLine)R($);else try{const C=JSON.parse(localStorage.getItem(Je)||"[]");C.push($),localStorage.setItem(Je,JSON.stringify(C))}catch{}l.current.lastPingTime=f},[d,u,i,o==null?void 0:o.uid,c,r]);return h.useEffect(()=>{const j=()=>{if(!navigator.onLine)return;const T=localStorage.getItem(Je);if(T){const _=JSON.parse(T);_.length>0&&(_.forEach(g=>{fetch(`${ce.API_URL}/analytics/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}).catch(console.error)}),localStorage.removeItem(Je))}};window.addEventListener("online",j),j();const b=setInterval(()=>{if(!l.current.isActive||document.hidden||Date.now()-l.current.lastCursorMove>ce.TIMEOUTS.CURSOR_IDLE&&!i)return;if(l.current.scrollVelocity<ce.VELOCITY.READING_MAX){const g=window.scrollY,v=document.documentElement.scrollHeight-window.innerHeight;if(v>0){const P=g/v,O=Math.min(Math.floor(P*4),3);l.current.quarters[O]++}else l.current.quarters[0]++}},ce.SAMPLING_INTERVAL),f=setInterval(()=>{N(!1)},ce.HEARTBEAT_INTERVAL);return()=>{clearInterval(b),clearInterval(f),window.removeEventListener("online",j)}},[N,i]),h.useEffect(()=>{const j=()=>{var O;const P=(O=window.getSelection())==null?void 0:O.toString();if(P&&P.length>10){const F=P.substring(0,200);l.current.pendingInteractions.push({contentType:"copy",contentId:d||"unknown",text:F,timestamp:new Date}),N(!1,!0)}},b=P=>{w();const O=P.target,F=Date.now();p.current.target===O&&F-p.current.timestamp<1e3?(p.current.count++,p.current.count===3&&l.current.pendingInteractions.push({contentType:"ui_interaction",contentId:d||"global",text:"RAGE_CLICK",timestamp:new Date})):p.current={target:O,count:1,timestamp:F};const U=O.closest("[data-track-click]");if(U){const z=U.getAttribute("data-track-click");l.current.pendingInteractions.push({contentType:"ui_interaction",contentId:d||"global",text:z||"unknown_click",timestamp:new Date})}},f=P=>{const{action:O,articleId:F}=P.detail;l.current.pendingInteractions.push({contentType:"audio_action",contentId:F,audioAction:O,timestamp:new Date})},T=P=>{const{itemId:O,itemType:F,category:U}=P.detail;l.current.pendingInteractions.push({contentType:"impression",contentId:O,text:`${F}:${U}`,timestamp:new Date})},_=P=>{const{eventType:O,data:F}=P.detail;l.current.pendingInteractions.push({contentType:O,contentId:F.articleId||F.contentId||"unknown",query:F.query,...F,timestamp:new Date}),l.current.pendingInteractions.length>=ce.BATCH_THRESHOLD&&N(!1,!0)},g=()=>{document.hidden?(l.current.isTabActive=!1,l.current.tabSwitchCount++,N(!0)):(l.current.isTabActive=!0,l.current.lastActiveInteraction=Date.now())},v=["mousedown","keydown","touchstart"];return v.forEach(P=>window.addEventListener(P,w,{passive:!0})),window.addEventListener("copy",j),window.addEventListener("click",b),window.addEventListener("narrative-audio-event",f),window.addEventListener("narrative-impression",T),window.addEventListener("narrative-standard-log",_),document.addEventListener("visibilitychange",g),window.addEventListener("beforeunload",()=>N(!0)),()=>{v.forEach(P=>window.removeEventListener(P,w)),window.removeEventListener("copy",j),window.removeEventListener("click",b),window.removeEventListener("narrative-audio-event",f),window.removeEventListener("narrative-impression",T),window.removeEventListener("narrative-standard-log",_),document.removeEventListener("visibilitychange",g),window.removeEventListener("beforeunload",()=>N(!0)),l.current.idleTimer&&clearTimeout(l.current.idleTimer)}},[d,N,w]),null},$e=()=>n.jsxs("div",{className:"page-loader-container",children:[n.jsx("div",{className:"spinner"}),n.jsx("p",{style:{color:"var(--text-secondary)",marginTop:"20px"},children:"Loading page..."})]});class Ol extends h.Component{constructor(r){super(r);er(this,"handleRetry",()=>{this.setState({hasError:!1,error:null}),window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,s){console.error("Uncaught error:",r,s)}render(){var r;return this.state.hasError?n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",padding:"20px",textAlign:"center",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[n.jsx("h2",{style:{fontSize:"24px",marginBottom:"10px"},children:"Something went wrong."}),n.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"20px",maxWidth:"400px"},children:"We encountered an unexpected error. Our team has been notified."}),n.jsx("div",{style:{padding:"10px",background:"rgba(255,0,0,0.1)",color:"#E57373",borderRadius:"6px",fontSize:"12px",marginBottom:"20px",fontFamily:"monospace"},children:(r=this.state.error)==null?void 0:r.toString()}),n.jsx("button",{onClick:this.handleRetry,className:"btn-primary",style:{padding:"10px 25px"},children:"Refresh App"})]}):this.props.children}}const Xs=({children:e,title:t,subtitle:r,padding:s="md",variant:a="default",className:i="",style:o,onClick:c})=>n.jsxs("div",{className:`
        card 
        card-variant-${a} 
        card-padding-${s} 
        ${c?"card-interactive":""} 
        ${i}
      `,onClick:c,style:o,children:[(t||r)&&n.jsxs("div",{className:"card-header",children:[t&&n.jsx("h3",{className:"card-title",children:t}),r&&n.jsx("p",{className:"card-subtitle",children:r})]}),n.jsx("div",{className:"card-content",children:e})]}),Ee=({variant:e="primary",size:t="md",isLoading:r=!1,isActive:s=!1,icon:a,children:i,className:o="",onClick:c,...d})=>{const u=qe(),l=p=>{!r&&!d.disabled&&(u(),c&&c(p))};return n.jsx("button",{className:`ui-btn btn-${e} btn-${t} ${s?"active":""} ${o}`,onClick:l,disabled:r||d.disabled,...d,children:r?n.jsx("div",{className:"btn-spinner"}):n.jsxs(n.Fragment,{children:[a&&n.jsx("span",{className:"btn-icon-wrapper",children:a}),i]})})},An=he.forwardRef(({label:e,icon:t,isLoading:r,error:s,fullWidth:a=!1,className:i="",...o},c)=>n.jsxs("div",{className:`ui-input-wrapper ${a?"full-width":""} ${i}`,children:[e&&n.jsx("label",{className:"ui-input-label",children:e}),n.jsxs("div",{className:`ui-input-container ${s?"has-error":""}`,children:[t&&n.jsx("span",{className:"ui-input-icon",children:t}),n.jsx("input",{ref:c,className:"ui-input-field",disabled:r||o.disabled,...o}),r&&n.jsx("div",{className:"ui-input-spinner"})]}),s&&n.jsx("span",{className:"ui-input-error-text",children:s})]})),ln=[{category:"POLITICS",title:"Summit Talks: New Climate Agreements Signed",color:"linear-gradient(135deg, #FF6B6B 0%, #EE5D5D 100%)"},{category:"TECH",title:"Quantum Leap: Silicon Valley's New Bet",color:"linear-gradient(135deg, #4FACFE 0%, #00F2FE 100%)"},{category:"MARKETS",title:"Global Trade Shifts as Inflation Cools",color:"linear-gradient(135deg, #43E97B 0%, #38F9D7 100%)"},{category:"OPINION",title:"Why the 4-Day Work Week is Inevitable",color:"linear-gradient(135deg, #FA709A 0%, #FEE140 100%)"},{category:"SCIENCE",title:"Mars Mission: Phase 2 Funding Secured",color:"linear-gradient(135deg, #667EEA 0%, #764BA2 100%)"}],Dl=[{code:"+1",label:"US/CA (+1)"},{code:"+91",label:"India (+91)"},{code:"+44",label:"UK (+44)"},{code:"+61",label:"Aus (+61)"},{code:"+81",label:"Japan (+81)"},{code:"+49",label:"Germany (+49)"},{code:"+33",label:"France (+33)"},{code:"+86",label:"China (+86)"}],Ml=()=>{const[e,t]=h.useState(""),[r,s]=h.useState("+1"),[a,i]=h.useState(""),[o,c]=h.useState("PHONE"),[d,u]=h.useState(!1),[l,p]=h.useState(null),[m,y]=h.useState(null),{addToast:S}=Ne(),w=rt(),k=h.useRef(!1);h.useEffect(()=>()=>{if(window.recaptchaVerifier){try{window.recaptchaVerifier.clear()}catch{}window.recaptchaVerifier=void 0}},[]);const N=async()=>{if(window.recaptchaVerifier)return window.recaptchaVerifier;try{console.log("Initializing Recaptcha...");const g=new Aa(Oe,"recaptcha-container",{size:"normal",callback:v=>{console.log("ReCAPTCHA Solved"),p(null)},"expired-callback":()=>{p("Security check expired. Please check the box again.")}});return await g.render(),window.recaptchaVerifier=g,k.current=!0,g}catch(g){return console.error("Recaptcha Setup Error:",g),p("Could not load security check. Please refresh."),null}},j=async()=>{if(p(null),!e||e.length<4){p("Please enter a valid phone number.");return}u(!0);try{const g=e.replace(/\D/g,""),v=`${r}${g}`;if(console.log("Sending to:",v),!await N())throw new Error("Security check failed to load.");const O=await Na(Oe,v,window.recaptchaVerifier);y(O),c("OTP"),S(`Code sent to ${v}`,"success")}catch(g){console.error("SMS Error:",g);let v="Failed to send code.";g.code==="auth/invalid-phone-number"&&(v="Invalid phone number format."),g.code==="auth/quota-exceeded"&&(v="SMS quota exceeded for this project."),g.code==="auth/billing-not-enabled"&&(v="Billing is not enabled in Firebase Console."),g.code==="auth/network-request-failed"&&(v="Network error. Check connection."),g.code==="auth/too-many-requests"&&(v="Too many attempts. Try again later."),(g.code==="auth/app-not-authorized"||g.message&&g.message.includes("domain"))&&(v="Domain not authorized in Firebase Console."),p(v),S(v,"error"),g.code==="auth/internal-error"&&window.recaptchaVerifier&&(window.recaptchaVerifier.clear(),window.recaptchaVerifier=void 0)}finally{u(!1)}},b=async()=>{if(!(!a||!m)){u(!0);try{await m.confirm(a),S("Welcome back.","success"),w("/")}catch(g){console.error("OTP Error:",g),p("Invalid code. Please try again.")}finally{u(!1)}}},f=async()=>{try{await Ca(Oe,new ka),S("Successfully signed in with Google.","success"),w("/")}catch(g){S(g.message||"Google sign-in failed.","error")}},T=()=>{S("Apple Sign-In is coming soon.","info")},_=(g,v=!1)=>n.jsx("div",{className:`ghost-column ${g} ${v?"reverse":""}`,children:[...ln,...ln,...ln].map((P,O)=>n.jsxs("div",{className:"ghost-card",children:[n.jsx("div",{className:"ghost-image",style:{background:P.color}}),n.jsxs("div",{className:"ghost-content",children:[n.jsx("div",{className:"ghost-category",children:P.category}),n.jsx("div",{className:"ghost-title",children:P.title}),n.jsx("div",{className:"ghost-meta",children:n.jsx("span",{className:"ghost-pill"})})]})]},`${g}-${O}`))});return n.jsxs("div",{className:"login-page-wrapper",children:[n.jsxs("div",{className:"narrative-stream-bg",children:[n.jsx("div",{className:"stream-vignette"}),n.jsxs("div",{className:"stream-columns",children:[_("slow"),_("medium",!0),_("slow")]})]}),n.jsxs("div",{className:"login-stage",children:[n.jsx("div",{className:"login-sensor-glow"}),n.jsx("div",{className:"login-container",children:n.jsxs(Xs,{variant:"glass",padding:"xl",className:"login-card-custom",children:[n.jsxs("div",{className:"login-header",children:[n.jsx("h1",{children:"The Gamut"}),n.jsx("p",{children:"Analyze the full spectrum of the narrative."})]}),o==="PHONE"&&n.jsxs("div",{className:"login-step fade-in",children:[n.jsxs("div",{className:"input-group",style:{display:"flex",gap:"8px"},children:[n.jsx("select",{className:"login-country-select",value:r,onChange:g=>s(g.target.value),style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",color:"white",padding:"0 8px",height:"50px",cursor:"pointer",outline:"none",fontSize:"0.9rem"},children:Dl.map(g=>n.jsx("option",{value:g.code,style:{color:"black"},children:g.label},g.code))}),n.jsx(An,{type:"tel",placeholder:"123 456 7890",value:e,onChange:g=>t(g.target.value),className:"login-input-large",style:{flex:1}})]}),l&&n.jsx("div",{style:{color:"#ff6b6b",fontSize:"0.85rem",marginTop:"8px",textAlign:"center"},children:l}),n.jsx(Ee,{variant:"primary",onClick:j,disabled:d,className:"login-btn-wide",style:{marginTop:"16px"},children:d?"Processing...":"Get Access Code"})]}),o==="OTP"&&n.jsxs("div",{className:"login-step fade-in",children:[n.jsx("div",{className:"input-group",children:n.jsx(An,{type:"text",placeholder:"Enter 6-digit code",value:a,onChange:g=>i(g.target.value),className:"login-input-large text-center",maxLength:6})}),l&&n.jsx("div",{style:{color:"#ff6b6b",fontSize:"0.85rem",marginTop:"8px",textAlign:"center"},children:l}),n.jsx(Ee,{variant:"primary",onClick:b,disabled:d,className:"login-btn-wide",children:d?"Verifying...":"Unlock"}),n.jsx("button",{className:"text-link-button",onClick:()=>{c("PHONE"),p(null)},children:"Wrong number?"})]}),n.jsx("div",{className:"login-divider",children:n.jsx("span",{children:"OR CONTINUE WITH"})}),n.jsxs("div",{className:"social-row",children:[n.jsx("button",{className:"social-btn google",onClick:f,children:n.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",children:n.jsx("path",{fill:"#fff",d:"M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"})})}),n.jsx("button",{className:"social-btn apple",onClick:T,children:n.jsx("svg",{viewBox:"0 0 384 512",width:"22",height:"22",fill:"white",children:n.jsx("path",{d:"M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 46.9 104.3 80.9 102.6 30.6-1.5 42.8-19.8 85.3-19.8 41.7 0 53.3 19.8 84.5 19.8 40 0 56.4-42.9 83.2-100.3-52.1-23.7-73.4-64-73.6-88.3zm-31.4-123c3.4-5.2 7.5-16.3 7.5-28.4 0-20.5-13-37-33.6-37-4.2 0-11.3 3.1-15.3 5.5-9.4 6-17.8 15.4-20 25-3.2 16.7 10.1 36 29.8 36 6.3 0 16.1-3.6 24.2-7.5 4.6-2.2 6.8-3 7.4-3.6z"})})})]}),n.jsx("div",{id:"recaptcha-container",style:{margin:"16px auto",display:o==="PHONE"?"flex":"none",justifyContent:"center",minHeight:"78px"}})]})})]})]})},$l=()=>{const[e,t]=h.useState(""),[r,s]=h.useState(""),[a,i]=h.useState(!1),o=async c=>{if(c.preventDefault(),s(""),e.trim().length<3){s("Username must be at least 3 characters long.");return}i(!0);try{await fl({username:e.trim()}),window.location.href="/"}catch(d){console.error("Profile Creation Error:",d),d.message?s(d.message):d.original&&d.original.response&&d.original.response.data?s(d.original.response.data.message||d.original.response.data.error||"Server error occurred."):s("Failed to create profile. Please check your connection."),i(!1)}};return n.jsx("div",{className:"login-page-wrapper",children:n.jsx("div",{className:"login-container",children:n.jsx(Xs,{variant:"glass",padding:"lg",children:n.jsxs("div",{className:"login-form-panel",style:{padding:0},children:[n.jsx("h1",{children:"Welcome to The Gamut"}),n.jsx("p",{children:"Please choose a username to complete your registration."}),n.jsxs("form",{onSubmit:o,style:{width:"100%",display:"flex",flexDirection:"column",gap:"20px"},children:[n.jsx(An,{label:"Username",type:"text",placeholder:"Enter your username",value:e,onChange:c=>t(c.target.value),required:!0,fullWidth:!0}),r&&n.jsx("div",{style:{color:"#CF5C5C",fontSize:"12px",background:"rgba(207, 92, 92, 0.1)",padding:"10px",borderRadius:"4px",textAlign:"left"},children:r}),n.jsx(Ee,{type:"submit",variant:"primary",isLoading:a,className:"btn-full-width",children:"Save Profile"})]})]})})})})},Ut=(e=768)=>{const[t,r]=h.useState(typeof window<"u"?window.innerWidth<=e:!1);return h.useEffect(()=>{let s;const a=()=>{s&&clearTimeout(s),s=setTimeout(()=>{r(window.innerWidth<=e)},150)};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),s&&clearTimeout(s)}},[e]),t},En=(e,t)=>t.some(r=>e instanceof r);let Fr,Ur;function Bl(){return Fr||(Fr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fl(){return Ur||(Ur=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const In=new WeakMap,dn=new WeakMap,Ht=new WeakMap;function Ul(e){const t=new Promise((r,s)=>{const a=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{r(ze(e.result)),a()},o=()=>{s(e.error),a()};e.addEventListener("success",i),e.addEventListener("error",o)});return Ht.set(t,e),t}function Hl(e){if(In.has(e))return;const t=new Promise((r,s)=>{const a=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{r(),a()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});In.set(e,t)}let _n={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return In.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ze(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Zs(e){_n=e(_n)}function zl(e){return Fl().includes(e)?function(...t){return e.apply(Pn(this),t),ze(this.request)}:function(...t){return ze(e.apply(Pn(this),t))}}function Wl(e){return typeof e=="function"?zl(e):(e instanceof IDBTransaction&&Hl(e),En(e,Bl())?new Proxy(e,_n):e)}function ze(e){if(e instanceof IDBRequest)return Ul(e);if(dn.has(e))return dn.get(e);const t=Wl(e);return t!==e&&(dn.set(e,t),Ht.set(t,e)),t}const Pn=e=>Ht.get(e);function Vl(e,t,{blocked:r,upgrade:s,blocking:a,terminated:i}={}){const o=indexedDB.open(e,t),c=ze(o);return s&&o.addEventListener("upgradeneeded",d=>{s(ze(o.result),d.oldVersion,d.newVersion,ze(o.transaction),d)}),r&&o.addEventListener("blocked",d=>r(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",u=>a(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}const Gl=["get","getKey","getAll","getAllKeys","count"],ql=["put","add","delete","clear"],un=new Map;function Hr(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(un.get(t))return un.get(t);const r=t.replace(/FromIndex$/,""),s=t!==r,a=ql.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(a||Gl.includes(r)))return;const i=async function(o,...c){const d=this.transaction(o,a?"readwrite":"readonly");let u=d.store;return s&&(u=u.index(c.shift())),(await Promise.all([u[r](...c),a&&d.done]))[0]};return un.set(t,i),i}Zs(e=>({...e,get:(t,r,s)=>Hr(t,r)||e.get(t,r,s),has:(t,r)=>!!Hr(t,r)||e.has(t,r)}));const Kl=["continue","continuePrimaryKey","advance"],zr={},Ln=new WeakMap,ea=new WeakMap,Yl={get(e,t){if(!Kl.includes(t))return e[t];let r=zr[t];return r||(r=zr[t]=function(...s){Ln.set(this,ea.get(this)[t](...s))}),r}};async function*Jl(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const r=new Proxy(t,Yl);for(ea.set(r,t),Ht.set(r,Pn(t));t;)yield r,t=await(Ln.get(r)||t.continue()),Ln.delete(r)}function Wr(e,t){return t===Symbol.asyncIterator&&En(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&En(e,[IDBIndex,IDBObjectStore])}Zs(e=>({...e,get(t,r,s){return Wr(t,r)?Jl:e.get(t,r,s)},has(t,r){return Wr(t,r)||e.has(t,r)}}));const Ql="the-gamut-db",mt="feed-cache",ft="saved-articles",Xl=2,Qe=async()=>Vl(Ql,Xl,{upgrade(e,t,r,s){e.objectStoreNames.contains(mt)||e.createObjectStore(mt),e.objectStoreNames.contains(ft)||e.createObjectStore(ft,{keyPath:"_id"})}}),Xe={save:async(e,t)=>{try{const r=await Qe(),s={data:t,timestamp:Date.now()};await r.put(mt,s,e),console.log(` [Offline] Saved Feed: ${e}`)}catch(r){console.warn("Offline Storage Save Error:",r)}},get:async e=>{try{const r=await(await Qe()).get(mt,e);return r?(console.log(` [Offline] Loaded Feed: ${e} (Age: ${((Date.now()-r.timestamp)/1e3).toFixed(0)}s)`),r.data):null}catch(t){return console.warn("Offline Storage Get Error:",t),null}},clear:async e=>{try{await(await Qe()).delete(mt,e)}catch(t){console.warn("Offline Storage Clear Error:",t)}},saveOfflineArticle:async e=>{try{const t=await Qe();let r;const s=e.imageUrl||e.urlToImage||e.image;if(s&&typeof s=="string"&&s.startsWith("http"))try{const a=await fetch(s,{mode:"cors"});a.ok&&(r=await a.blob())}catch(a){console.warn("Failed to download image for offline:",a)}await t.put(ft,{...e,offlineImageBlob:r,savedAt:Date.now()}),console.log(` [Offline] Article Cached: ${e.headline}`)}catch(t){console.error("Offline Article Save Failed:",t)}},getOfflineArticle:async e=>{try{return await(await Qe()).get(ft,e)}catch(t){console.warn("Offline Article Fetch Error:",t);return}},removeOfflineArticle:async e=>{try{await(await Qe()).delete(ft,e),console.log(` [Offline] Article Removed: ${e}`)}catch(t){console.warn("Offline Article Remove Error:",t)}}};function Zl(e=[]){const{addToast:t}=Ne(),[r,s]=h.useState(new Set(e)),a=h.useRef(new Map);h.useEffect(()=>()=>{a.current.forEach(o=>clearTimeout(o))},[]);const i=h.useCallback(async o=>{const c=o._id;if(r.has(c)){s(l=>{const p=new Set(l);return p.delete(c),p}),Xe.removeOfflineArticle(c);const u=setTimeout(async()=>{try{await Mr(c),a.current.delete(c)}catch(l){console.error("Unsave failed:",l),s(p=>new Set(p).add(c)),t("Failed to sync. Article restored.","error"),Xe.saveOfflineArticle(o)}},3500);a.current.set(c,u),t("Article removed","info",{label:"UNDO",onClick:()=>{const l=a.current.get(c);l&&(clearTimeout(l),a.current.delete(c),s(p=>new Set(p).add(c)),Xe.saveOfflineArticle(o))}})}else{if(a.current.has(c)){clearTimeout(a.current.get(c)),a.current.delete(c),s(u=>new Set(u).add(c)),Xe.saveOfflineArticle(o),t("Removal cancelled","success");return}s(u=>new Set(u).add(c)),Xe.saveOfflineArticle(o);try{await Mr(c),t("Article saved","success")}catch(u){console.error("Save failed:",u),s(l=>{const p=new Set(l);return p.delete(c),p}),Xe.removeOfflineArticle(c),t("Failed to save article","error")}}},[r,t]);return{savedArticleIds:r,handleToggleSave:i}}const ed=()=>{const[e,t]=h.useState(window.deferredPrompt||null),[r,s]=h.useState(!!window.deferredPrompt);return h.useEffect(()=>{const i=c=>{c.preventDefault(),window.deferredPrompt=c,t(c),s(!0),console.log("PWA Hook: Captured event via listener")};window.deferredPrompt&&(s(!0),t(window.deferredPrompt),console.log("PWA Hook: Found stashed event on mount")),window.addEventListener("beforeinstallprompt",i);const o=()=>{t(null),s(!1),window.deferredPrompt=null};return window.addEventListener("appinstalled",o),()=>{window.removeEventListener("beforeinstallprompt",i),window.removeEventListener("appinstalled",o)}},[]),{isInstallable:r,triggerInstall:async()=>{if(!e)return;e.prompt();const{outcome:i}=await e.userChoice;i==="accepted"?(console.log("User accepted the install prompt"),s(!1)):console.log("User dismissed the install prompt"),t(null),window.deferredPrompt=null}}},Jn=({isOpen:e,onClose:t,message:r})=>e?es.createPortal(n.jsx("div",{className:"login-modal-overlay",onClick:t,children:n.jsxs("div",{className:"login-modal-content",onClick:s=>s.stopPropagation(),children:[n.jsx("button",{className:"login-modal-close",onClick:t,children:""}),n.jsx("h2",{className:"login-modal-title",children:"Unlock The Gamut"}),n.jsx("p",{className:"login-modal-desc",children:r||"Create a free account to access developing narratives, save articles, and customize your feed."}),n.jsx(Le,{to:"/login",className:"btn-primary login-modal-btn",children:"Log In / Sign Up"}),n.jsx("button",{className:"login-modal-guest-btn",onClick:t,children:"Continue as Guest"})]})}),document.body):null,td=()=>new Date().toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),nd=({theme:e,toggleTheme:t,username:r,currentFilters:s})=>{const[a,i]=h.useState(!1),[o,c]=h.useState(!1),[d,u]=h.useState(""),[l,p]=h.useState([]),[m,y]=h.useState(!1),[S,w]=h.useState(!1),{isPlaying:k,isPaused:N,startRadio:j,resume:b,pause:f,currentArticle:T,contextQueue:_,contextLabel:g}=Bt(),{addToast:v}=Ne(),{isGuest:P}=Te(),[O,F]=h.useState(!1),U=h.useRef(null),z=h.useRef(null),Y=h.useRef(null),M=rt(),L=_e.isNativePlatform(),$=td();h.useEffect(()=>{const C=E=>{U.current&&!U.current.contains(E.target)&&i(!1),z.current&&!z.current.contains(E.target)&&(document.activeElement!==Y.current&&c(!1),p([]))};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[]),h.useEffect(()=>{const C=setTimeout(async()=>{if(d.trim().length>=2){y(!0);try{const{data:E}=await hl(d,{limit:5});p(E.articles||[])}catch(E){console.error("Live search failed",E)}finally{y(!1)}}else p([])},300);return()=>clearTimeout(C)},[d]);const W=C=>{if(C.preventDefault(),d.trim()){const E=sessionStorage.getItem("current_analytics_session_id");E&&jl(d.trim(),E).catch(console.error),M(`/search?q=${encodeURIComponent(d)}`),c(!1),p([]),u(""),Y.current&&Y.current.blur()}},R=async()=>{if(P){w(!0);return}if(!O){if(k){f();return}if(N&&T){b();return}if(F(!0),_&&_.length>0){v(`Tuning into ${g}...`,"info"),j(_,0),F(!1);return}v("Tuning into Gamut Radio...","info");try{const{data:C}=await Vs({limit:20,offset:0}),E=(C.articles||[]).filter(A=>A.type!=="Narrative");E.length>0?j(E,0):v("No news available for radio.","error")}catch{v("Could not start radio.","error")}finally{F(!1)}}};return n.jsxs("header",{className:"header",style:{paddingTop:"var(--sat)",height:"auto",minHeight:"calc(60px + var(--sat))",boxSizing:"border-box"},children:[n.jsx("div",{className:"header-left",children:n.jsx("div",{className:"logo-container",children:n.jsx(Le,{to:"/",style:{textDecoration:"none"},children:n.jsx("h1",{className:"logo-text",children:"The Gamut"})})})}),n.jsxs("div",{className:"header-right",children:[n.jsxs("div",{ref:z,className:"search-bar-wrapper",children:[n.jsx("form",{onSubmit:W,className:`search-form ${o?"open":""}`,children:n.jsx("input",{ref:Y,type:"text",className:"search-input",placeholder:"Search...",value:d,onChange:C=>u(C.target.value)})}),n.jsx("button",{onClick:()=>c(!o),className:"search-toggle-btn",title:"Search",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"11",cy:"11",r:"8"}),n.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),l.length>0&&o&&n.jsxs("div",{className:"live-search-dropdown",children:[n.jsx("div",{className:"live-search-label",children:"TOP MATCHES"}),l.map(C=>{const E=C.type==="Narrative",A=E?C.masterHeadline:C.headline;return n.jsxs("div",{className:"live-search-item",onClick:W,children:[n.jsx("span",{className:"live-item-icon",children:E?"":""}),n.jsx("div",{className:"live-item-text",children:n.jsx("div",{className:"live-item-headline",children:A})})]},C._id)})]})]}),!L&&n.jsxs("button",{onClick:R,className:`radio-header-btn ${k?"playing":""}`,title:"Start Radio",children:[O?n.jsx("div",{className:"spinner-small",style:{width:"14px",height:"14px",border:"2px solid rgba(255,255,255,0.3)",borderTopColor:"var(--accent-primary)",margin:0}}):k?n.jsxs("span",{className:"radio-pulse",children:[n.jsx("span",{className:"bar b1"}),n.jsx("span",{className:"bar b2"}),n.jsx("span",{className:"bar b3"})]}):n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M3 18v-6a9 9 0 0 1 18 0v6"}),n.jsx("path",{d:"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"})]}),n.jsx("span",{className:"radio-label-desktop",children:"Gamut Radio"})]}),n.jsx("div",{className:"header-date-display",children:$}),!L&&n.jsx("div",{className:"header-user-desktop",ref:U,children:P?n.jsx(Le,{to:"/login",className:"btn-secondary",style:{padding:"6px 16px",fontSize:"0.9rem",textDecoration:"none"},children:"Log In"}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"header-user-clickable-area",onClick:()=>i(!a),children:[n.jsx("span",{className:"header-username-desktop",children:r}),n.jsx("svg",{className:"custom-select-arrow",style:{width:"14px",height:"14px",fill:"var(--text-tertiary)",marginLeft:"4px"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:n.jsx("path",{d:"M7 10l5 5 5-5z"})})]}),a&&n.jsx("div",{className:"header-user-dropdown",children:n.jsxs("ul",{children:[n.jsx("li",{children:n.jsx(Le,{to:"/my-dashboard",onClick:()=>i(!1),children:"Dashboard"})}),n.jsx("li",{children:n.jsx(Le,{to:"/saved-articles",onClick:()=>i(!1),children:"Saved Articles"})}),n.jsx("li",{children:n.jsx(Le,{to:"/emergency-resources",onClick:()=>i(!1),children:"Emergency Help"})}),n.jsx("li",{children:n.jsx(Le,{to:"/account-settings",onClick:()=>i(!1),children:"Settings"})})]})})]})}),!L&&n.jsx("button",{className:"theme-toggle",onClick:t,children:e==="dark"?"":""})]}),n.jsx(Jn,{isOpen:S,onClose:()=>w(!1),message:"Gamut Radio is exclusive to members. Login to listen to your news."})]})};var rd=typeof Element<"u",sd=typeof Map=="function",ad=typeof Set=="function",id=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Nt(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,a;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(!Nt(e[s],t[s]))return!1;return!0}var i;if(sd&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(i=e.entries();!(s=i.next()).done;)if(!t.has(s.value[0]))return!1;for(i=e.entries();!(s=i.next()).done;)if(!Nt(s.value[1],t.get(s.value[0])))return!1;return!0}if(ad&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(i=e.entries();!(s=i.next()).done;)if(!t.has(s.value[0]))return!1;return!0}if(id&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[s]))return!1;if(rd&&e instanceof Element)return!1;for(s=r;s--!==0;)if(!((a[s]==="_owner"||a[s]==="__v"||a[s]==="__o")&&e.$$typeof)&&!Nt(e[a[s]],t[a[s]]))return!1;return!0}return e!==e&&t!==t}var od=function(t,r){try{return Nt(t,r)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}};const cd=Mn(od);var ld=function(e,t,r,s,a,i,o,c){if(!e){var d;if(t===void 0)d=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[r,s,a,i,o,c],l=0;d=new Error(t.replace(/%s/g,function(){return u[l++]})),d.name="Invariant Violation"}throw d.framesToPop=1,d}},dd=ld;const Vr=Mn(dd);var ud=function(t,r,s,a){var i=s?s.call(a,t,r):void 0;if(i!==void 0)return!!i;if(t===r)return!0;if(typeof t!="object"||!t||typeof r!="object"||!r)return!1;var o=Object.keys(t),c=Object.keys(r);if(o.length!==c.length)return!1;for(var d=Object.prototype.hasOwnProperty.bind(r),u=0;u<o.length;u++){var l=o[u];if(!d(l))return!1;var p=t[l],m=r[l];if(i=s?s.call(a,p,m,l):void 0,i===!1||i===void 0&&p!==m)return!1}return!0};const hd=Mn(ud);function ne(){return ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ne.apply(this,arguments)}function Qn(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Rn(e,t)}function Rn(e,t){return Rn=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},Rn(e,t)}function Gr(e,t){if(e==null)return{};var r,s,a={},i=Object.keys(e);for(s=0;s<i.length;s++)t.indexOf(r=i[s])>=0||(a[r]=e[r]);return a}var D={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",FRAGMENT:"Symbol(react.fragment)"},pd={rel:["amphtml","canonical","alternate"]},md={type:["application/ld+json"]},fd={charset:"",name:["robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]},qr=Object.keys(D).map(function(e){return D[e]}),Pt={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},gd=Object.keys(Pt).reduce(function(e,t){return e[Pt[t]]=t,e},{}),tt=function(e,t){for(var r=e.length-1;r>=0;r-=1){var s=e[r];if(Object.prototype.hasOwnProperty.call(s,t))return s[t]}return null},vd=function(e){var t=tt(e,D.TITLE),r=tt(e,"titleTemplate");if(Array.isArray(t)&&(t=t.join("")),r&&t)return r.replace(/%s/g,function(){return t});var s=tt(e,"defaultTitle");return t||s||void 0},yd=function(e){return tt(e,"onChangeClientState")||function(){}},hn=function(e,t){return t.filter(function(r){return r[e]!==void 0}).map(function(r){return r[e]}).reduce(function(r,s){return ne({},r,s)},{})},xd=function(e,t){return t.filter(function(r){return r[D.BASE]!==void 0}).map(function(r){return r[D.BASE]}).reverse().reduce(function(r,s){if(!r.length)for(var a=Object.keys(s),i=0;i<a.length;i+=1){var o=a[i].toLowerCase();if(e.indexOf(o)!==-1&&s[o])return r.concat(s)}return r},[])},ct=function(e,t,r){var s={};return r.filter(function(a){return!!Array.isArray(a[e])||(a[e]!==void 0&&console&&typeof console.warn=="function"&&console.warn("Helmet: "+e+' should be of type "Array". Instead found type "'+typeof a[e]+'"'),!1)}).map(function(a){return a[e]}).reverse().reduce(function(a,i){var o={};i.filter(function(p){for(var m,y=Object.keys(p),S=0;S<y.length;S+=1){var w=y[S],k=w.toLowerCase();t.indexOf(k)===-1||m==="rel"&&p[m].toLowerCase()==="canonical"||k==="rel"&&p[k].toLowerCase()==="stylesheet"||(m=k),t.indexOf(w)===-1||w!=="innerHTML"&&w!=="cssText"&&w!=="itemprop"||(m=w)}if(!m||!p[m])return!1;var N=p[m].toLowerCase();return s[m]||(s[m]={}),o[m]||(o[m]={}),!s[m][N]&&(o[m][N]=!0,!0)}).reverse().forEach(function(p){return a.push(p)});for(var c=Object.keys(o),d=0;d<c.length;d+=1){var u=c[d],l=ne({},s[u],o[u]);s[u]=l}return a},[]).reverse()},bd=function(e,t){if(Array.isArray(e)&&e.length){for(var r=0;r<e.length;r+=1)if(e[r][t])return!0}return!1},ta=function(e){return Array.isArray(e)?e.join(""):e},pn=function(e,t){return Array.isArray(e)?e.reduce(function(r,s){return function(a,i){for(var o=Object.keys(a),c=0;c<o.length;c+=1)if(i[o[c]]&&i[o[c]].includes(a[o[c]]))return!0;return!1}(s,t)?r.priority.push(s):r.default.push(s),r},{priority:[],default:[]}):{default:e}},Kr=function(e,t){var r;return ne({},e,((r={})[t]=void 0,r))},wd=[D.NOSCRIPT,D.SCRIPT,D.STYLE],mn=function(e,t){return t===void 0&&(t=!0),t===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},Yr=function(e){return Object.keys(e).reduce(function(t,r){var s=e[r]!==void 0?r+'="'+e[r]+'"':""+r;return t?t+" "+s:s},"")},Jr=function(e,t){return t===void 0&&(t={}),Object.keys(e).reduce(function(r,s){return r[Pt[s]||s]=e[s],r},t)},Ct=function(e,t){return t.map(function(r,s){var a,i=((a={key:s})["data-rh"]=!0,a);return Object.keys(r).forEach(function(o){var c=Pt[o]||o;c==="innerHTML"||c==="cssText"?i.dangerouslySetInnerHTML={__html:r.innerHTML||r.cssText}:i[c]=r[o]}),he.createElement(e,i)})},be=function(e,t,r){switch(e){case D.TITLE:return{toComponent:function(){return a=t.titleAttributes,(i={key:s=t.title})["data-rh"]=!0,o=Jr(a,i),[he.createElement(D.TITLE,o,s)];var s,a,i,o},toString:function(){return function(s,a,i,o){var c=Yr(i),d=ta(a);return c?"<"+s+' data-rh="true" '+c+">"+mn(d,o)+"</"+s+">":"<"+s+' data-rh="true">'+mn(d,o)+"</"+s+">"}(e,t.title,t.titleAttributes,r)}};case"bodyAttributes":case"htmlAttributes":return{toComponent:function(){return Jr(t)},toString:function(){return Yr(t)}};default:return{toComponent:function(){return Ct(e,t)},toString:function(){return function(s,a,i){return a.reduce(function(o,c){var d=Object.keys(c).filter(function(p){return!(p==="innerHTML"||p==="cssText")}).reduce(function(p,m){var y=c[m]===void 0?m:m+'="'+mn(c[m],i)+'"';return p?p+" "+y:y},""),u=c.innerHTML||c.cssText||"",l=wd.indexOf(s)===-1;return o+"<"+s+' data-rh="true" '+d+(l?"/>":">"+u+"</"+s+">")},"")}(e,t,r)}}}},On=function(e){var t=e.baseTag,r=e.bodyAttributes,s=e.encode,a=e.htmlAttributes,i=e.noscriptTags,o=e.styleTags,c=e.title,d=c===void 0?"":c,u=e.titleAttributes,l=e.linkTags,p=e.metaTags,m=e.scriptTags,y={toComponent:function(){},toString:function(){return""}};if(e.prioritizeSeoTags){var S=function(w){var k=w.linkTags,N=w.scriptTags,j=w.encode,b=pn(w.metaTags,fd),f=pn(k,pd),T=pn(N,md);return{priorityMethods:{toComponent:function(){return[].concat(Ct(D.META,b.priority),Ct(D.LINK,f.priority),Ct(D.SCRIPT,T.priority))},toString:function(){return be(D.META,b.priority,j)+" "+be(D.LINK,f.priority,j)+" "+be(D.SCRIPT,T.priority,j)}},metaTags:b.default,linkTags:f.default,scriptTags:T.default}}(e);y=S.priorityMethods,l=S.linkTags,p=S.metaTags,m=S.scriptTags}return{priority:y,base:be(D.BASE,t,s),bodyAttributes:be("bodyAttributes",r,s),htmlAttributes:be("htmlAttributes",a,s),link:be(D.LINK,l,s),meta:be(D.META,p,s),noscript:be(D.NOSCRIPT,i,s),script:be(D.SCRIPT,m,s),style:be(D.STYLE,o,s),title:be(D.TITLE,{title:d,titleAttributes:u},s)}},wt=[],Dn=function(e,t){var r=this;t===void 0&&(t=typeof document<"u"),this.instances=[],this.value={setHelmet:function(s){r.context.helmet=s},helmetInstances:{get:function(){return r.canUseDOM?wt:r.instances},add:function(s){(r.canUseDOM?wt:r.instances).push(s)},remove:function(s){var a=(r.canUseDOM?wt:r.instances).indexOf(s);(r.canUseDOM?wt:r.instances).splice(a,1)}}},this.context=e,this.canUseDOM=t,t||(e.helmet=On({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))},na=he.createContext({}),jd=V.shape({setHelmet:V.func,helmetInstances:V.shape({get:V.func,add:V.func,remove:V.func})}),Sd=typeof document<"u",et=function(e){function t(r){var s;return(s=e.call(this,r)||this).helmetData=new Dn(s.props.context,t.canUseDOM),s}return Qn(t,e),t.prototype.render=function(){return he.createElement(na.Provider,{value:this.helmetData.value},this.props.children)},t}(h.Component);et.canUseDOM=Sd,et.propTypes={context:V.shape({helmet:V.shape()}),children:V.node.isRequired},et.defaultProps={context:{}},et.displayName="HelmetProvider";var Ze=function(e,t){var r,s=document.head||document.querySelector(D.HEAD),a=s.querySelectorAll(e+"[data-rh]"),i=[].slice.call(a),o=[];return t&&t.length&&t.forEach(function(c){var d=document.createElement(e);for(var u in c)Object.prototype.hasOwnProperty.call(c,u)&&(u==="innerHTML"?d.innerHTML=c.innerHTML:u==="cssText"?d.styleSheet?d.styleSheet.cssText=c.cssText:d.appendChild(document.createTextNode(c.cssText)):d.setAttribute(u,c[u]===void 0?"":c[u]));d.setAttribute("data-rh","true"),i.some(function(l,p){return r=p,d.isEqualNode(l)})?i.splice(r,1):o.push(d)}),i.forEach(function(c){return c.parentNode.removeChild(c)}),o.forEach(function(c){return s.appendChild(c)}),{oldTags:i,newTags:o}},fn=function(e,t){var r=document.getElementsByTagName(e)[0];if(r){for(var s=r.getAttribute("data-rh"),a=s?s.split(","):[],i=[].concat(a),o=Object.keys(t),c=0;c<o.length;c+=1){var d=o[c],u=t[d]||"";r.getAttribute(d)!==u&&r.setAttribute(d,u),a.indexOf(d)===-1&&a.push(d);var l=i.indexOf(d);l!==-1&&i.splice(l,1)}for(var p=i.length-1;p>=0;p-=1)r.removeAttribute(i[p]);a.length===i.length?r.removeAttribute("data-rh"):r.getAttribute("data-rh")!==o.join(",")&&r.setAttribute("data-rh",o.join(","))}},Qr=function(e,t){var r=e.baseTag,s=e.htmlAttributes,a=e.linkTags,i=e.metaTags,o=e.noscriptTags,c=e.onChangeClientState,d=e.scriptTags,u=e.styleTags,l=e.title,p=e.titleAttributes;fn(D.BODY,e.bodyAttributes),fn(D.HTML,s),function(w,k){w!==void 0&&document.title!==w&&(document.title=ta(w)),fn(D.TITLE,k)}(l,p);var m={baseTag:Ze(D.BASE,r),linkTags:Ze(D.LINK,a),metaTags:Ze(D.META,i),noscriptTags:Ze(D.NOSCRIPT,o),scriptTags:Ze(D.SCRIPT,d),styleTags:Ze(D.STYLE,u)},y={},S={};Object.keys(m).forEach(function(w){var k=m[w],N=k.newTags,j=k.oldTags;N.length&&(y[w]=N),j.length&&(S[w]=m[w].oldTags)}),t&&t(),c(e,y,S)},lt=null,Lt=function(e){function t(){for(var s,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(s=e.call.apply(e,[this].concat(i))||this).rendered=!1,s}Qn(t,e);var r=t.prototype;return r.shouldComponentUpdate=function(s){return!hd(s,this.props)},r.componentDidUpdate=function(){this.emitChange()},r.componentWillUnmount=function(){this.props.context.helmetInstances.remove(this),this.emitChange()},r.emitChange=function(){var s,a,i=this.props.context,o=i.setHelmet,c=null,d=(s=i.helmetInstances.get().map(function(u){var l=ne({},u.props);return delete l.context,l}),{baseTag:xd(["href"],s),bodyAttributes:hn("bodyAttributes",s),defer:tt(s,"defer"),encode:tt(s,"encodeSpecialCharacters"),htmlAttributes:hn("htmlAttributes",s),linkTags:ct(D.LINK,["rel","href"],s),metaTags:ct(D.META,["name","charset","http-equiv","property","itemprop"],s),noscriptTags:ct(D.NOSCRIPT,["innerHTML"],s),onChangeClientState:yd(s),scriptTags:ct(D.SCRIPT,["src","innerHTML"],s),styleTags:ct(D.STYLE,["cssText"],s),title:vd(s),titleAttributes:hn("titleAttributes",s),prioritizeSeoTags:bd(s,"prioritizeSeoTags")});et.canUseDOM?(a=d,lt&&cancelAnimationFrame(lt),a.defer?lt=requestAnimationFrame(function(){Qr(a,function(){lt=null})}):(Qr(a),lt=null)):On&&(c=On(d)),o(c)},r.init=function(){this.rendered||(this.rendered=!0,this.props.context.helmetInstances.add(this),this.emitChange())},r.render=function(){return this.init(),null},t}(h.Component);Lt.propTypes={context:jd.isRequired},Lt.displayName="HelmetDispatcher";var Td=["children"],Nd=["children"],kt=function(e){function t(){return e.apply(this,arguments)||this}Qn(t,e);var r=t.prototype;return r.shouldComponentUpdate=function(s){return!cd(Kr(this.props,"helmetData"),Kr(s,"helmetData"))},r.mapNestedChildrenToProps=function(s,a){if(!a)return null;switch(s.type){case D.SCRIPT:case D.NOSCRIPT:return{innerHTML:a};case D.STYLE:return{cssText:a};default:throw new Error("<"+s.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")}},r.flattenArrayTypeChildren=function(s){var a,i=s.child,o=s.arrayTypeChildren;return ne({},o,((a={})[i.type]=[].concat(o[i.type]||[],[ne({},s.newChildProps,this.mapNestedChildrenToProps(i,s.nestedChildren))]),a))},r.mapObjectTypeChildren=function(s){var a,i,o=s.child,c=s.newProps,d=s.newChildProps,u=s.nestedChildren;switch(o.type){case D.TITLE:return ne({},c,((a={})[o.type]=u,a.titleAttributes=ne({},d),a));case D.BODY:return ne({},c,{bodyAttributes:ne({},d)});case D.HTML:return ne({},c,{htmlAttributes:ne({},d)});default:return ne({},c,((i={})[o.type]=ne({},d),i))}},r.mapArrayTypeChildrenToProps=function(s,a){var i=ne({},a);return Object.keys(s).forEach(function(o){var c;i=ne({},i,((c={})[o]=s[o],c))}),i},r.warnOnInvalidChildren=function(s,a){return Vr(qr.some(function(i){return s.type===i}),typeof s.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":"Only elements types "+qr.join(", ")+" are allowed. Helmet does not support rendering <"+s.type+"> elements. Refer to our API for more information."),Vr(!a||typeof a=="string"||Array.isArray(a)&&!a.some(function(i){return typeof i!="string"}),"Helmet expects a string as a child of <"+s.type+">. Did you forget to wrap your children in braces? ( <"+s.type+">{``}</"+s.type+"> ) Refer to our API for more information."),!0},r.mapChildrenToProps=function(s,a){var i=this,o={};return he.Children.forEach(s,function(c){if(c&&c.props){var d=c.props,u=d.children,l=Gr(d,Td),p=Object.keys(l).reduce(function(y,S){return y[gd[S]||S]=l[S],y},{}),m=c.type;switch(typeof m=="symbol"?m=m.toString():i.warnOnInvalidChildren(c,u),m){case D.FRAGMENT:a=i.mapChildrenToProps(u,a);break;case D.LINK:case D.META:case D.NOSCRIPT:case D.SCRIPT:case D.STYLE:o=i.flattenArrayTypeChildren({child:c,arrayTypeChildren:o,newChildProps:p,nestedChildren:u});break;default:a=i.mapObjectTypeChildren({child:c,newProps:a,newChildProps:p,nestedChildren:u})}}}),this.mapArrayTypeChildrenToProps(o,a)},r.render=function(){var s=this.props,a=s.children,i=Gr(s,Nd),o=ne({},i),c=i.helmetData;return a&&(o=this.mapChildrenToProps(a,o)),!c||c instanceof Dn||(c=new Dn(c.context,c.instances)),c?he.createElement(Lt,ne({},o,{context:c.value,helmetData:void 0})):he.createElement(na.Consumer,null,function(d){return he.createElement(Lt,ne({},o,{context:d}))})},t}(h.Component);kt.propTypes={base:V.object,bodyAttributes:V.object,children:V.oneOfType([V.arrayOf(V.node),V.node]),defaultTitle:V.string,defer:V.bool,encodeSpecialCharacters:V.bool,htmlAttributes:V.object,link:V.arrayOf(V.object),meta:V.arrayOf(V.object),noscript:V.arrayOf(V.object),onChangeClientState:V.func,script:V.arrayOf(V.object),style:V.arrayOf(V.object),title:V.string,titleAttributes:V.object,titleTemplate:V.string,prioritizeSeoTags:V.bool,helmetData:V.object},kt.defaultProps={defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1},kt.displayName="Helmet";const Cd=({categories:e,selectedCategory:t,onSelectCategory:r})=>{const s=h.useRef(null);return h.useEffect(()=>{if(s.current){const a=s.current.querySelector(".pill.active");if(a){const i=s.current,o=a.offsetLeft-i.offsetWidth/2+a.offsetWidth/2;i.scrollTo({left:o,behavior:"smooth"})}}},[t]),n.jsx("div",{className:"category-pills-container",ref:s,children:e.map(a=>n.jsx("button",{onClick:()=>r(a),className:`pill ${t===a?"active":""}`,type:"button",children:a},a))})},kd=()=>n.jsxs("div",{className:"skeleton-card",children:[n.jsx("div",{className:"skel-badges",children:n.jsx("div",{className:"skel-badge skeleton-pulse"})}),n.jsx("div",{className:"skel-image-wrapper",children:n.jsx("div",{className:"skel-fill skeleton-pulse"})}),n.jsxs("div",{className:"skel-content",children:[n.jsxs("div",{className:"skel-meta-row",children:[n.jsx("div",{className:"skel-block skeleton-pulse",style:{width:"80px",height:"10px"}}),n.jsx("div",{className:"skel-block skeleton-pulse",style:{width:"60px",height:"10px"}})]}),n.jsxs("div",{children:[n.jsx("div",{className:"skel-title skel-block skeleton-pulse"}),n.jsx("div",{className:"skel-title-sub skel-block skeleton-pulse"})]}),n.jsxs("div",{className:"skel-summary-block",children:[n.jsx("div",{className:"skel-line skel-block skeleton-pulse"}),n.jsx("div",{className:"skel-line skel-block skeleton-pulse"}),n.jsx("div",{className:"skel-line skel-line-short skel-block skeleton-pulse"})]}),n.jsxs("div",{className:"skel-footer",children:[n.jsxs("div",{className:"skel-actions-left",children:[n.jsx("div",{className:"skel-icon skeleton-pulse"}),n.jsx("div",{className:"skel-icon skeleton-pulse"}),n.jsx("div",{className:"skel-icon skeleton-pulse"})]}),n.jsx("div",{className:"skel-text-btn skel-block skeleton-pulse"})]})]})]}),Ad=({slotId:e,format:t="fluid",layoutKey:r,className:s})=>{const a=h.useRef(null);return h.useEffect(()=>{if(!(a.current&&a.current.innerHTML.trim()!==""))try{(window.adsbygoogle||[]).push({})}catch(i){console.warn("AdSense push warning:",i)}},[e]),e?n.jsxs("div",{className:`ad-container ${s||""}`,style:{width:"100%",minHeight:"250px",display:"flex",flexDirection:"column",background:"var(--bg-card-flat, #fff)",borderRadius:"var(--radius-sm, 8px)",border:"1px solid var(--border-light)",alignSelf:"start",flexGrow:0,flexShrink:0,margin:"16px 0"},children:[n.jsx("div",{style:{textAlign:"center",fontSize:"10px",color:"#888",padding:"4px 0",background:"rgba(0,0,0,0.02)",borderBottom:"1px solid rgba(0,0,0,0.05)",flexShrink:0},children:"Advertisement"}),n.jsx("div",{style:{flex:1,width:"100%",display:"block"},children:n.jsx("ins",{ref:a,className:"adsbygoogle",style:{display:"block",width:"100%"},"data-ad-client":"ca-pub-2458153912750862","data-ad-slot":e,"data-ad-format":t,"data-ad-layout-key":r,"data-full-width-responsive":"true"})})]}):null},Ed=({onTopicClick:e,activeTopic:t})=>{const[r,s]=h.useState([]),[a,i]=h.useState(!0),o=h.useRef(null);h.useEffect(()=>{(async()=>{try{const{data:u}=await wl();s((u==null?void 0:u.data)||[])}catch(u){console.error("Failed to load In Focus topics",u),s([])}finally{i(!1)}})()},[]);const c=d=>{o.current&&(o.current.scrollLeft+=d.deltaY)};return!a&&r.length===0?null:n.jsxs("div",{className:"infocus-container",children:[n.jsxs("div",{className:"infocus-label",children:[n.jsx("span",{className:"pulse-dot"}),"IN FOCUS"]}),n.jsx("div",{className:"infocus-scroll-area",ref:o,onWheel:c,children:a?[80,100,70,90,60].map((d,u)=>n.jsx("div",{className:"infocus-pill skeleton",style:{width:`${d}px`}},u)):r.map((d,u)=>n.jsxs("button",{className:`infocus-pill ${d.topic===t?"active":""}`,style:d.topic===t?{background:"var(--accent-primary)",color:"white",borderColor:"var(--accent-primary)"}:{},onClick:()=>e==null?void 0:e(d.topic),children:["#",d.topic]},u))})]})},Id=st("Share",{web:()=>ue(()=>import("./web.jLF61sCP.js"),__vite__mapDeps([9,1,2,3,4,5])).then(e=>new e.ShareWeb)}),_d=()=>{const{addToast:e}=Ne();return{handleShare:async r=>{bl(r._id).catch(c=>console.error("Log Share Error:",c));const a=`${"http://localhost:3001/api".replace(/\/api\/?$/,"")}/api/share/${r._id}`,i=r.headline,o=`Read this on The Gamut: ${r.headline}
${a}`;try{_e.isNativePlatform()?await Id.share({title:i,text:o,url:a,dialogTitle:"Share to"}):navigator.share?await navigator.share({title:i,text:o}):(await navigator.clipboard.writeText(a),e("Link copied to clipboard!","success"))}catch(c){console.log("Share dismissed",c)}}}},Pd=(e,t)=>{var N;ua();const[r,s]=h.useState(!1),a=h.useRef(Date.now()),i=async({pageParam:j=0})=>{let b="/articles";const f={limit:20,offset:j};e==="balanced"?b="/articles/balanced":e==="infocus"?(b="/articles/infocus",t.category&&!t.category.startsWith("All")&&(f.category=t.category)):(b="/articles",t.category&&!t.category.startsWith("All")&&(f.category=t.category),t.sort&&(f.sort=t.sort),t.sentiment&&(f.sentiment=t.sentiment),t.politicalLean&&!t.politicalLean.startsWith("All")&&(f.politicalLean=t.politicalLean),t.source&&(f.source=t.source),t.topic&&(f.topic=t.topic));const{data:T}=await re.get(b,{params:f});return{items:T.data||[],meta:T.meta||{},total:T.total||0}},{data:o,fetchNextPage:c,hasNextPage:d,isFetchingNextPage:u,status:l,refetch:p,isRefetching:m}=ha({queryKey:["feed",e,t],queryFn:i,initialPageParam:0,getNextPageParam:(j,b)=>{const f=b.flatMap(T=>T.items).length;if(!(j.items.length<20))return f},staleTime:1e3*60*5,refetchOnWindowFocus:!1});h.useEffect(()=>{if(e!=="latest")return;const j=setInterval(async()=>{var b;try{const f=(b=o==null?void 0:o.pages[0])==null?void 0:b.items[0];if(!f||!("publishedAt"in f))return;const _=(await re.get("/articles",{params:{limit:1,...t}})).data.data[0];_&&_._id!==f._id&&s(!0)}catch{}},6e4);return()=>clearInterval(j)},[e,t,o]);const y=h.useRef(null);h.useEffect(()=>{if(!y.current||!d||u)return;const j=new IntersectionObserver(b=>{b[0].isIntersecting&&c()},{threshold:.1});return j.observe(y.current),()=>j.disconnect()},[d,u,c]);const S=(o==null?void 0:o.pages.flatMap(j=>j.items))||[],w=((N=o==null?void 0:o.pages[0])==null?void 0:N.meta)||{};return{feedItems:S,metaData:w,status:l,isRefreshing:m,refresh:()=>{s(!1),a.current=Date.now(),p()},loadMoreRef:y,showNewPill:r,isFetchingNextPage:u,hasNextPage:d}},Ld=e=>{if(!e)return{label:"Neutral",className:"sentiment-neutral",icon:""};const t=e.toLowerCase();return t==="positive"?{label:"Supportive",className:"sentiment-positive",icon:""}:t==="negative"?{label:"Critical",className:"sentiment-negative",icon:""}:{label:"Neutral",className:"sentiment-neutral",icon:""}},Ju=e=>Ld(e).className,Rd=e=>{if(!e)return!1;const t=(e.category||"").toLowerCase(),r=(e.headline||"").toLowerCase();return t.includes("opinion")||t.includes("editorial")||t.includes("commentary")||t.includes("perspective")||r.startsWith("opinion:")||r.includes(" op-ed ")},Qu=e=>({"Sentiment Polarity":"Measures the overall positive, negative, or neutral leaning of the language used.","Emotional Language":"Detects the prevalence of words intended to evoke strong emotional responses.","Loaded Terms":"Identifies words or phrases with strong connotations beyond their literal meaning.","Complexity Bias":"Assesses if overly complex or simplistic language is used to obscure or mislead.","Source Diversity":"Evaluates the variety of sources cited (e.g., political, expert, eyewitness).","Expert Balance":"Checks if experts from different perspectives are represented fairly.","Attribution Transparency":"Assesses how clearly sources are identified and attributed.","Gender Balance":"Measures the representation of different genders in sources and examples.","Racial Balance":"Measures the representation of different racial or ethnic groups.","Age Representation":"Checks for biases related to age groups in reporting.","Headline Framing":"Analyzes if the headline presents a neutral or skewed perspective of the story.","Story Selection":"Considers if the choice of this story over others indicates a potential bias.","Omission Bias":"Evaluates if significant facts or contexts are left out, creating a misleading picture.","Source Credibility":"Assesses the reputation and track record of the news source itself.","Fact Verification":"Evaluates the rigor of the fact-checking processes evident in the article.",Professionalism:"Measures adherence to journalistic standards like objectivity and transparency.","Evidence Quality":"Assesses the strength and reliability of the data and evidence presented.",Transparency:"Evaluates openness about sources, funding, and potential conflicts of interest.","Audience Trust":"Considers public perception and trust metrics associated with the source (if available).",Consistency:"Measures the source's consistency in accuracy and quality over time.","Temporal Stability":"Evaluates the source's track record and how long it has been operating reliably.","Quality Control":"Assesses the internal editorial review and error correction processes.","Publication Standards":"Evaluates adherence to established journalistic codes and ethics.","Corrections Policy":"Assesses the clarity, visibility, and timeliness of corrections for errors.","Update Maintenance":"Measures how well the source updates developing stories with new information."})[e]||e,Xr=(e,t=600)=>{if(e)return e.includes("cloudinary.com"),e},Zr=e=>{e&&e.includes("cloudinary.com")},Xu=["All Categories","Technology","Politics","Business","Health","Science","Sports","Entertainment","World","General"],Zu=["All Leans","Left","Center-Left","Center","Center-Right","Right"],eh=["Global","United States","India","Europe","Asia","Africa"],th=["All Types","News","Opinion","Analysis","Feature","Narrative"],nh=["All Quality Levels","High","Medium","Low"],rh=["Latest First","Oldest First","Highest Bias","Lowest Bias","Most Referenced"],At=e=>{const t=(e||"general").toLowerCase();return t.includes("tech")?"https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=800&q=80":t.includes("politic")?"https://images.unsplash.com/photo-1529101091760-61df51603896?auto=format&fit=crop&w=800&q=80":t.includes("business")||t.includes("financ")?"https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&w=800&q=80":t.includes("health")?"https://images.unsplash.com/photo-1505751172876-fa1923c5c528?auto=format&fit=crop&w=800&q=80":t.includes("science")?"https://images.unsplash.com/photo-1507413245164-6160d8298b31?auto=format&fit=crop&w=800&q=80":t.includes("sport")?"https://images.unsplash.com/photo-1461896836934-ffe607ba8211?auto=format&fit=crop&w=800&q=80":"https://images.unsplash.com/photo-1504711434969-e33886168f5c?auto=format&fit=crop&w=800&q=80"},gn="narrative_reading_progress",ra=(e={})=>{const[t,r]=h.useState(null),s=h.useCallback(c=>{try{return JSON.parse(localStorage.getItem(gn)||"{}")[c]||null}catch{return null}},[]),a=h.useCallback((c,d,u)=>{try{const l=JSON.parse(localStorage.getItem(gn)||"{}"),p=l[c];if(p&&p.scrollPercent>d)return;l[c]={articleId:c,scrollPercent:d,timestamp:Date.now(),status:u};const m=Object.keys(l);m.length>50&&delete l[m[0]],localStorage.setItem(gn,JSON.stringify(l))}catch(l){console.warn("Smart Resume Save Failed",l)}},[]);h.useEffect(()=>{if(e.articleId){const c=s(e.articleId);c&&c.scrollPercent>5?r(c.scrollPercent):r(null)}},[e.articleId,s]);const i=h.useCallback(()=>{var l,p;if(!e.articleId||!t)return;const d=(((l=e.scrollRef)==null?void 0:l.current)||document.documentElement).scrollHeight,u=t/100*d;(p=e.scrollRef)!=null&&p.current?e.scrollRef.current.scrollTo({top:u,behavior:"smooth"}):window.scrollTo({top:u,behavior:"smooth"})},[t,e.articleId,e.scrollRef]),o=h.useCallback(c=>{const d=s(c);if(!d||d.scrollPercent<5)return;const u=document.documentElement.scrollHeight,l=d.scrollPercent/100*u;window.scrollTo({top:l,behavior:"smooth"})},[s]);return{saveProgress:a,getProgress:s,autoResume:o,resumePosition:t,handleResume:i}},at=({size:e=20,strokeWidth:t=1.5,filled:r=!1,children:s,...a})=>n.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:r?"currentColor":"none",stroke:r?"none":"currentColor",strokeWidth:t,strokeLinecap:"round",strokeLinejoin:"round",...a,children:s}),Od=e=>n.jsx(at,{...e,filled:!0,viewBox:"0 0 24 24",children:n.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),Dd=e=>n.jsxs(at,{...e,filled:!0,viewBox:"0 0 24 24",children:[n.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),n.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]}),Md=({filled:e,...t})=>n.jsx(at,{...t,filled:e,children:n.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})}),$d=e=>n.jsxs(at,{...e,children:[n.jsx("circle",{cx:"18",cy:"5",r:"3"}),n.jsx("circle",{cx:"6",cy:"12",r:"3"}),n.jsx("circle",{cx:"18",cy:"19",r:"3"}),n.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),n.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),Bd=e=>n.jsxs(at,{...e,children:[n.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1-2-2h6"}),n.jsx("polyline",{points:"15 3 21 3 21 9"}),n.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]}),sa=e=>n.jsxs(at,{...e,children:[n.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),n.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),Fd=({articleId:e})=>{const[t,r]=h.useState(!0),[s,a]=h.useState([]),[i,o]=h.useState(null),c=h.useRef(!0),{isGuest:d}=Te(),u=rt();h.useEffect(()=>()=>{c.current=!1},[]);const l=async()=>{r(!0),o(null);try{const m=await re.get(`/articles/smart-briefing?articleId=${e}`);if(!c.current)return;if(m.data&&m.data.status==="success")a(m.data.data.keyPoints||[]);else throw new Error("Invalid response")}catch(m){if(!c.current)return;console.error("Brief fetch error:",m),o("Unable to load brief.")}finally{c.current&&r(!1)}};if(h.useEffect(()=>{l()},[e]),t)return n.jsxs("div",{className:"inline-brief-loading",children:[n.jsx("div",{className:"skeleton-line"}),n.jsx("div",{className:"skeleton-line"}),n.jsx("div",{className:"skeleton-line short"})]});if(i)return n.jsxs("div",{className:"inline-brief-error",children:[n.jsx("span",{className:"error-text",children:i}),n.jsxs("button",{onClick:l,className:"inline-retry-btn",children:[n.jsx(Ea,{sx:{fontSize:14}})," Retry"]})]});const p=n.jsxs("div",{className:"briefing-locked-section",style:{marginTop:"15px"},children:[n.jsx("div",{className:"briefing-lock-overlay",children:n.jsxs("button",{className:"lock-message-btn",onClick:()=>u("/login"),children:[n.jsx(sa,{size:14}),n.jsx("span",{children:"Login to Unlock Analysis"})]})}),n.jsxs("div",{className:"briefing-blur-content",children:[n.jsx("h4",{children:"Points of Conflict"}),n.jsxs("ul",{children:[n.jsx("li",{children:"Disagreement regarding the economic impact..."}),n.jsx("li",{children:"Multiple sources cite different timelines..."})]})]})]});return s.length===0&&!t?n.jsx("div",{className:"inline-brief-empty",children:"No briefing available."}):n.jsxs("div",{className:"inline-brief-container",children:[n.jsx("h4",{className:"inline-brief-title",children:"Key Takeaways"}),n.jsx("ul",{className:"inline-brief-list",children:s.map((m,y)=>n.jsx("li",{children:m},y))}),d&&p]})},Ud=h.memo(function({article:t,onCompare:r,onAnalyze:s,onShare:a,onRead:i,showTooltip:o,isSaved:c,onToggleSave:d,isPlaying:u,onPlay:l,onStop:p}){const[m,y]=h.useState(!1),[S,w]=h.useState(!1),{getProgress:k}=ra(),[N,j]=h.useState(null),[b,f]=h.useState(0),T=qe(),_=(t==null?void 0:t.analysisType)==="Full",g=Rd(t),v=At(t==null?void 0:t.category),P=Xr(t==null?void 0:t.imageUrl,600)||v,O=t!=null&&t.imageUrl?Zr(t.imageUrl):void 0,[F,U]=h.useState(P),[z,Y]=h.useState(O);h.useEffect(()=>{if(!t)return;const A=Xr(t.imageUrl,600)||At(t.category),Q=t.imageUrl?Zr(t.imageUrl):void 0;U(A),Y(Q),w(!1),y(!1);const J=k(t._id);J&&(j(J.status),f(Math.round(J.scrollPercent)))},[t==null?void 0:t.imageUrl,t==null?void 0:t.category,t==null?void 0:t._id,k]);const M=()=>{U(At(t==null?void 0:t.category)),Y(void 0)},L=A=>A.stopPropagation(),$=(A,Q="light")=>{T(Q),A()},W=A=>A?A.includes("Left")?"lean-left":A.includes("Right")?"lean-right":A==="Center"?"lean-center":"":"",R=A=>A?A==="Positive"?"sentiment-pos":A==="Negative"?"sentiment-neg":"sentiment-neu":"sentiment-neu",C=A=>A==="Positive"?"Supportive":A==="Negative"?"Critical":A,E=t&&(t.biasScore!==void 0||t.politicalLean&&t.politicalLean!=="Unknown"||t.sentiment);return t?n.jsx(n.Fragment,{children:n.jsxs("article",{className:`article-card ${u?"now-playing":""} ${m?"show-brief-mode":""}`,children:[n.jsxs("div",{className:"card-badges",children:[t.suggestionType==="Challenge"&&n.jsx("span",{className:"badge challenge",children:"Challenge"}),t.suggestionType==="Perspective"&&n.jsx("span",{className:"badge challenge",children:"Perspective Shift"}),g&&n.jsx("span",{className:"badge opinion",children:"Opinion"}),N==="read"&&n.jsx("span",{className:"badge badge-gold",title:"You read this deeply",children:"Deep Read"}),N==="skimmed"&&n.jsx("span",{className:"badge badge-grey",title:"You skimmed this quickly",children:"Skimmed"}),N==="partial"&&b>10&&n.jsxs("span",{className:"badge badge-resume",title:"Pick up where you left off",children:["Resume ",b,"%"]})]}),n.jsxs("div",{className:"article-image",children:[n.jsx("img",{src:F,srcSet:z,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",alt:"",onError:M,onLoad:()=>w(!0),loading:"lazy",style:{opacity:S?1:0}}),n.jsx("span",{className:"overlay-source",children:t.source}),n.jsx("time",{className:"overlay-date",children:new Date(t.publishedAt).toLocaleDateString()})]}),m&&_&&n.jsx("div",{className:"smart-brief-overlay",onClick:()=>y(!1),children:n.jsx("div",{className:"smart-brief-content",onClick:A=>A.stopPropagation(),children:n.jsx(Fd,{articleId:t._id})})}),n.jsxs("div",{className:"article-content",children:[n.jsx("button",{className:"article-headline-btn",onClick:A=>{L(A),$(()=>_?y(!m):null)},"aria-label":`Read analysis for ${t.headline}`,children:t.headline}),n.jsx("p",{className:"article-summary",children:t.summary}),n.jsxs("div",{className:"article-footer",children:[E&&n.jsxs("div",{className:"stats-container",children:[n.jsxs("div",{className:"stats-row",children:[t.biasScore!==void 0&&n.jsxs("button",{className:"stat-item-btn",onClick:A=>o("Bias Score (0-100). Lower is better.",A),children:[n.jsx("span",{children:"Bias:"}),n.jsx("span",{className:"stat-val accent-text",children:t.biasScore===0?"NA":t.biasScore})]}),t.politicalLean&&n.jsxs("div",{className:"stat-item",children:[n.jsx("span",{children:"Lean:"}),n.jsx("span",{className:`stat-val ${W(t.politicalLean)}`,children:t.politicalLean==="Unknown"||t.politicalLean==="Not Applicable"?"NA":t.politicalLean})]})]}),n.jsxs("div",{className:"stats-row",children:[(t.credibilityGrade||_)&&n.jsxs("div",{className:"stat-item",children:[n.jsx("span",{children:"Grade:"}),n.jsx("span",{className:"stat-val accent-text",children:t.credibilityGrade||"NA"})]}),t.sentiment&&n.jsxs("div",{className:"stat-item",children:[n.jsx("span",{children:"Sentiment:"}),n.jsx("span",{className:`stat-val ${R(t.sentiment)}`,children:C(t.sentiment)})]})]})]}),n.jsxs("div",{className:"action-bar",children:[n.jsx(Ee,{variant:"icon",isActive:u,onClick:A=>{L(A),$(()=>u&&p?p():l==null?void 0:l(),"medium")},title:u?"Stop":"Listen","aria-label":u?"Stop audio":"Listen to article",children:u?n.jsx(Dd,{size:13,strokeWidth:2}):n.jsx(Od,{size:13,strokeWidth:2})}),n.jsx(Ee,{variant:"icon",isActive:c,onClick:A=>{L(A),$(()=>d(t))},title:c?"Remove":"Save","aria-label":c?"Remove from saved":"Save article",children:n.jsx(Md,{filled:c,size:13,strokeWidth:2})}),n.jsx(Ee,{variant:"icon",onClick:A=>{L(A),$(()=>a(t))},title:"Share","aria-label":"Share article",children:n.jsx($d,{size:13,strokeWidth:2})}),n.jsx(Ee,{variant:"icon",onClick:A=>{L(A),$(()=>window.open(t.url,"_blank"))},title:"Read Source","aria-label":"Read original article",children:n.jsx(Bd,{size:13,strokeWidth:2})}),n.jsx(Ee,{variant:"text",onClick:A=>{L(A),$(()=>{_?y(!m):i(t)})},children:_?m?"Close Brief":"Smart Brief":"Read Source"})]})]})]})]})}):null}),Hd=h.memo(({data:e,onClick:t})=>{const r=e.executiveSummary||"No summary available.",s=At(e.category),a=e.lastUpdated?new Date(e.lastUpdated).toLocaleDateString():"",i=o=>o.stopPropagation();return n.jsxs("article",{className:"article-card narrative-card-variant",onClick:t,style:{cursor:"pointer"},children:[n.jsx("div",{className:"card-badges",children:n.jsx("span",{className:"badge challenge",style:{background:"var(--accent-primary)",color:"white"},children:"Developing Narratives"})}),n.jsx("div",{className:"article-image",children:n.jsx("img",{src:s,alt:e.category,loading:"lazy"})}),n.jsxs("div",{className:"article-content",children:[n.jsxs("div",{className:"article-meta-top",children:[n.jsxs("span",{className:"source-name",children:[e.sourceCount," Sources Analyzed"]}),a&&n.jsx("time",{className:"date",children:a})]}),n.jsx("button",{className:"article-headline-btn",onClick:o=>{i(o),t()},children:e.masterHeadline||"Untitled Narrative"}),n.jsx("p",{className:"article-summary",children:r.length>140?`${r.substring(0,140)}...`:r}),n.jsx("div",{className:"article-footer",children:n.jsxs("div",{className:"action-bar",children:[n.jsx("div",{className:"action-left"}),n.jsx(Ee,{variant:"text",onClick:o=>{i(o),t()},children:"Open Briefing "})]})})]})]})}),zd=({item:e,onOpenNarrative:t,onCompare:r,onAnalyze:s,onShare:a,savedArticleIds:i,onToggleSave:o,showTooltip:c,currentArticleId:d,playSingle:u,stop:l,onImpression:p})=>{const m=h.useRef(null),y=h.useRef(!1),S=b=>b.type==="Narrative";h.useEffect(()=>{const b=m.current;if(!b||y.current)return;const f=new IntersectionObserver(T=>{T.forEach(_=>{if(_.isIntersecting&&_.intersectionRatio>=.5){y.current=!0,p&&p(e);const g=e.category||"General",v=new CustomEvent("narrative-impression",{detail:{itemId:e._id,itemType:S(e)?"Narrative":"Article",category:g,timestamp:new Date}});window.dispatchEvent(v),f.disconnect()}})},{threshold:.5});return f.observe(b),()=>{f.disconnect()}},[e,p]);const w=h.useCallback(b=>{b.url&&window.open(b.url,"_blank","noopener,noreferrer")},[]);if(S(e))return n.jsx("div",{ref:m,className:"feed-item-wrapper",style:{height:"100%"},children:n.jsx(Hd,{data:e,onClick:()=>t(e)})});const k=e,N=d===k._id,j=i.has(k._id);return n.jsx("div",{ref:m,className:"feed-item-wrapper",style:{height:"100%"},id:k._id,"data-article-id":k._id,children:n.jsx(Ud,{article:k,onCompare:r,onAnalyze:s,onShare:a,onRead:w,showTooltip:c,isSaved:j,onToggleSave:o,isPlaying:N,onPlay:()=>u(k),onStop:l})})},Wd=he.memo(zd),Vd=he.memo(({mode:e,filters:t,onFilterChange:r,vibrate:s,activeTopic:a,onClearTopic:i})=>n.jsx("div",{className:"feed-header-sticky",children:n.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[e==="latest"&&r&&!a&&n.jsx(Cd,{categories:["All","Technology","Business","Science","Health","Entertainment","Sports","World","Politics"],selectedCategory:t.category||"All",onSelectCategory:o=>{s(),r({...t,category:o})}}),e==="latest"&&a&&n.jsxs("div",{style:{padding:"8px 12px",background:"var(--bg-elevated)",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"var(--text-primary)",fontWeight:600},children:["Filtered by: ",n.jsxs("span",{style:{color:"var(--accent-primary)"},children:["#",a]})]}),n.jsx("button",{onClick:i,style:{background:"none",border:"none",color:"var(--text-tertiary)",fontSize:"0.8rem",cursor:"pointer"},children:"Clear "})]}),e==="infocus"&&n.jsx("div",{style:{padding:"8px 12px",background:"var(--surface-paper)",borderBottom:"1px solid var(--border-color)"},children:n.jsx("p",{style:{margin:0,fontSize:"0.9rem",color:"var(--accent-primary)",fontWeight:600},children:"Developing Narratives"})})]})})),Gd=({mode:e,filters:t={},onFilterChange:r,onAnalyze:s,onCompare:a,onOpenNarrative:i,savedArticleIds:o,onToggleSave:c,showTooltip:d,scrollToTopRef:u})=>{const[l,p]=h.useState(null),m=h.useMemo(()=>({...t,topic:l}),[t,l]),{feedItems:y,status:S,isRefreshing:w,refresh:k,loadMoreRef:N,showNewPill:j,isFetchingNextPage:b,hasNextPage:f}=Pd(e,m),{playSingle:T,stop:_,currentArticle:g,updateContextQueue:v,updateVisibleArticle:P,isPlaying:O}=Bt(),{handleShare:F}=_d(),U=Ut(),z=qe(),{isGuest:Y}=Te(),[M,L]=h.useState(!1),$=h.useRef(""),W=h.useRef(null),R=h.useRef(new Map),C=h.useRef(null),E=h.useMemo(()=>{const H=new Map;return y.forEach(K=>{K.type==="Article"&&H.set(K._id,K)}),H},[y]),[A,Q]=he.useState();Ft(A,E);const J=h.useMemo(()=>y.filter(H=>H.type!=="Narrative"),[y]),ee=h.useMemo(()=>J.map(H=>H._id).join(","),[J]);h.useEffect(()=>{if(ee&&ee!==$.current){let H="Latest News";e==="infocus"&&(H="In Focus"),t!=null&&t.category&&t.category!=="All"&&(H=t.category),v(J,H),$.current=ee}},[ee,J,e,t,v]),h.useEffect(()=>{if(S!=="success")return;const H={root:null,rootMargin:"0px",threshold:.6};return W.current=new IntersectionObserver(K=>{K.forEach(Ce=>{if(Ce.isIntersecting){const ot=Ce.target.getAttribute("data-article-id");ot&&(P(ot),Q(ot))}})},H),R.current.forEach(K=>{var Ce;K&&((Ce=W.current)==null||Ce.observe(K))}),()=>{var K;(K=W.current)==null||K.disconnect()}},[y,S,P]),h.useEffect(()=>{const H=g==null?void 0:g._id;if(O&&H){if(H===C.current)return;const K=R.current.get(H);K&&(C.current=H,K.scrollIntoView({behavior:"smooth",block:"center"}))}},[g==null?void 0:g._id,O]);const ge=h.useCallback((H,K)=>{H?(R.current.set(K,H),W.current&&W.current.observe(H)):R.current.delete(K)},[]),X=()=>{z(),k(),u!=null&&u.current&&(u.current.scrollTop=0)},Z=H=>{Y?L(!0):c(H)},ve=H=>{Y?L(!0):T(H)},Be=H=>{z(),p(K=>K===H?null:H),u!=null&&u.current&&(u.current.scrollTop=0)};return n.jsxs("div",{className:"feed-page-container",children:[n.jsx("div",{className:`new-content-pill ${j?"visible":""}`,onClick:X,children:n.jsx("span",{children:" New Articles Available"})}),e==="latest"&&n.jsx(Ed,{onTopicClick:Be,activeTopic:l}),n.jsx(Vd,{mode:e,filters:m,onFilterChange:r,vibrate:z,activeTopic:l,onClearTopic:()=>Be(l)}),n.jsx("div",{className:`articles-grid ${U?"mobile-stack":""}`,ref:u,children:S==="pending"&&!w?n.jsxs(n.Fragment,{children:[" ",[...Array(6)].map((H,K)=>n.jsx("div",{className:"article-card-wrapper",children:n.jsx(kd,{})},K))," "]}):S==="error"?n.jsxs("div",{style:{textAlign:"center",marginTop:"50px",color:"var(--text-tertiary)"},children:[n.jsx("p",{children:"Unable to load feed."}),n.jsx("button",{onClick:X,className:"btn-secondary",style:{marginTop:"10px"},children:"Retry"})]}):y.length===0&&!w?n.jsxs("div",{style:{textAlign:"center",marginTop:"50px",color:"var(--text-tertiary)"},children:[n.jsx("h3",{children:"No articles found"}),n.jsx("p",{children:l?`No stories found for #${l}`:"Try refreshing or checking back later."}),n.jsx("button",{onClick:X,className:"btn-secondary",style:{marginTop:"15px"},children:"Force Refresh"})]}):n.jsxs(n.Fragment,{children:[y.map((H,K)=>n.jsxs(he.Fragment,{children:[K>0&&K%7===0&&n.jsx(Ad,{slotId:"1234567890",layoutKey:"-6t+ed+2i-1n-4w"}),n.jsx("div",{ref:Ce=>ge(Ce,H._id),"data-article-id":H._id,className:`feed-article-wrapper ${(g==null?void 0:g._id)===H._id?"now-playing-highlight":""}`,children:n.jsx(Wd,{item:H,onOpenNarrative:i,onCompare:a,onAnalyze:s,onShare:F,savedArticleIds:o,onToggleSave:Z,showTooltip:d,currentArticleId:g==null?void 0:g._id,playSingle:ve,stop:_})})]},H._id)),e==="latest"&&n.jsx("div",{className:"load-more-container",ref:N,children:b?n.jsx("div",{className:"spinner-small"}):f?n.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Loading more..."}):n.jsx("div",{className:"end-message",children:"You're all caught up"})}),n.jsx("div",{style:{height:"80px",flexShrink:0,scrollSnapAlign:"none"}})]})}),n.jsx(Jn,{isOpen:M,onClose:()=>L(!1),message:"Join The Gamut to save articles, listen to stories, and customize your feed."})]})},qd=({clusterData:e})=>{if(!e)return null;const t=[...e.left||[],...e.center||[],...e.right||[],...e.reviews||[],...e.others||[]];if(t.length===0)return n.jsx("div",{className:"no-data-msg",children:"No articles available for timeline."});const r=t.sort((i,o)=>new Date(o.publishedAt).getTime()-new Date(i.publishedAt).getTime()),s=i=>{const o=i.toLowerCase();return o.includes("left")?"left-aligned":o.includes("right")?"right-aligned":"center-aligned"},a=i=>{const o=i.toLowerCase();return o.includes("left")?"Left":o.includes("right")?"Right":o.includes("center")?"Center":"Neutral"};return n.jsxs("div",{className:"timeline-container",children:[n.jsx("div",{className:"timeline-spine"}),r.map((i,o)=>{const c=i.politicalLean||"Neutral",d=s(c),u=a(c),l=i.publishedAt?pa(new Date(i.publishedAt),"MMM d  h:mm a"):"";return n.jsxs("div",{className:`timeline-row ${d}`,children:[n.jsx("div",{className:`timeline-node ${u}`}),n.jsxs("div",{className:"timeline-card",children:[n.jsxs("div",{className:"card-header",children:[n.jsx("span",{className:"source-name",children:i.source}),n.jsx("span",{children:l})]}),n.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",className:"timeline-headline",children:i.headline}),n.jsx("div",{className:"card-footer",children:n.jsx("span",{className:`bias-tag ${u}`,children:c})})]})]},i._id||o)})]})},Kd=({data:e,onClose:t})=>{const[r,s]=h.useState("consensus"),[a,i]=h.useState(null),[o,c]=h.useState(!1),d=h.useRef(null),{isGuest:u}=Te(),{addToast:l}=Ne(),p=rt();Ft(e==null?void 0:e._id,"narrative");const{resumePosition:m,handleResume:y}=ra({articleId:e==null?void 0:e._id,scrollRef:d});if(h.useEffect(()=>{m&&l("Resume where you left off?","info",{label:"Resume",onClick:y})},[m,l,y]),h.useEffect(()=>{r==="timeline"&&!a&&(e!=null&&e.clusterId)&&!u&&(c(!0),pl(e.clusterId).then(N=>{i(N.data)}).catch(N=>{console.error("Failed to load timeline",N)}).finally(()=>{c(!1)}))},[r,e,a,u]),!e)return null;const S=N=>{N.target===N.currentTarget&&t()},w=()=>{t(),p("/login")},k=({label:N="Unlock Full Analysis"})=>n.jsx("div",{className:"nm-lock-overlay",children:n.jsxs("button",{className:"nm-lock-btn",onClick:w,children:[n.jsx(sa,{size:16}),n.jsx("span",{children:N})]})});return n.jsx("div",{className:"narrative-modal-overlay",onClick:S,children:n.jsxs("div",{className:"narrative-modal-content",onClick:N=>N.stopPropagation(),ref:d,children:[n.jsxs("div",{className:"nm-header",children:[n.jsxs("div",{className:"nm-header-top",children:[n.jsx("span",{className:"nm-badge",children:"Narrative Synthesis"}),n.jsx("button",{className:"nm-close-btn",onClick:t,children:""})]}),n.jsx("h2",{className:"nm-headline",children:e.masterHeadline}),n.jsxs("div",{className:"nm-meta",children:["Analyzed ",e.sourceCount," Sources  Updated ",new Date(e.lastUpdated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"nm-tabs",children:[n.jsx("button",{className:`nm-tab ${r==="consensus"?"active":""}`,onClick:()=>s("consensus"),children:"The Consensus"}),n.jsx("button",{className:`nm-tab ${r==="divergence"?"active":""}`,onClick:()=>s("divergence"),children:"The Conflict"}),n.jsx("button",{className:`nm-tab ${r==="timeline"?"active":""}`,onClick:()=>s("timeline"),children:"Timeline"})]}),n.jsxs("div",{className:"nm-body",children:[r==="consensus"&&n.jsxs("div",{className:"nm-tab-content fade-in",children:[n.jsxs("div",{className:"nm-summary-box",children:[n.jsx("h3",{children:"Executive Summary"}),n.jsx("p",{children:e.executiveSummary})]}),n.jsxs("div",{className:"nm-points-list",children:[n.jsx("h3",{children:"Agreed Facts"}),u?n.jsxs("div",{className:"nm-locked-section",children:[n.jsx(k,{label:"Login to view agreed facts"}),n.jsx("div",{className:"nm-blur-content",children:n.jsx("ul",{children:[1,2,3].map((N,j)=>n.jsxs("li",{children:[n.jsx("span",{className:"nm-check-icon",children:""}),"Lorem ipsum dolor sit amet, consectetur adipiscing elit."]},j))})})]}):n.jsx("ul",{children:e.consensusPoints.map((N,j)=>n.jsxs("li",{children:[n.jsx("span",{className:"nm-check-icon",children:""}),N]},j))})]})]}),r==="divergence"&&n.jsxs("div",{className:"nm-tab-content fade-in",children:[n.jsx("p",{className:"nm-intro-text",children:"Where the reporting differs or conflicts:"}),u?n.jsxs("div",{className:"nm-locked-section",children:[n.jsx(k,{label:"Login to see conflicting perspectives"}),n.jsx("div",{className:"nm-blur-content",children:[1,2].map(N=>n.jsxs("div",{className:"nm-divergence-card",children:[n.jsxs("div",{className:"nm-divergence-header",children:[n.jsxs("span",{className:"nm-index",children:["0",N]}),n.jsx("h4",{children:"Sample conflict point blurred out..."})]}),n.jsx("div",{className:"nm-perspectives",children:n.jsxs("div",{className:"nm-perspective-row",children:[n.jsx("span",{className:"nm-p-source",children:"Source A:"}),n.jsx("span",{className:"nm-p-stance",children:'"Sample stance text..."'})]})})]},N))})]}):n.jsx(n.Fragment,{children:e.divergencePoints.map((N,j)=>n.jsxs("div",{className:"nm-divergence-card",children:[n.jsxs("div",{className:"nm-divergence-header",children:[n.jsxs("span",{className:"nm-index",children:["0",j+1]}),n.jsx("h4",{children:N.point})]}),n.jsx("div",{className:"nm-perspectives",children:N.perspectives.map((b,f)=>n.jsxs("div",{className:"nm-perspective-row",children:[n.jsxs("span",{className:"nm-p-source",children:[b.source,":"]}),n.jsxs("span",{className:"nm-p-stance",children:['"',b.stance,'"']})]},f))})]},j))})]}),r==="timeline"&&n.jsxs("div",{className:"nm-tab-content fade-in",children:[n.jsx("p",{className:"nm-intro-text",children:"Timeline of coverage for this story:"}),u?n.jsxs("div",{className:"nm-locked-section",children:[n.jsx(k,{label:"Login to view timeline"}),n.jsx("div",{className:"nm-blur-content",children:n.jsx("div",{style:{height:"200px",background:"var(--bg-secondary)",borderRadius:"12px"}})})]}):o?n.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"Loading timeline data..."}):n.jsx(qd,{clusterData:a}),n.jsx("div",{className:"nm-note",style:{marginTop:"15px"},children:"* Articles are sorted by publication time to show how the story developed."})]})]})]})})},Yd=({filters:e,onFilterChange:t,onAnalyze:r,onCompare:s,savedArticleIds:a,onToggleSave:i,showTooltip:o})=>{const[c,d]=h.useState("latest"),[u,l]=h.useState("enter-right"),[p,m]=h.useState(null),[y,S]=h.useState(!1),w=h.useRef(null),k=Ut(),N=qe(),{isGuest:j}=Te(),b=(M,L)=>{N(),l(L),d(M)},f=h.useRef(null),T=h.useRef(null),_=h.useRef(null),g=h.useRef(null),v=90,P=M=>{const L=M.targetTouches[0].clientY,$=window.innerHeight;if(L<150||L>$-120){f.current=null,_.current=null;return}T.current=null,f.current=M.targetTouches[0].clientX,g.current=null,_.current=L},O=M=>{T.current=M.targetTouches[0].clientX,g.current=M.targetTouches[0].clientY},F=()=>{if(!f.current||!T.current||!_.current||!g.current)return;const M=f.current-T.current,L=_.current-g.current;if(Math.abs(L)>Math.abs(M))return;const $=M>v,W=M<-v;$&&c==="latest"&&b("infocus","enter-right"),W&&c==="infocus"&&b("latest","enter-left")},U=()=>c==="infocus"?"Narratives | The Gamut":e.category&&e.category!=="All Categories"?`${e.category} News | The Gamut`:"The Gamut - Analyse The Full Spectrum",z=()=>n.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"4px",marginTop:"20px"},children:n.jsx("div",{style:{display:"flex",background:"var(--bg-elevated)",borderRadius:"25px",padding:"4px",border:"1px solid var(--border-color)",position:"relative"},children:["latest","infocus"].map(M=>n.jsx("button",{onClick:()=>b(M,"enter-right"),style:{background:c===M?"var(--accent-primary)":"transparent",color:c===M?"white":"var(--text-secondary)",border:"none",borderRadius:"20px",padding:"8px 16px",fontSize:"11px",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",textTransform:"capitalize",display:"flex",alignItems:"center",gap:"6px"},children:M==="infocus"?"Narratives":"Top Stories"},M))})}),Y=()=>n.jsx("div",{style:{position:"sticky",top:0,zIndex:900,background:"var(--bg-primary)",borderBottom:"1px solid var(--border-light)",marginBottom:"5px",marginTop:0,paddingTop:"0px"},children:n.jsx("div",{style:{display:"flex",width:"100%"},children:[{id:"latest",label:"Latest"},{id:"infocus",label:"Narratives"}].map(M=>{const L=c===M.id;let $="enter-right";return c==="latest"&&M.id==="infocus"&&($="enter-right"),c==="infocus"&&M.id==="latest"&&($="enter-left"),n.jsxs("div",{onClick:()=>{L||b(M.id,$)},style:{flex:1,textAlign:"center",padding:"8px 0",cursor:"pointer",position:"relative",color:L?"var(--text-primary)":"var(--text-tertiary)",fontWeight:L?700:500,fontSize:"11px",textTransform:"uppercase",letterSpacing:"0.5px",transition:"color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[M.label,n.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"3px",background:"var(--accent-primary)",opacity:L?1:0,transform:L?"scaleX(1)":"scaleX(0)",transition:"all 0.3s"}})]},M.id)})})});return n.jsxs("main",{className:"content",style:k?{padding:0,overflow:"hidden",height:"100vh"}:void 0,onTouchStart:P,onTouchMove:O,onTouchEnd:F,children:[n.jsx(kt,{children:n.jsx("title",{children:U()})}),k?Y():z(),n.jsx("div",{className:`feed-anim-wrapper ${u}`,children:n.jsx(Gd,{mode:c,filters:e,onFilterChange:t,onAnalyze:r,onCompare:s,onOpenNarrative:m,savedArticleIds:a,onToggleSave:i,showTooltip:o,scrollToTopRef:w})},c),p&&n.jsx(Kd,{data:p,onClose:()=>m(null)}),n.jsx(Jn,{isOpen:y,onClose:()=>S(!1),message:"Login to access this feature."})]})},Jd=()=>{Ia();const{currentArticle:e,currentSpeaker:t,isPlaying:r,isPaused:s,isLoading:a,isVisible:i,playerOpen:o,openPlayer:c,closePlayer:d,stop:u,pause:l,resume:p,playNext:m,playPrevious:y,isWaitingForNext:S,autoplayTimer:w,cancelAutoplay:k,currentTime:N,duration:j,seekTo:b,playbackRate:f,changeSpeed:T}=Bt(),{addToast:_}=Ne(),g=qe(),v=Ut(),[P,O]=h.useState(!1),[F,U]=h.useState(0),[z,Y]=h.useState(!1),[M,L]=h.useState(!0),$=h.useRef(null),W=()=>{$.current&&clearTimeout($.current),v&&r&&o&&($.current=setTimeout(()=>{d()},7e3))};if(h.useEffect(()=>(o?W():$.current&&clearTimeout($.current),()=>{$.current&&clearTimeout($.current)}),[o,r,v]),h.useEffect(()=>{P||U(N)},[N,P]),h.useEffect(()=>{const Z=setTimeout(()=>L(!1),8e3);return()=>clearTimeout(Z)},[]),h.useEffect(()=>{r&&(Y(!0),L(!1))},[r]),!i)return null;if(!o)return n.jsx(Vt,{in:!0,children:n.jsxs(we,{className:"global-player-bar-container minimized",onClick:()=>{g(),c()},children:[n.jsx("div",{className:"glass-background-layer"}),n.jsxs(we,{className:"player-content-layer",children:[n.jsx(Ke,{className:"mini-bar-text",children:"Gamut Radio"}),n.jsx(_a,{sx:{fontSize:20,color:"var(--accent-primary)"}})]})]})});const R=Z=>()=>{g(),Z(),W()},C=()=>{g(),u(),_("Radio stopped","info")},E=()=>{g(),d()},A=(Z,ve)=>{U(ve),W()},Q=()=>{O(!0),W()},J=(Z,ve)=>{O(!1),b(ve),W()},ee=()=>{g();const Z=[1,1.25,1.5,.5,.75],ve=(Z.indexOf(f)+1)%Z.length;T(Z[ve]),W()},ge=Z=>{if(!Z||isNaN(Z))return"0:00";const ve=Math.floor(Z/60),Be=Math.floor(Z%60);return`${ve}:${Be<10?"0":""}${Be}`};let X="";return r?X="pulse-active-heartbeat":!z&&M&&i&&(X="pulse-invite-radar"),S?n.jsx(Vt,{in:!0,children:n.jsxs(we,{className:"global-player-bar up-next-mode",onClick:W,children:[n.jsxs(we,{sx:{flex:1,mr:2},children:[n.jsxs(Ke,{variant:"overline",sx:{fontWeight:700,letterSpacing:1,color:"var(--accent-primary)"},children:["Up Next in ",w,"s..."]}),n.jsx(Pa,{variant:"determinate",value:(w||0)/5*100,sx:{height:4,borderRadius:2,mt:.5,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{backgroundColor:"var(--accent-primary)"}}})]}),n.jsxs(Gt,{direction:"row",spacing:1,children:[n.jsxs(rr,{size:"small",variant:"extended",onClick:R(m),sx:{bgcolor:"var(--accent-primary)",color:"var(--bg-primary)","&:hover":{bgcolor:"var(--accent-hover)"}},children:[n.jsx(sr,{sx:{mr:1,fontSize:18}})," Play Now"]}),n.jsx(Ue,{size:"small",onClick:R(k),sx:{color:"var(--text-secondary)"},children:n.jsx(ar,{})})]})]})}):n.jsx(Vt,{in:!0,children:n.jsxs(we,{className:"global-player-bar-container",onClick:W,children:[n.jsx("div",{className:"glass-background-layer"}),n.jsxs(we,{className:"player-content-layer",children:[n.jsxs(we,{className:"player-section left",children:[t&&n.jsxs(Ke,{variant:"caption",sx:{color:"var(--accent-primary)",fontWeight:700,display:"flex",alignItems:"center",gap:.5},children:[n.jsx(we,{className:`pulse-dot-small ${r?"active":""}`,sx:{bgcolor:"var(--accent-primary)"}}),t.name]}),n.jsx(Ke,{variant:"subtitle2",sx:{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",lineHeight:1.2,color:"var(--text-primary)"},children:a?"Buffering...":e==null?void 0:e.headline})]}),n.jsxs(we,{className:"player-section center",children:[n.jsxs(Gt,{direction:"row",alignItems:"center",spacing:v?1:2,sx:{mb:0},children:[n.jsx(Ue,{size:"small",onClick:R(y),sx:{color:"var(--text-primary)"},children:n.jsx(La,{})}),n.jsxs(we,{className:"fab-container",children:[n.jsx("div",{className:`pulse-ring ${X}`}),n.jsx(rr,{size:v?"small":"medium",onClick:R(s?p:l),disableRipple:!0,sx:{boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:10,width:v?40:48,height:v?40:48,minHeight:"auto",bgcolor:"var(--accent-primary)",color:"var(--bg-primary)","&:hover":{bgcolor:"var(--accent-hover)"},transition:"all 0.2s ease"},children:n.jsxs("div",{className:"morph-container",children:[n.jsx("div",{className:`morph-icon ${s?"visible":"hidden"}`,children:n.jsx(sr,{fontSize:"medium"})}),n.jsx("div",{className:`morph-icon ${s?"hidden":"visible"}`,children:n.jsx(Ra,{fontSize:"medium"})})]})})]}),n.jsx(Ue,{size:"small",onClick:R(m),sx:{color:"var(--text-primary)"},children:n.jsx(Oa,{})})]}),n.jsxs(Gt,{direction:"row",alignItems:"center",spacing:2,sx:{width:"100%",mt:0},children:[n.jsx(Ke,{variant:"caption",sx:{minWidth:35,textAlign:"right",fontSize:"0.7rem",color:"var(--text-secondary)"},children:ge(F)}),n.jsx(Da,{size:"small",value:F,min:0,max:j||100,onChange:A,onChangeCommitted:J,onMouseDown:Q,onTouchStart:Q,sx:{color:"var(--accent-primary)",height:3,padding:"6px 0","& .MuiSlider-thumb":{width:8,height:8,transition:"0.2s","&:hover, &.Mui-focusVisible":{boxShadow:"0px 0px 0px 6px var(--accent-glow)"},"&.Mui-active":{width:12,height:12}},"& .MuiSlider-rail":{opacity:.3,backgroundColor:"var(--text-secondary)"}}}),n.jsx(Ke,{variant:"caption",sx:{minWidth:35,fontSize:"0.7rem",color:"var(--text-secondary)"},children:ge(j)})]})]}),n.jsxs(we,{className:"player-section right",children:[n.jsx(qt,{title:"Playback Speed",children:n.jsxs(Ue,{onClick:ee,size:"small",sx:{fontSize:"0.7rem",fontWeight:700,border:"1px solid",borderColor:"var(--border-color)",borderRadius:2,px:1,py:.5,width:"auto",mr:1,color:"var(--text-secondary)"},children:[f,"x"]})}),!v&&n.jsxs(n.Fragment,{children:[n.jsx(qt,{title:"Minimize Player",children:n.jsx(Ue,{onClick:E,size:"small",sx:{color:"var(--text-secondary)",ml:1},children:n.jsx(Ma,{fontSize:"small"})})}),n.jsx(qt,{title:"Stop Radio",children:n.jsx(Ue,{onClick:C,size:"small",sx:{color:"var(--color-error)",ml:1},children:n.jsx($a,{fontSize:"small"})})})]}),v&&n.jsx(Ue,{onClick:E,size:"small",sx:{color:"var(--text-secondary)"},children:n.jsx(ar,{fontSize:"small"})})]})]})]})})},Qd=({currentFilters:e,onOpenFilters:t})=>{const{isPlaying:r,isPaused:s,startRadio:a,currentArticle:i,togglePlayer:o,contextQueue:c,contextLabel:d}=Bt(),{addToast:u}=Ne(),l=qe(),[p,m]=h.useState(!1),y=async w=>{if(w.preventDefault(),l(),!p){if(r||s&&i){o();return}if(m(!0),c&&c.length>0){u(`Tuning into ${d}...`,"info"),a(c,0),m(!1);return}u("Tuning into Gamut Radio...","info");try{const{data:k}=await Vs({limit:20,offset:0});k.articles&&k.articles.length>0?a(k.articles,0):u("No news available for radio.","error")}catch(k){console.error("Radio start failed",k),u("Could not start radio.","error")}finally{m(!1)}}},S={width:22,height:22,fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"};return n.jsxs("nav",{className:"bottom-nav",style:{paddingBottom:"var(--sab)",height:"calc(60px + var(--sab))",boxSizing:"content-box"},children:[n.jsxs(Ae,{to:"/",className:({isActive:w})=>`nav-item ${w?"active":""}`,end:!0,onClick:()=>l(),children:[n.jsx("div",{className:"nav-icon",children:n.jsxs("svg",{...S,viewBox:"0 0 24 24",children:[n.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),n.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),n.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),n.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})}),n.jsx("span",{className:"nav-label",children:"Feed"})]}),n.jsxs(Ae,{to:"/my-dashboard",className:({isActive:w})=>`nav-item ${w?"active":""}`,onClick:()=>l(),children:[n.jsx("div",{className:"nav-icon",children:n.jsxs("svg",{...S,viewBox:"0 0 24 24",children:[n.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),n.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),n.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})}),n.jsx("span",{className:"nav-label",children:"Stats"})]}),n.jsxs("div",{className:`nav-item radio-action ${r?"playing":""} ${s?"paused":""}`,onClick:y,children:[n.jsx("div",{className:"radio-circle",children:p?n.jsx("div",{className:"spinner-small",style:{width:"20px",height:"20px",border:"2px solid rgba(255,255,255,0.3)",borderTopColor:"#FFF",marginRight:0}}):r||s?n.jsxs("div",{className:"wave-container",children:[n.jsx("div",{className:"wave-bar"}),n.jsx("div",{className:"wave-bar"}),n.jsx("div",{className:"wave-bar"})]}):n.jsxs("svg",{...S,strokeWidth:2,width:26,height:26,viewBox:"0 0 24 24",style:{marginLeft:"0"},children:[n.jsx("path",{d:"M3 18v-6a9 9 0 0 1 18 0v6"}),n.jsx("path",{d:"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"})]})}),n.jsx("span",{className:"nav-label radio-label",children:p?"Loading":r||s?"Now Playing":"Radio"})]}),n.jsxs("div",{className:"nav-item",onClick:()=>{l(),t&&t()},children:[n.jsx("div",{className:"nav-icon",children:n.jsxs("svg",{...S,viewBox:"0 0 24 24",children:[n.jsx("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),n.jsx("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),n.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),n.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),n.jsx("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),n.jsx("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),n.jsx("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),n.jsx("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),n.jsx("line",{x1:"17",y1:"16",x2:"23",y2:"16"})]})}),n.jsx("span",{className:"nav-label",children:"Filters"})]}),n.jsxs(Ae,{to:"/profile-menu",className:({isActive:w})=>`nav-item ${w?"active":""}`,onClick:()=>l(),children:[n.jsx("div",{className:"nav-icon",children:n.jsxs("svg",{...S,viewBox:"0 0 24 24",children:[n.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),n.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),n.jsx("span",{className:"nav-label",children:"Profile"})]})]})},Xd=({visible:e,text:t,x:r,y:s})=>{if(!e)return null;const a={position:"fixed",left:`${r}px`,top:`${s}px`,transform:"translate(-50%, -100%)",marginTop:"-10px"};return n.jsx("div",{className:"tooltip-custom",style:a,onClick:i=>i.stopPropagation(),children:t})},Zd=h.lazy(()=>ue(()=>import("./MyDashboard.Cr_oC7gH.js"),__vite__mapDeps([10,1,2,5,3,4,11]))),eu=h.lazy(()=>ue(()=>import("./SavedArticles.BnR4vvAT.js"),__vite__mapDeps([12,1,2,13,14,3,4,5,15]))),tu=h.lazy(()=>ue(()=>import("./AccountSettings.DEmcy_69.js"),__vite__mapDeps([16,1,2,3,13,14,4,5,17]))),nu=h.lazy(()=>ue(()=>import("./SearchResults.Bho8CNJp.js"),__vite__mapDeps([18,1,2,13,14,3,4,5]))),ru=h.lazy(()=>ue(()=>import("./EmergencyResources.UKRQJEEU.js"),__vite__mapDeps([19,1,2,4,13,14,3,5,20]))),su=h.lazy(()=>ue(()=>import("./MobileProfileMenu.DAy1NQ2B.js"),__vite__mapDeps([21,1,2,13,14,3,4,5]))),au=h.lazy(()=>ue(()=>import("./Legal.CVMLLcMn.js"),__vite__mapDeps([22,1,2,13,14,3,4,5,23]))),iu=h.lazy(()=>ue(()=>import("./CompareCoverageModal.D3In9xLI.js"),__vite__mapDeps([24,1,2,5,4,3]))),ou=h.lazy(()=>ue(()=>import("./DetailedAnalysisModal.CAKwfeer.js"),__vite__mapDeps([25,1,2,3,4,5]))),cu=h.lazy(()=>ue(()=>import("./FilterModal.CK9HA4yN.js"),__vite__mapDeps([26,1,2,3,4,5,27]))),lu=h.lazy(()=>ue(()=>Promise.resolve().then(()=>_u),void 0)),jt=({children:e})=>{const{user:t}=Te();return t?e:n.jsx(vn,{to:"/login",replace:!0})};function du({profile:e}){const t=Ut(),{isInstallable:r,triggerInstall:s}=ed(),{addToast:a}=Ne(),[i,o]=h.useState(!1),[c,d]=h.useState("dark"),[u,l]=h.useState("medium"),[p,m]=h.useState(!1),[y,S]=h.useState({category:"All Categories",lean:"All Leans",quality:"All Quality Levels",sort:"Latest First",region:"Global",articleType:"All Types"}),[w,k]=h.useState({open:!1,clusterId:null,articleTitle:"",articleId:null}),[N,j]=h.useState({open:!1,article:null}),[b,f]=h.useState(!1),[T,_]=h.useState(!1),[g,v]=h.useState({visible:!1,text:"",x:0,y:0}),{savedArticleIds:P,handleToggleSave:O}=Zl((e==null?void 0:e.savedArticles)||[]),F=h.useCallback(R=>{R==="trigger_palate_cleanser"&&f(!0)},[]),U=h.useCallback(R=>{_(R)},[]);Ft(void 0,"feed",F,U);const z=h.useRef(null);h.useEffect(()=>{const R=()=>{if(!z.current)return;const C=window.scrollY,E=document.documentElement.scrollHeight-window.innerHeight;if(E>0){const A=C/E*100;z.current.style.width=`${A}%`}};return window.addEventListener("scroll",R,{passive:!0}),()=>window.removeEventListener("scroll",R)},[]),h.useEffect(()=>{const R=setTimeout(()=>{i||!t||window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||(r?(a("Install The Gamut for a better experience","info",{label:"Install App",onClick:()=>{s(),o(!0)}}),o(!0)):/iPhone|iPad|iPod/.test(navigator.userAgent)&&(a("To install: Tap Share button below  Add to Home Screen","info"),o(!0)))},3e3);return()=>clearTimeout(R)},[r,t,i,a,s]),h.useEffect(()=>{const R=localStorage.getItem("theme");if(R)d(R);else{const E=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;d(E?"dark":"light")}const C=localStorage.getItem("fontSize");C&&l(C)},[]),h.useEffect(()=>{document.body.className=`${c}-mode font-${u}`,localStorage.setItem("theme",c),localStorage.setItem("fontSize",u)},[c,u]);const Y=()=>{d(R=>R==="dark"?"light":"dark")},M=R=>{S(R)},L=(R,C)=>{if(!t||!R)return;C.stopPropagation();const E=C.clientX||C.touches&&C.touches[0].clientX,A=C.clientY||C.touches&&C.touches[0].clientY;g.visible&&g.text===R?v({visible:!1,text:"",x:0,y:0}):v({visible:!0,text:R,x:E,y:A})},$=h.useCallback(R=>{j({open:!0,article:R}),yl(R._id).catch(C=>console.error("Log View Error:",C))},[]),W=h.useCallback(R=>{k({open:!0,clusterId:R.clusterId||null,articleTitle:R.headline,articleId:R._id}),xl(R._id).catch(C=>console.error("Log Compare Error:",C))},[]);return n.jsxs("div",{className:`app ${T?"zen-mode":""}`,children:[n.jsx("div",{ref:z,className:"scroll-progress-bar"}),n.jsx(nd,{theme:c,toggleTheme:Y,username:(e==null?void 0:e.username)||"Guest",currentFilters:y}),T&&n.jsxs("div",{className:"zen-indicator",children:[n.jsx("span",{className:"zen-dot"}),n.jsx("span",{className:"zen-text",children:"Flow State Active"})]}),n.jsx(Xd,{visible:g.visible,text:g.text,x:g.x,y:g.y}),n.jsx("div",{className:"main-container",style:{paddingTop:"calc(20px + var(--sat))",paddingBottom:"calc(60px + var(--sab))"},children:n.jsx(h.Suspense,{fallback:n.jsx($e,{}),children:n.jsxs(ts,{children:[n.jsx(le,{path:"/",element:n.jsx(Yd,{filters:y,onFilterChange:M,onAnalyze:$,onCompare:W,savedArticleIds:P,onToggleSave:O,showTooltip:L})}),n.jsx(le,{path:"/search",element:n.jsx(nu,{onAnalyze:$,onCompare:W,savedArticleIds:P,onToggleSave:O,showTooltip:L})}),n.jsx(le,{path:"/emergency-resources",element:n.jsx(ru,{})}),n.jsx(le,{path:"/legal",element:n.jsx(au,{})}),n.jsx(le,{path:"/my-dashboard",element:n.jsx(jt,{children:n.jsx(Zd,{})})}),n.jsx(le,{path:"/saved-articles",element:n.jsx(jt,{children:n.jsx(eu,{onToggleSave:O,onCompare:W,onAnalyze:$,onShare:()=>{},onRead:()=>{},showTooltip:L})})}),n.jsx(le,{path:"/account-settings",element:n.jsx(jt,{children:n.jsx(tu,{currentFontSize:u,onSetFontSize:l})})}),n.jsx(le,{path:"/profile-menu",element:n.jsx(jt,{children:n.jsx(su,{})})}),n.jsx(le,{path:"*",element:n.jsx(uu,{})})]})})}),n.jsxs(h.Suspense,{fallback:null,children:[w.open&&n.jsx(iu,{open:w.open,articleId:w.articleId,clusterId:w.clusterId,articleTitle:w.articleTitle,onClose:()=>k({...w,open:!1}),onAnalyze:$,showTooltip:L}),N.open&&n.jsx(ou,{article:N.article,onClose:()=>j({...N,open:!1}),showTooltip:L}),p&&n.jsx(cu,{filters:y,onFilterChange:M,onClose:()=>m(!1)}),b&&n.jsx(lu,{open:b,onClose:()=>f(!1)})]}),n.jsx(Qd,{currentFilters:y,onOpenFilters:()=>m(!0)}),n.jsx(Jd,{})]})}function uu(){return n.jsx("main",{className:"content",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"calc(100vh - 60px)"},children:n.jsxs("div",{style:{textAlign:"center",color:"var(--text-tertiary)"},children:[n.jsx("h2",{children:"404 - Page Not Found"}),n.jsx(Le,{to:"/",className:"btn-secondary",style:{textDecoration:"none",marginTop:"20px"},children:"Back to Articles"})]})})}const Pe={Dashboard:()=>n.jsx("svg",{style:{width:"20px",height:"20px"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),News:()=>n.jsx("svg",{style:{width:"20px",height:"20px"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})}),Narratives:()=>n.jsx("svg",{style:{width:"20px",height:"20px"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),Brain:()=>n.jsx("svg",{style:{width:"20px",height:"20px"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),Users:()=>n.jsx("svg",{style:{width:"20px",height:"20px"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),Config:()=>n.jsxs("svg",{style:{width:"20px",height:"20px"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Exit:()=>n.jsx("svg",{style:{width:"16px",height:"16px"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),Menu:()=>n.jsx("svg",{style:{width:"24px",height:"24px"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})},hu=()=>{const{user:e,profile:t}=Te(),r=rt(),[s,a]=h.useState(!1);return!e||(t==null?void 0:t.role)!=="admin"?n.jsx("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:n.jsxs("div",{style:{background:"white",padding:"32px",borderRadius:"12px",border:"1px solid #e2e8f0",textAlign:"center"},children:[n.jsx("h1",{style:{fontSize:"1.5rem",marginBottom:"16px"},children:"Access Denied"}),n.jsx("button",{onClick:()=>r("/"),className:"btn btn-primary",children:"Return Home"})]})}):n.jsxs("div",{className:"admin-container",children:[s&&n.jsx("div",{className:"modal-overlay",onClick:()=>a(!1)}),n.jsxs("aside",{className:`admin-sidebar ${s?"open":""}`,children:[n.jsx("div",{className:"admin-sidebar-header",children:n.jsx("span",{style:{fontWeight:"bold",fontSize:"1.2rem",letterSpacing:"1px"},children:"NARRATIVE"})}),n.jsxs("nav",{className:"admin-nav",children:[n.jsxs(Ae,{to:"/admin",end:!0,onClick:()=>a(!1),className:({isActive:i})=>`admin-nav-item ${i?"active":""}`,children:[n.jsx(Pe.Dashboard,{})," ",n.jsx("span",{children:"Overview"})]}),n.jsx("div",{className:"admin-nav-section",children:"Content"}),n.jsxs(Ae,{to:"/admin/newsroom",onClick:()=>a(!1),className:({isActive:i})=>`admin-nav-item ${i?"active":""}`,children:[n.jsx(Pe.News,{})," ",n.jsx("span",{children:"Newsroom"})]}),n.jsxs(Ae,{to:"/admin/narratives",onClick:()=>a(!1),className:({isActive:i})=>`admin-nav-item ${i?"active":""}`,children:[n.jsx(Pe.Narratives,{})," ",n.jsx("span",{children:"Narratives"})]}),n.jsxs(Ae,{to:"/admin/prompts",onClick:()=>a(!1),className:({isActive:i})=>`admin-nav-item ${i?"active":""}`,children:[n.jsx(Pe.Brain,{})," ",n.jsx("span",{children:"AI Brain"})]}),n.jsx("div",{className:"admin-nav-section",children:"System"}),n.jsxs(Ae,{to:"/admin/users",onClick:()=>a(!1),className:({isActive:i})=>`admin-nav-item ${i?"active":""}`,children:[n.jsx(Pe.Users,{})," ",n.jsx("span",{children:"Users"})]}),n.jsxs(Ae,{to:"/admin/config",onClick:()=>a(!1),className:({isActive:i})=>`admin-nav-item ${i?"active":""}`,children:[n.jsx(Pe.Config,{})," ",n.jsx("span",{children:"Settings"})]})]}),n.jsx("div",{style:{padding:"20px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:n.jsxs("button",{onClick:()=>r("/"),className:"admin-nav-item",style:{width:"100%",justifyContent:"center"},children:[n.jsx(Pe.Exit,{})," Exit"]})})]}),n.jsxs("main",{className:"admin-main",children:[n.jsxs("header",{className:"mobile-header",children:[n.jsx("button",{onClick:()=>a(!0),children:n.jsx(Pe.Menu,{})}),n.jsx("span",{style:{fontWeight:"bold"},children:"Admin"}),n.jsx("div",{style:{width:24}})]}),n.jsx(va,{})]})]})},ie="http://localhost:5000/api",oe=async()=>{var r;return{headers:{Authorization:`Bearer ${await((r=os().currentUser)==null?void 0:r.getIdToken())}`,"Content-Type":"application/json"}}},de={getDashboardStats:async()=>{const e=await oe();return ae.get(`${ie}/admin/dashboard`,e)},getActivityLogs:async(e=1,t=50)=>{const r=await oe();return ae.get(`${ie}/admin/logs?page=${e}&limit=${t}`,r)},getAllArticles:async(e=1,t=20)=>{const r=await oe();return ae.get(`${ie}/admin/articles?page=${e}&limit=${t}`,r)},getArchivedArticles:async(e=1,t=20)=>{const r=await oe();return ae.get(`${ie}/admin/trash/articles?page=${e}&limit=${t}`,r)},createArticle:async e=>{const t=await oe();return ae.post(`${ie}/admin/articles`,e,t)},updateArticle:async(e,t)=>{const r=await oe();return ae.patch(`${ie}/admin/articles/${e}`,t,r)},archiveArticle:async e=>{const t=await oe();return ae.delete(`${ie}/admin/articles/${e}`,t)},restoreArticle:async e=>{const t=await oe();return ae.post(`${ie}/admin/articles/${e}/restore`,{},t)},toggleVisibility:async e=>{const t=await oe();return ae.post(`${ie}/admin/articles/${e}/toggle-visibility`,{},t)},getAllNarratives:async(e=1)=>{const t=await oe();return ae.get(`${ie}/admin/narratives?page=${e}`,t)},getNarrativeById:async e=>{const t=await oe();return ae.get(`${ie}/admin/narratives/${e}`,t)},updateNarrative:async(e,t)=>{const r=await oe();return ae.patch(`${ie}/admin/narratives/${e}`,t,r)},getAllUsers:async(e=1,t="")=>{const r=await oe();return ae.get(`${ie}/admin/users?page=${e}&search=${t}`,r)},updateUserStatus:async(e,t)=>{const r=await oe();return ae.patch(`${ie}/admin/users/${e}`,t,r)},getSystemConfigs:async()=>{const e=await oe();return ae.get(`${ie}/admin/config`,e)},updateSystemConfig:async(e,t)=>{const r=await oe();return ae.post(`${ie}/admin/config`,{key:e,value:t},r)},getSystemPrompts:async()=>{const e=await oe();return ae.get(`${ie}/admin/prompts`,e)},createSystemPrompt:async e=>{const t=await oe();return ae.post(`${ie}/admin/prompts`,e,t)},updateSystemPrompt:async(e,t)=>{const r=await oe();return ae.patch(`${ie}/admin/prompts/${e}`,t,r)}},it=({title:e,description:t,subtitle:r,actionLabel:s,onAction:a,actions:i})=>n.jsxs("div",{className:"admin-page-header",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"admin-title",children:e}),(t||r)&&n.jsx("p",{className:"admin-subtitle",children:t||r})]}),n.jsxs("div",{children:[i,!i&&s&&a&&n.jsx("button",{onClick:a,className:"btn btn-primary btn-sm",children:s})]})]}),pe=({children:e,className:t="",title:r,icon:s})=>n.jsxs("div",{className:`admin-card ${t}`,children:[(r||s)&&n.jsxs("div",{className:"admin-card-header",children:[s&&n.jsx("span",{style:{marginRight:"10px",fontSize:"1.2rem",lineHeight:1},children:s}),r]}),n.jsx("div",{className:"admin-card-body",children:e})]});Ba.register(Fa,Ua,Ha,za,Wa,Va,Ga,qa,Ka);const pu=()=>{const[e,t]=h.useState(null),[r,s]=h.useState([]),[a,i]=h.useState({left:0,center:0,right:0}),[o,c]=h.useState([]),[d,u]=h.useState([]),[l,p]=h.useState([]),[m,y]=h.useState([]),[S,w]=h.useState(!0);h.useEffect(()=>{de.getDashboardStats().then(g=>{const v=g.data.data;v.stats&&t(v.stats),v.graphData&&s(v.graphData),v.leanData&&i(v.leanData),v.topSearches&&c(v.topSearches),v.contentGaps&&u(v.contentGaps),v.hourlyActivity&&y(v.hourlyActivity),v.mostIgnored&&p(v.mostIgnored)}).catch(console.error).finally(()=>w(!1))},[]);const k=g=>{if(!g)return"0s";const v=Math.floor(g/60),P=g%60;return v===0?`${P}s`:`${v}m ${P}s`};if(S)return n.jsx($e,{});const N={labels:r.map(g=>g._id),datasets:[{label:"Reading Time (sec)",data:r.map(g=>g.reading),borderColor:"#0891b2",backgroundColor:"rgba(8, 145, 178, 0.1)",tension:.4,fill:!0},{label:"Listening Time (sec)",data:r.map(g=>g.listening),borderColor:"#db2777",backgroundColor:"rgba(219, 39, 119, 0.1)",tension:.4,fill:!0}]},j={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{x:{grid:{display:!1}},y:{beginAtZero:!0}}},b={labels:["Left","Center","Right"],datasets:[{data:[a.left,a.center,a.right],backgroundColor:["#3b82f6","#a855f7","#ef4444"],borderWidth:1}]},T={labels:Array.from({length:24},(g,v)=>{const P=v%12||12,O=v<12?"AM":"PM";return`${P}${O}`}),datasets:[{label:"Active Minutes",data:m.map(g=>Math.round(g/60)),backgroundColor:"#6366f1",borderRadius:4}]},_={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:g=>`${g.raw} mins`}}},scales:{x:{grid:{display:!1},ticks:{maxTicksLimit:12,font:{size:10}}},y:{display:!1}}};return n.jsxs("div",{className:"admin-page fade-in",children:[n.jsx(it,{title:"Mission Control",subtitle:"Real-time system overview and intelligence.",actionLabel:"Refresh Data",onAction:()=>window.location.reload()}),n.jsxs("div",{className:"admin-grid-3",style:{marginBottom:"32px"},children:[n.jsxs(pe,{title:"System Status",icon:"",children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[n.jsx("span",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:(e==null?void 0:e.systemStatus)||"Online"}),n.jsx("span",{style:{width:10,height:10,borderRadius:"50%",background:"#10b981"}})]}),n.jsxs("p",{style:{color:"#64748b",fontSize:"0.8rem"},children:["DB: ",e==null?void 0:e.databaseStatus]})]}),n.jsxs(pe,{title:"Total Users",icon:"",children:[n.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold"},children:(e==null?void 0:e.totalUsers)||0}),n.jsx("p",{style:{color:"#64748b",fontSize:"0.8rem"},children:"Registered Accounts"})]}),n.jsxs(pe,{title:"Content Library",icon:"",children:[n.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold"},children:(e==null?void 0:e.activeArticles)||0}),n.jsxs("p",{style:{color:"#64748b",fontSize:"0.8rem"},children:["Archived: ",e==null?void 0:e.archivedArticles]})]})]}),n.jsxs("div",{className:"admin-grid-3",style:{marginBottom:"32px"},children:[n.jsxs(pe,{title:"Real Attention",icon:"",children:[n.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold",color:"#7c3aed"},children:k((e==null?void 0:e.avgSessionTime)||0)}),n.jsx("p",{style:{color:"#64748b",fontSize:"0.8rem"},children:"Avg. Session Duration"})]}),n.jsxs(pe,{title:"Content Depth",icon:"",children:[n.jsxs("p",{style:{fontSize:"2rem",fontWeight:"bold",color:"#0891b2"},children:[(e==null?void 0:e.avgScrollDepth)||0,"%"]}),n.jsx("p",{style:{color:"#64748b",fontSize:"0.8rem"},children:"Avg. Scroll per Article"})]}),n.jsxs(pe,{title:"Audio Stickiness",icon:"",children:[n.jsxs("p",{style:{fontSize:"2rem",fontWeight:"bold",color:"#db2777"},children:[(e==null?void 0:e.audioRetention)||0,"%"]}),n.jsx("p",{style:{color:"#64748b",fontSize:"0.8rem"},children:"Radio Completion Rate"})]})]}),n.jsxs("div",{className:"admin-grid-split",style:{marginBottom:"32px"},children:[n.jsx(pe,{title:"Engagement Split (7 Days)",children:n.jsx("div",{style:{height:"300px"},children:n.jsx(Ya,{options:j,data:N})})}),n.jsxs(pe,{title:"Political Balance",children:[n.jsx("div",{style:{height:"260px",display:"flex",justifyContent:"center",marginBottom:"10px"},children:n.jsx(Ja,{data:b})}),n.jsx("p",{style:{textAlign:"center",fontSize:"0.8rem",color:"#64748b"},children:"Total Minutes Consumed per Bias"})]})]}),n.jsx("div",{style:{marginBottom:"32px"},children:n.jsx(pe,{title:"Daily Habit Heatmap (Active Hours UTC)",icon:"",children:n.jsx("div",{style:{height:"200px",width:"100%"},children:m.length>0?n.jsx(Qa,{options:_,data:T}):n.jsx("div",{className:"empty-state",children:"No habit data collected yet."})})})}),n.jsxs("div",{className:"admin-grid-3",children:[n.jsx(pe,{title:" Trending Searches",icon:"",children:n.jsx("div",{className:"search-list-container",children:o.length>0?o.map((g,v)=>n.jsxs("div",{className:"search-item",children:[n.jsxs("div",{className:"search-rank",children:["#",v+1]}),n.jsx("div",{className:"search-term",children:g.query||g._id}),n.jsx("div",{className:"search-count",children:g.count})]},v)):n.jsx("p",{className:"empty-text",children:"No trends yet."})})}),n.jsx(pe,{title:" Content Gaps (Zero Results)",icon:"",children:n.jsx("div",{className:"search-list-container",children:d.length>0?d.map((g,v)=>n.jsxs("div",{className:"search-item gap-item",children:[n.jsx("div",{className:"search-term",children:g.query||g._id}),n.jsx("div",{className:"search-count",children:g.count})]},v)):n.jsx("p",{className:"empty-text",children:"No content gaps found."})})}),n.jsxs(pe,{title:" Top Ignored Topics",icon:"",children:[n.jsx("div",{className:"search-list-container",children:l.length>0?l.map((g,v)=>n.jsxs("div",{className:"search-item",children:[n.jsxs("div",{className:"search-rank",children:["#",v+1]}),n.jsx("div",{className:"search-term",children:g._id}),n.jsxs("div",{className:"search-count",title:"Users Ignoring",children:[g.userCount," users"]})]},v)):n.jsx("p",{className:"empty-text",children:"No ignored topics detected yet."})}),n.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Users see these often but rarely click."})]})]})]})},Xn=({children:e,data:t,columns:r,currentPage:s,totalPages:a,onPageChange:i,isLoading:o})=>t&&r?n.jsxs("div",{className:"admin-card",style:{padding:0,overflow:"hidden",display:"flex",flexDirection:"column"},children:[n.jsx("div",{className:"admin-table-container",style:{overflowX:"auto"},children:n.jsxs("table",{className:"admin-table",style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:r.map((c,d)=>n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"0.85rem",fontWeight:600,color:"#64748b"},children:c.header},d))})}),n.jsx("tbody",{children:o?n.jsx("tr",{children:n.jsx("td",{colSpan:r.length,style:{padding:"32px",textAlign:"center",color:"#64748b"},children:"Loading data..."})}):t.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:r.length,style:{padding:"32px",textAlign:"center",color:"#64748b"},children:"No records found."})}):t.map((c,d)=>n.jsx("tr",{style:{borderBottom:"1px solid #f1f5f9"},className:"hover:bg-slate-50 transition-colors",children:r.map((u,l)=>{const p=typeof u.accessor=="function"?u.accessor(c):c[u.accessor];return n.jsx("td",{style:{padding:"12px 16px",fontSize:"0.9rem",color:"#334155"},children:p},l)})},c._id||d))})]})}),a&&a>1&&i&&s&&n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderTop:"1px solid #e2e8f0",background:"#fff"},children:[n.jsx("button",{className:"btn btn-outline btn-sm",disabled:s===1,onClick:()=>i(s-1),children:"Previous"}),n.jsxs("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:["Page ",s," of ",a]}),n.jsx("button",{className:"btn btn-outline btn-sm",disabled:s===a,onClick:()=>i(s+1),children:"Next"})]})]}):n.jsx("div",{className:"admin-card",style:{padding:0,overflow:"hidden"},children:n.jsx("div",{className:"admin-table-container",children:n.jsx("table",{className:"admin-table",children:e})})}),mu=({children:e})=>n.jsx("thead",{children:e}),fu=({children:e})=>n.jsx("tbody",{children:e}),St=({children:e})=>n.jsx("th",{children:e}),Tt=({children:e,className:t})=>n.jsx("td",{className:t,children:e}),gu=({children:e,onClick:t})=>n.jsx("tr",{onClick:t,style:{cursor:t?"pointer":"default"},children:e}),Zn=({children:e,variant:t="neutral"})=>{const r={padding:"4px 10px",borderRadius:"50px",fontSize:"12px",fontWeight:"600",display:"inline-block"},s={success:{bg:"#dcfce7",color:"#15803d"},warning:{bg:"#fef3c7",color:"#b45309"},danger:{bg:"#ffe4e6",color:"#e11d48"},neutral:{bg:"#f1f5f9",color:"#475569"},info:{bg:"#dbeafe",color:"#1e40af"},purple:{bg:"#f3e8ff",color:"#7e22ce"}},a=s[t]||s.neutral;return n.jsx("span",{style:{...r,backgroundColor:a.bg,color:a.color},children:e})},vu=()=>{const[e,t]=h.useState(!0),[r,s]=h.useState([]),[a,i]=h.useState(1),[o,c]=h.useState(1),[d,u]=h.useState(!1),[l,p]=h.useState(null),[m,y]=h.useState(!1),S=async()=>{t(!0);try{const T=await(m?de.getArchivedArticles(a):de.getAllArticles(a));s(T.data.data.articles),c(T.data.pages)}catch(f){console.error(f)}finally{t(!1)}};h.useEffect(()=>{S()},[a,m]);const w=f=>{p({...f}),u(!0)},k=async()=>{if(!(!l||!l._id))try{await de.updateArticle(l._id,l),u(!1),S(),alert("Article updated successfully")}catch{alert("Failed to update article")}},N=async f=>{if(window.confirm("Are you sure you want to move this to trash?"))try{await de.archiveArticle(f),S()}catch{alert("Error archiving article")}},j=async f=>{try{await de.restoreArticle(f),S()}catch{alert("Error restoring article")}},b=[{header:"Thumb",accessor:f=>f.imageUrl?n.jsx("img",{src:f.imageUrl,alt:"",style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"}}):n.jsx("span",{style:{fontSize:"0.8rem",color:"#999"},children:"No Img"})},{header:"Headline",accessor:"headline"},{header:"Source",accessor:"source"},{header:"Category",accessor:"category"},{header:"Published",accessor:f=>new Date(f.publishedAt).toLocaleDateString()},{header:"Status",accessor:f=>n.jsx(Zn,{variant:f.isLatest?"success":"neutral",children:f.isLatest?"Live":"Hidden"})},{header:"Actions",accessor:f=>n.jsx("div",{className:"flex-end",children:m?n.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>j(f._id),children:"Restore"}):n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn btn-outline btn-sm",onClick:()=>w(f),children:"Edit"}),n.jsx("button",{className:"btn btn-outline btn-sm text-red",onClick:()=>N(f._id),children:"Trash"})]})})}];return e&&!r.length?n.jsx($e,{}):n.jsxs("div",{children:[n.jsx(it,{title:m?"Trash Bin":"Newsroom",description:m?"Recover deleted articles.":"Manage and edit live articles.",actions:n.jsx("button",{onClick:()=>{y(!m),i(1)},className:"btn btn-outline",children:m?"View Live Articles":"View Trash"})}),n.jsx(Xn,{data:r,columns:b,currentPage:a,totalPages:o,onPageChange:i}),d&&l&&n.jsx("div",{className:"admin-modal-overlay",children:n.jsxs("div",{className:"admin-modal",children:[n.jsx("h2",{children:"Edit Article"}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Headline"}),n.jsx("input",{value:l.headline,onChange:f=>p({...l,headline:f.target.value}),className:"form-input"})]}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Summary"}),n.jsx("textarea",{value:l.summary,onChange:f=>p({...l,summary:f.target.value}),className:"form-textarea"})]}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Image URL"}),n.jsx("input",{value:l.imageUrl||"",onChange:f=>p({...l,imageUrl:f.target.value}),className:"form-input",placeholder:"https://..."}),l.imageUrl&&n.jsx("img",{src:l.imageUrl,alt:"Preview",style:{marginTop:"10px",maxHeight:"100px",borderRadius:"6px"}})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Category"}),n.jsx("input",{value:l.category,onChange:f=>p({...l,category:f.target.value}),className:"form-input"})]}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Source"}),n.jsx("input",{value:l.source,onChange:f=>p({...l,source:f.target.value}),className:"form-input"})]})]}),n.jsxs("div",{style:{marginTop:"24px",borderTop:"1px solid #eee",paddingTop:"16px"},children:[n.jsx("h3",{style:{fontSize:"1rem",marginBottom:"12px",color:"#334155"},children:"Advanced Analysis"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px"},children:[n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Bias Score (0-100)"}),n.jsx("input",{type:"number",value:l.biasScore||0,onChange:f=>p({...l,biasScore:Number(f.target.value)}),className:"form-input"})]}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Credibility Grade"}),n.jsx("input",{value:l.credibilityGrade||"",onChange:f=>p({...l,credibilityGrade:f.target.value}),className:"form-input"})]}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Sentiment"}),n.jsxs("select",{value:l.sentiment||"Neutral",onChange:f=>p({...l,sentiment:f.target.value}),className:"form-select",children:[n.jsx("option",{value:"Positive",children:"Positive"}),n.jsx("option",{value:"Neutral",children:"Neutral"}),n.jsx("option",{value:"Negative",children:"Negative"})]})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginTop:"12px"},children:[n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Trust Score"}),n.jsx("input",{type:"number",value:l.trustScore||0,onChange:f=>p({...l,trustScore:Number(f.target.value)}),className:"form-input"})]}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Political Lean"}),n.jsx("input",{value:l.politicalLean||"",onChange:f=>p({...l,politicalLean:f.target.value}),className:"form-input"})]})]})]}),n.jsxs("div",{className:"flex-end",style:{marginTop:"24px"},children:[n.jsx("button",{className:"btn btn-outline",onClick:()=>u(!1),children:"Cancel"}),n.jsx("button",{className:"btn btn-primary",onClick:k,children:"Save Changes"})]})]})})]})},yu=()=>{const[e,t]=h.useState(!0),[r,s]=h.useState([]),[a,i]=h.useState(""),[o]=h.useState(1),c=async()=>{try{const l=await de.getAllUsers(o,a);s(l.data.data.users)}catch{alert("Error loading users")}finally{t(!1)}};h.useEffect(()=>{const l=setTimeout(c,500);return()=>clearTimeout(l)},[o,a]);const d=async l=>{window.confirm(`Are you sure you want to ${l.isBanned?"unban":"ban"} this user?`)&&await de.updateUserStatus(l.userId,{isBanned:!l.isBanned}).then(c)},u=async l=>{const p=l.role==="admin"?"user":"admin";window.confirm(`Promote/Demote to ${p}?`)&&await de.updateUserStatus(l.userId,{role:p}).then(c)};return n.jsxs("div",{children:[n.jsx(it,{title:"User Management",description:"Manage accounts and permissions."}),n.jsx(pe,{className:"mb-4",children:n.jsx("input",{type:"text",placeholder:"Search users by email or name...",className:"form-input",value:a,onChange:l=>i(l.target.value)})}),e&&!r.length?n.jsx($e,{}):n.jsxs(Xn,{children:[n.jsx(mu,{children:n.jsxs("tr",{children:[n.jsx(St,{children:"User Details"}),n.jsx(St,{children:"Role"}),n.jsx(St,{children:"Stats (Views)"}),n.jsx(St,{className:"text-right",children:"Actions"})]})}),n.jsx(fu,{children:r.map(l=>n.jsxs(gu,{children:[n.jsxs(Tt,{children:[n.jsx("div",{style:{fontWeight:"600"},children:l.username}),n.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:l.email}),l.isBanned&&n.jsx("span",{style:{color:"red",fontSize:"0.7rem",fontWeight:"bold",textTransform:"uppercase"},children:"BANNED"})]}),n.jsx(Tt,{children:n.jsx(Zn,{variant:l.role==="admin"?"purple":"neutral",children:l.role==="admin"?"Admin":"User"})}),n.jsx(Tt,{children:l.articlesViewedCount||0}),n.jsx(Tt,{className:"text-right",children:n.jsxs("div",{className:"flex-end",children:[n.jsx("button",{onClick:()=>u(l),className:"btn btn-outline btn-sm",children:l.role==="admin"?"Demote":"Promote"}),n.jsx("button",{onClick:()=>d(l),className:`btn btn-sm ${l.isBanned?"btn-success":"btn-danger"}`,children:l.isBanned?"Unban":"Ban"})]})})]},l.userId))})]})]})},xu=[{key:"ai_personality",value:{length_instruction:"Minimum 50 words and Maximum 60 words",tone:"Objective, authoritative, and direct (News Wire Style)",forbidden_words:"delves, underscores, crucial, tapestry, landscape, moreover, notably, the article, the report"},description:"Controls the specific instructions injected into every AI prompt."},{key:"scoring_weights",value:{image_bonus:2,missing_image_penalty:-2,missing_image_untrusted_penalty:-10,trusted_source_bonus:5,junk_keyword_penalty:-20,min_score_cutoff:0},description:"Adjusts how the feed algorithm ranks incoming news."},{key:"tts_rules",value:[{pattern:"\\$([0-9\\.,]+)\\s?([mM]illion|[bB]illion|[tT]rillion)",flags:"gi",replacement:"$1 $2 dollars"},{pattern:"[-]",flags:"g",replacement:" "},{pattern:":",flags:"g",replacement:". . "}],description:"Regex rules to fix pronunciation errors before TTS generation."}],bu=()=>{const[e,t]=h.useState(!0),[r,s]=h.useState([]),[a,i]=h.useState(null),[o,c]=h.useState(""),d=async()=>{try{const p=await de.getSystemConfigs();s(p.data.data.configs)}catch{alert("Error loading configs")}finally{t(!1)}};h.useEffect(()=>{d()},[]);const u=async p=>{let m=o;if(o.trim().startsWith("{")||o.trim().startsWith("["))try{m=JSON.parse(o)}catch{alert("Invalid JSON Syntax. Please check your commas and quotes.");return}await de.updateSystemConfig(p,m).then(()=>{i(null),d()})},l=async()=>{if(window.confirm("This will overwrite existing keys with defaults. Continue?")){t(!0);try{for(const p of xu)await de.updateSystemConfig(p.key,p.value);await d(),alert("Defaults seeded successfully!")}catch{alert("Error seeding defaults.")}finally{t(!1)}}};return e?n.jsx($e,{}):n.jsxs("div",{children:[n.jsx(it,{title:"System Configuration",description:"Global variables and logic control."}),n.jsxs("div",{className:"flex-between",style:{marginBottom:"24px",background:"#fffbeb",padding:"16px",borderRadius:"8px",border:"1px solid #fcd34d"},children:[n.jsxs("div",{style:{color:"#92400e"},children:[n.jsx("strong",{children:" Warning:"})," Changes here affect the live algorithm immediately."]}),n.jsx("button",{onClick:l,className:"btn btn-outline btn-sm",children:"Seed Defaults"})]}),n.jsx("div",{style:{display:"grid",gap:"16px"},children:r.map(p=>n.jsxs(pe,{children:[n.jsxs("div",{className:"flex-between",style:{marginBottom:"12px"},children:[n.jsxs("div",{children:[n.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"bold"},children:p.key}),n.jsx("p",{style:{fontSize:"0.85rem",color:"#64748b",marginTop:"2px"},children:p.description||"No description provided."})]}),a!==p.key&&n.jsx("button",{onClick:()=>{i(p.key);const m=typeof p.value=="object"?JSON.stringify(p.value,null,2):String(p.value);c(m)},className:"btn btn-outline btn-sm",children:"Edit"})]}),a===p.key?n.jsxs("div",{children:[n.jsx("textarea",{className:"form-textarea font-mono",rows:10,value:o,onChange:m=>c(m.target.value),style:{fontSize:"0.85rem",background:"#1e293b",color:"#f8fafc",border:"none"}}),n.jsxs("div",{className:"flex-end",style:{marginTop:"12px"},children:[n.jsx("button",{onClick:()=>i(null),className:"btn btn-outline btn-sm",children:"Cancel"}),n.jsx("button",{onClick:()=>u(p.key),className:"btn btn-primary btn-sm",children:"Save Changes"})]})]}):n.jsx("div",{className:"font-mono",style:{background:"#f8fafc",padding:"12px",borderRadius:"6px",wordBreak:"break-all",fontSize:"0.8rem"},children:n.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:typeof p.value=="object"?JSON.stringify(p.value,null,2):p.value})})]},p._id))})]})},wu=[{type:"ANALYSIS",description:"The main brain for processing incoming news articles. Handles summarization, bias detection, and categorization.",text:`Role: You are a Lead Editor for a global news wire.
Task: Analyze the following story and structure the data for our database.

Input Article:
Headline: "{{headline}}"
Description: "{{description}}"
Snippet: "{{content}}"
Date: {{date}}

--- INSTRUCTIONS ---

1. **Summarize (News Wire Style)**:
   - **DIRECT REPORTING:** Act as the primary source. Do NOT say "The article states" or "The report highlights." Just state the facts.
   - **TITLE ACCURACY:** Use the EXACT titles found in the source text.
   - Tone: {{ai_tone}}
   - **Length: {{ai_length}}**
   - Vocabulary: Do NOT use these words: {{ai_forbidden}}

2. **Categorize**:
   - Choose ONE: Politics, Business, Economy, Global Conflict, Tech, Science, Health, Justice, Sports, Entertainment, Lifestyle, Crypto & Finance, Gaming.

3. **CONDITIONAL BIAS & LEAN ANALYSIS (CRITICAL)**:
   - **IF Category is "Politics", "Economy", "Global Conflict", "Justice", "Policy", or "Social Issues":**
     - Political Lean: Left, Left-Leaning, Center, Right-Leaning, Right.
     - Bias Score (0-100): 0 = Neutral, 100 = Propaganda.
   - **IF Category is "Sports", "Entertainment", "Tech", "Science", "Lifestyle", "Gaming", or "Health":**
     - Political Lean: "Not Applicable".
     - Bias Score: 0.
     - Sentiment: "Neutral" (Unless it is clearly an opinion/review).

4. **Trust Score (0-100)**:
   - Based on source credibility and tone (applies to ALL categories).

5. **Smart Briefing**:
   - **Key Findings**: Extract exactly 5 distinct, bullet-point facts.
   - **Recommendations**: Provide 3 actionable tips (e.g., "Watch the match highlights", "Read the bill text").

6. **Extract Entities**:
   - Primary Noun: The main subject.
   - Secondary Noun: The context.

--- OUTPUT FORMAT ---
Respond ONLY in valid JSON. Do not add markdown blocks.

{
  "summary": "Direct, factual news brief.",
  "category": "CategoryString",
  "politicalLean": "Center",
  "analysisType": "Full",
  "sentiment": "Neutral",
  "clusterTopic": "Main Event Name",
  "country": "Global",
  "primaryNoun": "Subject",
  "secondaryNoun": "Context",
  "biasScore": 10, 
  "biasLabel": "Minimal Bias",
  "biasComponents": {
    "linguistic": {"sentimentPolarity": 0, "emotionalLanguage": 0, "loadedTerms": 0, "complexityBias": 0},
    "sourceSelection": {"sourceDiversity": 0, "expertBalance": 0, "attributionTransparency": 0},
    "demographic": {"genderBalance": 0, "racialBalance": 0, "ageRepresentation": 0},
    "framing": {"headlineFraming": 0, "storySelection": 0, "omissionBias": 0}
  },
  "credibilityScore": 90, "credibilityGrade": "A",
  "credibilityComponents": {"sourceCredibility": 0, "factVerification": 0, "professionalism": 0, "evidenceQuality": 0, "transparency": 0, "audienceTrust": 0},
  "reliabilityScore": 90, "reliabilityGrade": "A",
  "reliabilityComponents": {"consistency": 0, "temporalStability": 0, "qualityControl": 0, "publicationStandards": 0, "correctionsPolicy": 0, "updateMaintenance": 0},
  "trustLevel": "High",
  "keyFindings": ["Fact 1", "Fact 2", "Fact 3", "Fact 4", "Fact 5"],
  "recommendations": ["Tip 1", "Tip 2", "Tip 3"]
}`},{type:"SUMMARY_ONLY",description:"A cheaper, faster prompt for when the system falls back to Basic mode (handling huge volumes or errors).",text:`Role: You are a News Curator.
Task: Summarize this story concisely.

Input Article:
Headline: "{{headline}}"
Description: "{{description}}"
Snippet: "{{content}}"

--- INSTRUCTIONS ---
1. Summarize: Provide a factual summary with **{{ai_length}}**.
2. Categorize: Choose the most relevant category.
3. Sentiment: Determine if the story is Positive, Negative, or Neutral.

--- OUTPUT FORMAT ---
Respond ONLY in valid JSON:
{
  "summary": "String",
  "category": "String",
  "sentiment": "String",
  "politicalLean": "Not Applicable",
  "analysisType": "SentimentOnly"
}`}],ju=()=>{const[e,t]=h.useState(!0),[r,s]=h.useState([]),[a,i]=h.useState(null),[o,c]=h.useState(""),d=async()=>{try{const m=await de.getSystemPrompts();s(m.data.data.prompts)}catch{alert("Error loading prompts")}finally{t(!1)}};h.useEffect(()=>{d()},[]);const u=async m=>{await de.updateSystemPrompt(m,{text:o}).then(()=>{i(null),d(),alert("Prompt updated.")})},l=async m=>{await de.updateSystemPrompt(m._id,{active:!m.active}).then(d)},p=async()=>{if(window.confirm("This will attempt to create default prompts if they don't exist. Continue?")){t(!0);try{let m=0;for(const y of wu)r.find(S=>S.type===y.type)||(await de.createSystemPrompt(y),m++);await d(),alert(`Process complete. Added ${m} new prompts.`)}catch(m){alert("Error seeding prompts. Check console."),console.error(m)}finally{t(!1)}}};return e&&!r.length?n.jsx($e,{}):n.jsxs("div",{children:[n.jsx(it,{title:"AI Brain",description:"Manage system prompts.",actions:n.jsx("button",{onClick:p,className:"btn btn-outline btn-sm",children:"Seed Defaults"})}),r.length===0?n.jsxs("div",{className:"admin-empty-state",children:[n.jsx("h3",{children:"No Prompts Found"}),n.jsx("p",{children:'Your database currently has no prompt templates. Click "Seed Defaults" above to initialize them.'})]}):n.jsx("div",{style:{display:"grid",gap:"24px"},children:r.map(m=>n.jsxs(pe,{className:m.active?"":"opacity-75",children:[n.jsxs("div",{className:"flex-between",style:{marginBottom:"16px"},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[n.jsx("h2",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:m.type}),n.jsx(Zn,{variant:m.active?"success":"neutral",children:m.active?"Active":"Inactive"})]}),n.jsx("p",{style:{fontSize:"0.9rem",color:"#64748b",marginTop:"4px"},children:m.description})]}),n.jsxs("div",{className:"flex-end",children:[n.jsx("button",{onClick:()=>l(m),className:"btn btn-outline btn-sm",children:m.active?"Deactivate":"Activate"}),a!==m._id&&n.jsx("button",{onClick:()=>{i(m._id),c(m.text)},className:"btn btn-primary btn-sm",children:"Edit"})]})]}),a===m._id?n.jsxs("div",{children:[n.jsx("textarea",{className:"form-textarea font-mono",style:{minHeight:"300px",fontSize:"13px"},value:o,onChange:y=>c(y.target.value)}),n.jsxs("div",{className:"flex-end",style:{marginTop:"16px"},children:[n.jsx("button",{onClick:()=>i(null),className:"btn btn-outline",children:"Cancel"}),n.jsx("button",{onClick:()=>u(m._id),className:"btn btn-primary",children:"Save New Version"})]})]}):n.jsx("div",{className:"font-mono",style:{background:"#f8fafc",padding:"16px",borderRadius:"8px",maxHeight:"200px",overflowY:"auto",whiteSpace:"pre-wrap",fontSize:"12px"},children:m.text})]},m._id))})]})},Su=()=>{var b;const[e,t]=h.useState(!0),[r,s]=h.useState([]),[a,i]=h.useState(1),[o,c]=h.useState(1),[d,u]=h.useState(!1),[l,p]=h.useState(null),m=async()=>{t(!0);try{const f=await de.getAllNarratives(a);s(f.data.data.narratives),c(f.data.pages)}catch(f){console.error(f)}finally{t(!1)}};h.useEffect(()=>{m()},[a]);const y=f=>{p(JSON.parse(JSON.stringify(f))),u(!0)},S=async()=>{if(!(!l||!l._id))try{await de.updateNarrative(l._id,l),alert("Narrative updated"),u(!1),m()}catch{alert("Failed to update narrative")}},w=(f,T)=>{if(!l)return;const _=[...l.consensusPoints||[]];_[f]=T,p({...l,consensusPoints:_})},k=()=>{l&&p({...l,consensusPoints:[...l.consensusPoints||[],"New Point"]})},N=f=>{if(!l)return;const T=[...l.consensusPoints||[]];T.splice(f,1),p({...l,consensusPoints:T})},j=[{header:"Cluster ID",accessor:"clusterId"},{header:"Master Headline",accessor:"masterHeadline"},{header:"Sources",accessor:"sourceCount"},{header:"Updated",accessor:f=>new Date(f.lastUpdated).toLocaleDateString()},{header:"Actions",accessor:f=>n.jsx("button",{className:"btn btn-outline btn-sm",onClick:()=>y(f),children:"Edit"})}];return e&&!r.length?n.jsx($e,{}):n.jsxs("div",{children:[n.jsx(it,{title:"Narrative Clusters",description:"Manage the meta-stories generated by AI."}),n.jsx(Xn,{data:r,columns:j,currentPage:a,totalPages:o,onPageChange:i}),d&&l&&n.jsx("div",{className:"admin-modal-overlay",children:n.jsxs("div",{className:"admin-modal",style:{maxWidth:"800px"},children:[n.jsx("h2",{children:"Edit Narrative"}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Master Headline"}),n.jsx("input",{value:l.masterHeadline,onChange:f=>p({...l,masterHeadline:f.target.value}),className:"form-input"})]}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Executive Summary"}),n.jsx("textarea",{value:l.executiveSummary,onChange:f=>p({...l,executiveSummary:f.target.value}),className:"form-textarea",style:{height:"100px"}})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Category"}),n.jsx("input",{value:l.category,onChange:f=>p({...l,category:f.target.value}),className:"form-input"})]}),n.jsxs("div",{className:"admin-form-group",children:[n.jsx("label",{children:"Country"}),n.jsx("input",{value:l.country,onChange:f=>p({...l,country:f.target.value}),className:"form-input"})]})]}),n.jsxs("div",{style:{marginTop:"20px"},children:[n.jsxs("div",{className:"flex-between",children:[n.jsx("label",{style:{fontWeight:"bold"},children:"Consensus Points"}),n.jsx("button",{onClick:k,className:"btn btn-sm btn-outline",children:"+ Add"})]}),(b=l.consensusPoints)==null?void 0:b.map((f,T)=>n.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"8px"},children:[n.jsx("input",{value:f,onChange:_=>w(T,_.target.value),className:"form-input"}),n.jsx("button",{onClick:()=>N(T),className:"text-red",style:{border:"none",background:"none",cursor:"pointer"},children:"X"})]},T))]}),n.jsxs("div",{style:{marginTop:"20px"},children:[n.jsx("label",{style:{fontWeight:"bold"},children:"Divergence Points (JSON)"}),n.jsx("p",{style:{fontSize:"0.8rem",color:"#666"},children:"Advanced: Edit the JSON structure for disagreements."}),n.jsx("textarea",{className:"form-textarea font-mono",value:JSON.stringify(l.divergencePoints,null,2),onChange:f=>{try{const T=JSON.parse(f.target.value);p({...l,divergencePoints:T})}catch{}},style:{height:"200px",fontSize:"12px"}})]}),n.jsxs("div",{className:"flex-end",style:{marginTop:"24px"},children:[n.jsx("button",{className:"btn btn-outline",onClick:()=>u(!1),children:"Cancel"}),n.jsx("button",{className:"btn btn-primary",onClick:S,children:"Save Changes"})]})]})})]})};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Tu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nu=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),zt=(e,t)=>{const r=h.forwardRef(({color:s="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,...u},l)=>h.createElement("svg",{ref:l,...Tu,width:a,height:a,stroke:s,strokeWidth:o?Number(i)*24/Number(a):i,className:["lucide",`lucide-${Nu(e)}`,c].join(" "),...u},[...t.map(([p,m])=>h.createElement(p,m)),...Array.isArray(d)?d:[d]]));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cu=zt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ku=zt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Au=zt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eu=zt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Iu=({isOpen:e,onClose:t,onConfirm:r})=>e?n.jsx("div",{className:"levelup-overlay",children:n.jsxs("div",{className:"levelup-card",children:[n.jsx("button",{onClick:t,className:"levelup-close-btn",children:n.jsx(Eu,{size:20})}),n.jsxs("div",{className:"levelup-header",children:[n.jsx("div",{className:"levelup-icon-pulse",children:n.jsx(Au,{size:40,className:"text-yellow-400"})}),n.jsx("h2",{children:"Level Up Unlocked!"})]}),n.jsxs("div",{className:"levelup-content",children:[n.jsxs("p",{className:"levelup-message",children:["You've crushed your daily goal for ",n.jsx("span",{className:"highlight",children:"3 days in a row"}),". You are ready for the next challenge."]}),n.jsxs("div",{className:"levelup-stats",children:[n.jsxs("div",{className:"stat-row",children:[n.jsx("span",{className:"label",children:"Current Goal"}),n.jsx("span",{className:"value",children:"15 min/day"})]}),n.jsx("div",{className:"stat-arrow",children:n.jsx(ku,{size:20})}),n.jsxs("div",{className:"stat-row highlight-row",children:[n.jsx("span",{className:"label",children:"New Goal"}),n.jsx("span",{className:"value",children:"20 min/day"})]})]}),n.jsx("p",{className:"levelup-subtext",children:"Increasing your goal helps build stronger reading habits and deeper focus."})]}),n.jsxs("div",{className:"levelup-actions",children:[n.jsx("button",{onClick:t,className:"btn-secondary",children:"Keep 15m"}),n.jsxs("button",{onClick:r,className:"btn-primary-glow",children:[n.jsx(Cu,{size:18,className:"mr-2"}),"Accept Challenge"]})]})]})}):null,aa=({open:e,onClose:t,onSwitchToPositive:r})=>e?n.jsx("div",{className:"palate-modal-overlay",children:n.jsxs("div",{className:"palate-modal-content",children:[n.jsx("div",{className:"palate-icon",children:""}),n.jsx("h2",{children:"Take a moment."}),n.jsx("p",{children:"We've noticed you've been reading a lot of heavy content lately. Sometimes it helps to take a breath and reset."}),n.jsxs("div",{className:"palate-actions",children:[n.jsx("button",{className:"btn-primary",onClick:t,children:"I'm okay, continue"}),r&&n.jsx("button",{className:"btn-secondary",onClick:r,children:"Show me something lighter"})]})]})}):null,_u=Object.freeze(Object.defineProperty({__proto__:null,default:aa},Symbol.toStringTag,{value:"Module"})),Pu=new ma({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!1}}});function Lu(){const{user:e}=Te(),{addToast:t}=Ne();_l(e),h.useEffect(()=>{_e.isNativePlatform()&&(ui.hide(),ur.setStyle({style:xn.Dark}),ur.setBackgroundColor({color:"#09090b"}))},[]);const[r,s]=h.useState(!1),[a,i]=h.useState(!1),o=h.useRef(0),c=h.useCallback(u=>{const l=Date.now(),p=1e3*60*30;u==="trigger_goal_upgrade"?s(!0):u==="trigger_palate_cleanser"&&(l-o.current>p?(i(!0),o.current=l):console.log("Palate Cleanser suppressed by frontend safety cooldown."))},[]);Ft("app_root","feed",c);const d=async()=>{try{await vl(),t("Challenge Accepted! Daily goal updated to 20 mins.","success"),s(!1)}catch(u){console.error("Upgrade failed",u),t("Could not update goal. Try again later.","error")}};return n.jsxs(h.Suspense,{fallback:n.jsx($e,{}),children:[n.jsxs(ts,{children:[n.jsx(le,{path:"/login",element:e?n.jsx(vn,{to:"/",replace:!0}):n.jsx(Ml,{})}),n.jsx(le,{path:"/create-profile",element:e?n.jsx($l,{}):n.jsx(vn,{to:"/login",replace:!0})}),n.jsxs(le,{path:"/admin",element:n.jsx(hu,{}),children:[n.jsx(le,{index:!0,element:n.jsx(pu,{})}),n.jsx(le,{path:"newsroom",element:n.jsx(vu,{})}),n.jsx(le,{path:"narratives",element:n.jsx(Su,{})}),n.jsx(le,{path:"users",element:n.jsx(yu,{})}),n.jsx(le,{path:"config",element:n.jsx(bu,{})}),n.jsx(le,{path:"prompts",element:n.jsx(ju,{})})]}),n.jsx(le,{path:"/*",element:n.jsx(du,{profile:null})})]}),n.jsx(Iu,{isOpen:r,onClose:()=>s(!1),onConfirm:d}),n.jsx(aa,{open:a,onClose:()=>i(!1),onSwitchToPositive:()=>{i(!1),t("We are curating lighter stories for you...","info")}})]})}function Ru(){return n.jsx(fa,{client:Pu,children:n.jsx(Sl,{children:n.jsx(Il,{children:n.jsx(Nl,{children:n.jsx(Ol,{children:n.jsx(Lu,{})})})})})})}function Ou(e={}){const{immediate:t=!1,onNeedRefresh:r,onOfflineReady:s,onRegistered:a,onRegisteredSW:i,onRegisterError:o}=e;let c,d;const u=async(p=!0)=>{await d};async function l(){if("serviceWorker"in navigator){if(c=await ue(async()=>{const{Workbox:p}=await import("./workbox-window.prod.es5.vqzQaGvo.js");return{Workbox:p}},[]).then(({Workbox:p})=>new p("/sw.js",{scope:"/",type:"classic"})).catch(p=>{o==null||o(p)}),!c)return;c.addEventListener("activated",p=>{(p.isUpdate||p.isExternal)&&window.location.reload()}),c.addEventListener("installed",p=>{p.isUpdate||s==null||s()}),c.register({immediate:t}).then(p=>{i?i("/sw.js",p):a==null||a(p)}).catch(p=>{o==null||o(p)})}}return d=l(),u}console.log(" LATEST VERSION LOADED: v2.5 - Header Button Removed");window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),window.deferredPrompt=e,console.log(" PWA Install Event captured globally.")});const Du=yn.createRoot(document.getElementById("root"));Du.render(n.jsx(he.StrictMode,{children:n.jsx(et,{children:n.jsx(ya,{children:n.jsx(Ru,{})})})}));const Mu=Ou({onNeedRefresh(){console.log(" New content detected. Force updating..."),Mu(!0)},onOfflineReady(){console.log(" App is ready for offline usage.")},immediate:!0});export{Ud as A,Ee as B,Xs as C,pt as D,An as I,Zu as L,Hd as N,$e as P,nh as Q,eh as R,kd as S,Cu as T,ls as W,ue as _,Ut as a,Ne as b,zt as c,_d as d,Bt as e,Vu as f,ml as g,Wu as h,qu as i,Oe as j,Kd as k,hl as l,ll as m,Ku as n,Xe as o,Yu as p,Gu as q,st as r,gl as s,Ju as t,Te as u,Qu as v,rh as w,Xu as x,th as y,ht as z};
